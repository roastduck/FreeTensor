<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Python API - FreeTensor</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Python API";
        var mkdocs_page_input_path = "api.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> FreeTensor
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">FreeTensor</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/roastduck/FreeTensor">GitHub</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/">Get Started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/build-and-run/">Build and Run</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/first-program/">Your First Program with FreeTenor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/schedules/">Optimize a Program with Schedules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/gpu/">Running on a GPU</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/ad/">Automatic Differentiation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Python API</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#freetensor">freetensor</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#freetensor.core">core</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.auto_schedule">auto_schedule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.auto_schedule.AutoSchedule">AutoSchedule</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.autograd">autograd</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.autograd.ArgRetDict">ArgRetDict</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.autograd.Return">Return</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.autograd.grad">grad()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.autograd.grad_">grad_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.autograd.grad_body">grad_body()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.codegen">codegen</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.codegen.codegen">codegen()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.config">config</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.backend_compiler_cxx">backend_compiler_cxx()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.backend_compiler_nvcc">backend_compiler_nvcc()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.debug_binary">debug_binary()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.default_device">default_device()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.default_target">default_target()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.pretty_print">pretty_print()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.print_all_id">print_all_id()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_backend_compiler_cxx">set_backend_compiler_cxx()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_backend_compiler_nvcc">set_backend_compiler_nvcc()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_debug_binary">set_debug_binary()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_default_device">set_default_device()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_default_target">set_default_target()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_pretty_print">set_pretty_print()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_print_all_id">set_print_all_id()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.set_werror">set_werror()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.werror">werror()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.with_cuda">with_cuda()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.with_mkl">with_mkl()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.config.with_pytorch">with_pytorch()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.context">context</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.context.pop_ast">pop_ast()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.driver">driver</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.Device">Device</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.Driver">Driver</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.ReturnValuesPack">ReturnValuesPack</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.Target">Target</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.array">array()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.driver.build_binary">build_binary()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.expr">expr</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.VarRef">VarRef</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.abs">abs()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.add">add()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.any">any()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.cast">cast()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.ceil">ceil()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.ceildiv">ceildiv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.dtype">dtype()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.eq">eq()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.exp">exp()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.floor">floor()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.floordiv">floordiv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.ge">ge()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.gt">gt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.if_then_else">if_then_else()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.intrinsic">intrinsic()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.l_and">l_and()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.l_not">l_not()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.l_or">l_or()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.le">le()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.lt">lt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.max">max()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.min">min()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.mod">mod()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.mtype">mtype()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.mul">mul()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.ndim">ndim()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.ne">ne()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.remainder">remainder()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.round_towards_0_div">round_towards_0_div()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.shape">shape()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.sigmoid">sigmoid()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.sqrt">sqrt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.square">square()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.sub">sub()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.tanh">tanh()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.expr.truediv">truediv()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.frontend">frontend</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.FreeTensorOverload">FreeTensorOverload</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.LifetimeScope">LifetimeScope</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.PredefinedVarCreator">PredefinedVarCreator</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.Var">Var</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.VarCreator">VarCreator</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.dynamic_range">dynamic_range</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.capture_var">capture_var()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.empty">empty()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.inline">inline()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.transform">transform()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.frontend.var">var()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.optimize">optimize</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.optimize.optimize">optimize()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.passes">passes</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.passes.lower">lower()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.schedule">schedule</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.schedule.Schedule">Schedule</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.schedule.schedule">schedule()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.staging">staging</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.AllowShortcutScope">AllowShortcutScope</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.BreakException">BreakException</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.ContinueException">ContinueException</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.ReturnException">ReturnException</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagedAssignable">StagedAssignable</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagedPredicate">StagedPredicate</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagedTypeAnnotation">StagedTypeAnnotation</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagedTypeAnnotationMeta">StagedTypeAnnotationMeta</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagingError">StagingError</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.StagingOverload">StagingOverload</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.TransformError">TransformError</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.Transformer">Transformer</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.call_helper">call_helper()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.staging.function_helper">function_helper()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.core.stmt">stmt</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.Assert">Assert</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.Else">Else</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.For">For</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.If">If</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.NamedScope">NamedScope</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.Any">Any()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.Eval">Eval()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.Invoke">Invoke()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.MarkNid">MarkNid()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.core.stmt.VarDef">VarDef()</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#freetensor.libop">libop</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.assign">assign</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.add_to">add_to()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.assign">assign()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.floordiv_to">floordiv_to()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.mod_to">mod_to()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.mul_to">mul_to()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.sub_to">sub_to()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.assign.truediv_to">truediv_to()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.constant">constant</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.constant.zeros">zeros()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.constant.zeros_">zeros_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.conv">conv</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.conv.conv">conv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.conv.conv_">conv_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.element_wise">element_wise</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.abs">abs()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.abs_">abs_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.add">add()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.add_">add_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ceil">ceil()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ceil_">ceil_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ceildiv">ceildiv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ceildiv_">ceildiv_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.eq">eq()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.eq_">eq_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.exp">exp()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.exp_">exp_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.floor">floor()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.floor_">floor_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.floordiv">floordiv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.floordiv_">floordiv_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ge">ge()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ge_">ge_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.gt">gt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.gt_">gt_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_and">l_and()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_and_">l_and_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_not">l_not()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_not_">l_not_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_or">l_or()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.l_or_">l_or_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.le">le()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.le_">le_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.lt">lt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.lt_">lt_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.max">max()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.max_">max_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.min">min()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.min_">min_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.mod">mod()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.mod_">mod_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.mul">mul()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.mul_">mul_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ne">ne()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.ne_">ne_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.neg">neg()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.neg_">neg_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.relu">relu()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.relu_">relu_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.remainder">remainder()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.remainder_">remainder_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.round_towards_0_div">round_towards_0_div()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.round_towards_0_div_">round_towards_0_div_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sigmoid">sigmoid()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sigmoid_">sigmoid_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sqrt">sqrt()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sqrt_">sqrt_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.square">square()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.square_">square_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sub">sub()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.sub_">sub_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.tanh">tanh()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.tanh_">tanh_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.truediv">truediv()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.element_wise.truediv_">truediv_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.matmul">matmul</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.einsum">einsum()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.einsum_">einsum_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.gemm">gemm()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.gemm_">gemm_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.matmul">matmul()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.matmul.matmul_">matmul_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.pooling">pooling</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.pooling.global_avg_pool">global_avg_pool()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.pooling.global_avg_pool_">global_avg_pool_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.pooling.max_pool">max_pool()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.pooling.max_pool_">max_pool_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.reduction">reduction</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.all">all()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.all_">all_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.any">any()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.any_">any_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_max">reduce_max()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_max_">reduce_max_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_min">reduce_min()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_min_">reduce_min_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_prod">reduce_prod()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_prod_">reduce_prod_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_sum">reduce_sum()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reduction.reduce_sum_">reduce_sum_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.reshape">reshape</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.expand">expand()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.expand_">expand_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.flatten">flatten()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.flatten_">flatten_()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.unsqueeze">unsqueeze()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.reshape.unsqueeze_">unsqueeze_()</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#freetensor.libop.softmax">softmax</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.softmax.softmax">softmax()</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#freetensor.libop.softmax.softmax_">softmax_()</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../doxygen/html/">Internal C++ Interface</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../about/contrib/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about/pub/">Publication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/roastduck/FreeTensor/blob/master/LICENSE">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FreeTensor</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>API Reference &raquo;</li><li>Python API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="python-api">Python API<a class="headerlink" href="#python-api" title="Permanent link">&para;</a></h1>


  <div class="doc doc-object doc-module">

<a id="freetensor"></a>
    <div class="doc doc-contents first">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h2 id="freetensor.core" class="doc doc-heading">
        <code>core</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">











  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.auto_schedule" class="doc doc-heading">
        <code>auto_schedule</code>



<a href="#freetensor.core.auto_schedule" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.auto_schedule.AutoSchedule" class="doc doc-heading">
        <code>
AutoSchedule            (<span title="freetensor_ffi.AutoSchedule">AutoSchedule</span>)
        </code>



<a href="#freetensor.core.auto_schedule.AutoSchedule" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/auto_schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">AutoSchedule</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">AutoSchedule</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">schedule</span><span class="p">,</span>
                 <span class="n">target</span><span class="p">,</span>
                 <span class="n">device</span><span class="p">,</span>
                 <span class="o">*</span><span class="p">,</span>
                 <span class="n">population</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
                 <span class="n">explore_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                 <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">min_block_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">continue_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rule_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Automatic scheduler</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        schedule : Schedule</span>
<span class="sd">            A Schedule object to apply schedules onto</span>
<span class="sd">        target : Target</span>
<span class="sd">            The type of devices to compile to</span>
<span class="sd">        population : int</span>
<span class="sd">            How many programs to test in each iteration</span>
<span class="sd">        explore_ratio : float</span>
<span class="sd">            Portion of random programs in the population. Higher ratio focuses on</span>
<span class="sd">            exploration, while lower ratio focuses on exploitation</span>
<span class="sd">        continue_trianing : bool</span>
<span class="sd">            Continue to train an existing XGBoost model file if found</span>
<span class="sd">        random_seed : Optional[int]</span>
<span class="sd">            Random seed. Setting a deterministic random seed and using a fixed OpenMP</span>
<span class="sd">            thread count (since we are using thread-local random number generators)</span>
<span class="sd">            resulting deterministic pseudo random numbers, but please note that the</span>
<span class="sd">            whole auto-scheduling procedure is still non-deterministic, becuase it</span>
<span class="sd">            measures real performance. Default to a non-deterministic seed</span>
<span class="sd">        rule_set : Optional[set]</span>
<span class="sd">            Explicitly control over what rules to use. None for defualt rules</span>
<span class="sd">        verbose : int</span>
<span class="sd">            Verbosity level. 0 = print nothing, 1 = print tuning progress, 2 = print</span>
<span class="sd">            extra info mation of each rule</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">population</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_explore</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">population</span> <span class="o">*</span> <span class="n">explore_ratio</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_exploit</span> <span class="o">=</span> <span class="n">population</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_explore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_xgb.model&quot;</span>
        <span class="k">if</span> <span class="n">continue_training</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">Booster</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="k">def</span> <span class="nf">predict_func</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_func</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">AutoSchedule</span><span class="p">,</span>
              <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schedule</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">predict_func</span><span class="p">,</span>
                             <span class="n">update_func</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">min_block_size</span><span class="p">,</span> <span class="n">random_seed</span><span class="p">,</span>
                             <span class="n">rule_set</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AutoSchedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iteration</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iteration</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_one_round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_exploit</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">n_explore</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_best_schedule</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">missing</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="n">dtrain</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">DMatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">times</span><span class="p">),</span> <span class="n">missing</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xgb_params</span><span class="p">,</span> <span class="n">dtrain</span><span class="p">,</span> <span class="n">xgb_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.auto_schedule.AutoSchedule.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">explore_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">min_block_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">continue_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rule_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.auto_schedule.AutoSchedule.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Automatic scheduler</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>schedule</strong> (<code>Schedule</code>)  A Schedule object to apply schedules onto</p></li>
            <li><p><strong>target</strong> (<code>Target</code>)  The type of devices to compile to</p></li>
            <li><p><strong>population</strong> (<code>int</code>)  How many programs to test in each iteration</p></li>
            <li><p><strong>explore_ratio</strong> (<code>float</code>)  Portion of random programs in the population. Higher ratio focuses on
exploration, while lower ratio focuses on exploitation</p></li>
            <li><p><strong>continue_trianing</strong> (<code>bool</code>)  Continue to train an existing XGBoost model file if found</p></li>
            <li><p><strong>random_seed</strong> (<code>Optional[int]</code>)  Random seed. Setting a deterministic random seed and using a fixed OpenMP
thread count (since we are using thread-local random number generators)
resulting deterministic pseudo random numbers, but please note that the
whole auto-scheduling procedure is still non-deterministic, becuase it
measures real performance. Default to a non-deterministic seed</p></li>
            <li><p><strong>rule_set</strong> (<code>Optional[set]</code>)  Explicitly control over what rules to use. None for defualt rules</p></li>
            <li><p><strong>verbose</strong> (<code>int</code>)  Verbosity level. 0 = print nothing, 1 = print tuning progress, 2 = print
extra info mation of each rule</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/auto_schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">schedule</span><span class="p">,</span>
             <span class="n">target</span><span class="p">,</span>
             <span class="n">device</span><span class="p">,</span>
             <span class="o">*</span><span class="p">,</span>
             <span class="n">population</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
             <span class="n">explore_ratio</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
             <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
             <span class="n">min_block_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
             <span class="n">continue_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">rule_set</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Automatic scheduler</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    schedule : Schedule</span>
<span class="sd">        A Schedule object to apply schedules onto</span>
<span class="sd">    target : Target</span>
<span class="sd">        The type of devices to compile to</span>
<span class="sd">    population : int</span>
<span class="sd">        How many programs to test in each iteration</span>
<span class="sd">    explore_ratio : float</span>
<span class="sd">        Portion of random programs in the population. Higher ratio focuses on</span>
<span class="sd">        exploration, while lower ratio focuses on exploitation</span>
<span class="sd">    continue_trianing : bool</span>
<span class="sd">        Continue to train an existing XGBoost model file if found</span>
<span class="sd">    random_seed : Optional[int]</span>
<span class="sd">        Random seed. Setting a deterministic random seed and using a fixed OpenMP</span>
<span class="sd">        thread count (since we are using thread-local random number generators)</span>
<span class="sd">        resulting deterministic pseudo random numbers, but please note that the</span>
<span class="sd">        whole auto-scheduling procedure is still non-deterministic, becuase it</span>
<span class="sd">        measures real performance. Default to a non-deterministic seed</span>
<span class="sd">    rule_set : Optional[set]</span>
<span class="sd">        Explicitly control over what rules to use. None for defualt rules</span>
<span class="sd">    verbose : int</span>
<span class="sd">        Verbosity level. 0 = print nothing, 1 = print tuning progress, 2 = print</span>
<span class="sd">        extra info mation of each rule</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">population</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_explore</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">population</span> <span class="o">*</span> <span class="n">explore_ratio</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_exploit</span> <span class="o">=</span> <span class="n">population</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_explore</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">xgb_params</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span> <span class="o">=</span> <span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;_xgb.model&quot;</span>
    <span class="k">if</span> <span class="n">continue_training</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">Booster</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_file_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">predict_func</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_func</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="nb">super</span><span class="p">(</span><span class="n">AutoSchedule</span><span class="p">,</span>
          <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">schedule</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">predict_func</span><span class="p">,</span>
                         <span class="n">update_func</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">min_block_size</span><span class="p">,</span> <span class="n">random_seed</span><span class="p">,</span>
                         <span class="n">rule_set</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.auto_schedule.AutoSchedule.set_params" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></code>


<a href="#freetensor.core.auto_schedule.AutoSchedule.set_params" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>set_params(self: freetensor_ffi.AutoSchedule, args: List[freetensor_ffi.Array], kws: Dict[str, freetensor_ffi.Array] = {}) -&gt; None</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/auto_schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">AutoSchedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.autograd" class="doc doc-heading">
        <code>autograd</code>



<a href="#freetensor.core.autograd" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.autograd.ArgRetDict" class="doc doc-heading">
        <code>
ArgRetDict        </code>



<a href="#freetensor.core.autograd.ArgRetDict" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Look an object using either a function argument or return value's name or its position</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/autograd.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ArgRetDict</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Look an object using either a function argument or return value&#39;s name or its position &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Return</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">get_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.autograd.Return" class="doc doc-heading">
        <code>
Return        </code>



<a href="#freetensor.core.autograd.Return" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Alias of a return value of a function</p>
<p><code>Return(n)</code> represents the n-th return value (counted from 0)</p>
<p><code>Return()</code> can be used if there is only one return value</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/autograd.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Return</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Alias of a return value of a function</span>

<span class="sd">    `Return(n)` represents the n-th return value (counted from 0)</span>

<span class="sd">    `Return()` can be used if there is only one return value</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has no return value&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">func</span><span class="o">.</span><span class="n">returns</span>
            <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> has more than one return value, and you need to specify the number of a return value&quot;</span>
            <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.autograd.grad" class="doc doc-heading">
<code class="highlight language-python"><span class="n">grad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">requires</span><span class="p">,</span> <span class="n">provides</span><span class="p">,</span> <span class="n">tapes</span><span class="o">=&lt;</span><span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">:</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.autograd.grad" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reverse mode automatic differentiation</p>
<p>It returns a forward function and a backward function. The forward has the same
interface of the original function, but it will store some intermediate tensors
(the tape) to be reused by the backward function in some global states. The
backward function computes the gradients.</p>
<p><code>grad</code> is an out-of-place version. The resulting gradient are returned from the
backward function.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Func</code>)  The original function</p></li>
            <li><p><strong>requires</strong> (<code>Sequence[Union[str, freetensor.core.autograd.Return]]</code>)  Name of input variables that need gradients</p></li>
            <li><p><strong>provides</strong> (<code>Sequence[Union[str, freetensor.core.autograd.Return]]</code>)  Name of output variables whose gradients are known. A return value of a
function can be specified with a <code>Return</code> object</p></li>
            <li><p><strong>tapes</strong> (<code>Union[Sequence, freetensor_ffi.GradTapeMode]</code>)  Intermediate variables that need to be stored from the forward pass and
reused in the backward pass. This parameter can be a sequence, which contains
VarDef IDs of them. It can also be a <code>GradTapeMode</code>, then it will determine
which intermediate variables to be stored by heuristics. Avail <code>GradTapeMode</code>s
are: All: store all variables including local scalars; None: store nothing;
NoReuseOnly: store variables that only hold one version of data, which means
we do not have to store each version of them in their history</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>tuple</code>  (
 0. Forward AST.
 1. Backward AST.
 2. Mapping from names in requries to its gradient name.
 3. Mapping from names in provides to its gradient name.
)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/autograd.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Func</span><span class="p">,</span>
         <span class="n">requires</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
         <span class="n">provides</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
         <span class="n">tapes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">GradTapeMode</span><span class="p">]</span> <span class="o">=</span> <span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">,</span>
         <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reverse mode automatic differentiation</span>

<span class="sd">    It returns a forward function and a backward function. The forward has the same</span>
<span class="sd">    interface of the original function, but it will store some intermediate tensors</span>
<span class="sd">    (the tape) to be reused by the backward function in some global states. The</span>
<span class="sd">    backward function computes the gradients.</span>

<span class="sd">    `grad` is an out-of-place version. The resulting gradient are returned from the</span>
<span class="sd">    backward function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : AST</span>
<span class="sd">        The original function</span>
<span class="sd">    requires : Sequence[str]</span>
<span class="sd">        Name of input variables that need gradients</span>
<span class="sd">    provides : Sequence[Union[str, Return]]</span>
<span class="sd">        Name of output variables whose gradients are known. A return value of a</span>
<span class="sd">        function can be specified with a `Return` object</span>
<span class="sd">    tapes : Union[Sequence, GradTapeMode]</span>
<span class="sd">        Intermediate variables that need to be stored from the forward pass and</span>
<span class="sd">        reused in the backward pass. This parameter can be a sequence, which contains</span>
<span class="sd">        VarDef IDs of them. It can also be a `GradTapeMode`, then it will determine</span>
<span class="sd">        which intermediate variables to be stored by heuristics. Avail `GradTapeMode`s</span>
<span class="sd">        are: All: store all variables including local scalars; None: store nothing;</span>
<span class="sd">        NoReuseOnly: store variables that only hold one version of data, which means</span>
<span class="sd">        we do not have to store each version of them in their history</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        (</span>
<span class="sd">         0. Forward AST.</span>
<span class="sd">         1. Backward AST.</span>
<span class="sd">         2. Mapping from names in requries to its gradient name.</span>
<span class="sd">         3. Mapping from names in provides to its gradient name.</span>
<span class="sd">        )</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">_grad_func</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span>
                      <span class="n">func</span><span class="p">,</span>
                      <span class="n">requires</span><span class="p">,</span>
                      <span class="n">provides</span><span class="p">,</span>
                      <span class="n">tapes</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.autograd.grad_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">grad_</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">requires</span><span class="p">,</span> <span class="n">provides</span><span class="p">,</span> <span class="n">tapes</span><span class="o">=&lt;</span><span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">:</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.autograd.grad_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reverse mode automatic differentiation</p>
<p>It returns a forward function and a backward function. The forward has the same
interface of the original function, but it will store some intermediate tensors
(the tape) to be reused by the backward function in some global states. The
backward function computes the gradients.</p>
<p><code>grad_</code> is an inplace version. The resulting gradient are mutable arguments of
the backward function.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Func</code>)  The original function</p></li>
            <li><p><strong>requires</strong> (<code>Sequence[Union[str, freetensor.core.autograd.Return]]</code>)  Name of input variables that need gradients</p></li>
            <li><p><strong>provides</strong> (<code>Sequence[Union[str, freetensor.core.autograd.Return]]</code>)  Name of output variables whose gradients are known. A return value of a
function can be specified with a <code>Return</code> object</p></li>
            <li><p><strong>tapes</strong> (<code>Union[Sequence, freetensor_ffi.GradTapeMode]</code>)  Intermediate variables that need to be stored from the forward pass and
reused in the backward pass. This parameter can be a sequence, which contains
VarDef IDs of them. It can also be a <code>GradTapeMode</code>, then it will determine
which intermediate variables to be stored by heuristics. Avail <code>GradTapeMode</code>s
are: All: store all variables including local scalars; None: store nothing;
NoReuseOnly: store variables that only hold one version of data, which means
we do not have to store each version of them in their history</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>tuple</code>  (
 0. Forward AST.
 1. Backward AST.
 2. Mapping from names in requries to its gradient name.
 3. Mapping from names in provides to its gradient name.
)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/autograd.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grad_</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Func</span><span class="p">,</span>
          <span class="n">requires</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
          <span class="n">provides</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
          <span class="n">tapes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">GradTapeMode</span><span class="p">]</span> <span class="o">=</span> <span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">,</span>
          <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Reverse mode automatic differentiation</span>

<span class="sd">    It returns a forward function and a backward function. The forward has the same</span>
<span class="sd">    interface of the original function, but it will store some intermediate tensors</span>
<span class="sd">    (the tape) to be reused by the backward function in some global states. The</span>
<span class="sd">    backward function computes the gradients.</span>

<span class="sd">    `grad_` is an inplace version. The resulting gradient are mutable arguments of</span>
<span class="sd">    the backward function.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : AST</span>
<span class="sd">        The original function</span>
<span class="sd">    requires : Sequence[str]</span>
<span class="sd">        Name of input variables that need gradients</span>
<span class="sd">    provides : Sequence[Union[str, Return]]</span>
<span class="sd">        Name of output variables whose gradients are known. A return value of a</span>
<span class="sd">        function can be specified with a `Return` object</span>
<span class="sd">    tapes : Union[Sequence, GradTapeMode]</span>
<span class="sd">        Intermediate variables that need to be stored from the forward pass and</span>
<span class="sd">        reused in the backward pass. This parameter can be a sequence, which contains</span>
<span class="sd">        VarDef IDs of them. It can also be a `GradTapeMode`, then it will determine</span>
<span class="sd">        which intermediate variables to be stored by heuristics. Avail `GradTapeMode`s</span>
<span class="sd">        are: All: store all variables including local scalars; None: store nothing;</span>
<span class="sd">        NoReuseOnly: store variables that only hold one version of data, which means</span>
<span class="sd">        we do not have to store each version of them in their history</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        (</span>
<span class="sd">         0. Forward AST.</span>
<span class="sd">         1. Backward AST.</span>
<span class="sd">         2. Mapping from names in requries to its gradient name.</span>
<span class="sd">         3. Mapping from names in provides to its gradient name.</span>
<span class="sd">        )</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">return</span> <span class="n">_grad_func</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">grad_</span><span class="p">,</span>
                      <span class="n">func</span><span class="p">,</span>
                      <span class="n">requires</span><span class="p">,</span>
                      <span class="n">provides</span><span class="p">,</span>
                      <span class="n">tapes</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.autograd.grad_body" class="doc doc-heading">
<code class="highlight language-python"><span class="n">grad_body</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">requires</span><span class="p">,</span> <span class="n">provides</span><span class="p">,</span> <span class="n">tapes</span><span class="o">=&lt;</span><span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">:</span> <span class="mi">2</span><span class="o">&gt;</span><span class="p">)</span></code>


<a href="#freetensor.core.autograd.grad_body" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>grad</code> or <code>grad_</code> on a function body (for internal tests only)</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/autograd.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">grad_body</span><span class="p">(</span><span class="n">stmt</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Stmt</span><span class="p">,</span>
              <span class="n">requires</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
              <span class="n">provides</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Return</span><span class="p">]],</span>
              <span class="n">tapes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">GradTapeMode</span><span class="p">]</span> <span class="o">=</span> <span class="n">GradTapeMode</span><span class="o">.</span><span class="n">NoReuseOnly</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; `grad` or `grad_` on a function body (for internal tests only) &#39;&#39;&#39;</span>

    <span class="n">req</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">requires</span><span class="p">)</span>
    <span class="n">prov</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">provides</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tapes</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">GradTapeMode</span><span class="p">:</span>
        <span class="n">tapes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tapes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">grad_body</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">prov</span><span class="p">,</span> <span class="n">tapes</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.codegen" class="doc doc-heading">
        <code>codegen</code>



<a href="#freetensor.core.codegen" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.codegen.codegen" class="doc doc-heading">
<code class="highlight language-python"><span class="n">codegen</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.codegen.codegen" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Generate native code</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ast</strong> (<code>AST</code>)  The AST to be lowered. It must includes function signature to determine
parameters and return values. If not specified, a partial function is
returned, which can be used as a decorator</p></li>
            <li><p><strong>target</strong> (<code>Optional[freetensor_ffi.Target]</code>)  The target architecture. If omitted, use the default one in config</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/codegen.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">codegen</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ffi</span><span class="o">.</span><span class="n">Target</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NativeCode</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate native code</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ast : AST</span>
<span class="sd">        The AST to be lowered. It must includes function signature to determine</span>
<span class="sd">        parameters and return values. If not specified, a partial function is</span>
<span class="sd">        returned, which can be used as a decorator</span>
<span class="sd">    target : Target (Optional)</span>
<span class="sd">        The target architecture. If omitted, use the default one in config</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">ast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_target</span><span class="p">()</span>
        <span class="n">raw_code</span> <span class="o">=</span> <span class="n">ffi</span><span class="o">.</span><span class="n">code_gen</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">debug</span><span class="o">.</span><span class="n">with_line_no</span><span class="p">(</span><span class="n">raw_code</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">NativeCode</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">raw_code</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">codegen</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.config" class="doc doc-heading">
        <code>config</code>



<a href="#freetensor.core.config" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Global configurations</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.backend_compiler_cxx" class="doc doc-heading">
<code class="highlight language-python"><span class="n">backend_compiler_cxx</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.backend_compiler_cxx" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>backend_compiler_cxx() -&gt; str</p>
<p>Backend compiler used to compile generated C++ code</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.backend_compiler_nvcc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">backend_compiler_nvcc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.backend_compiler_nvcc" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>backend_compiler_nvcc() -&gt; str</p>
<p>Backend compiler used to compile generated CUDA code</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.debug_binary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">debug_binary</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.debug_binary" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>debug_binary() -&gt; bool</p>
<p>Check if compiling binary in debug mode</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.default_device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">default_device</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.default_device" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>default_device() -&gt; freetensor_ffi.Device</p>
<p>Check current default device</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.default_target" class="doc doc-heading">
<code class="highlight language-python"><span class="n">default_target</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.default_target" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>default_target() -&gt; freetensor_ffi.Target</p>
<p>Check current default target</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.pretty_print" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pretty_print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.pretty_print" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>pretty_print() -&gt; bool</p>
<p>Check if colored printing enabled</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.print_all_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">print_all_id</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.print_all_id" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>pretty_print() -&gt; bool</p>
<p>Check if colored printing enabled</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_backend_compiler_cxx" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_backend_compiler_cxx</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_backend_compiler_cxx" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_backend_compiler_cxx(path: str) -&gt; None</p>
<p>Set backend compiler used to compile generated C++ code</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_backend_compiler_nvcc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_backend_compiler_nvcc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_backend_compiler_nvcc" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_backend_compiler_nvcc(path: str) -&gt; None</p>
<p>Set backend compiler used to compile generated CUDA code</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_debug_binary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_debug_binary</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_debug_binary" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_debug_binary(flag: bool = True) -&gt; None</p>
<p>Compile with <code>-g</code> at backend. Do not delete the binary file after loaded</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_default_device" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_device</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_default_device" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_default_device(device: freetensor_ffi.Device) -&gt; None</p>
<p>Set default device (internal implementation of <code>with Device</code>)</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_default_target" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_default_target</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_default_target" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_default_target(target: freetensor_ffi.Target) -&gt; None</p>
<p>Set default target (internal implementation of <code>with Target</code>)</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_pretty_print" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_pretty_print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_pretty_print" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_pretty_print(flag: bool = True) -&gt; None</p>
<p>Set colored printing</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_print_all_id" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_print_all_id</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_print_all_id" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_pretty_print(flag: bool = True) -&gt; None</p>
<p>Set colored printing</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.set_werror" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_werror</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.set_werror" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>set_werror(flag: bool = True) -&gt; None</p>
<p>Error on warning</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.werror" class="doc doc-heading">
<code class="highlight language-python"><span class="n">werror</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.werror" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>werror() -&gt; bool</p>
<p>Check if error-on-warning enabled</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.with_cuda" class="doc doc-heading">
<code class="highlight language-python"><span class="n">with_cuda</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.with_cuda" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>with_cuda() -&gt; bool</p>
<p>Check if FreeTensor is built with CUDA</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.with_mkl" class="doc doc-heading">
<code class="highlight language-python"><span class="n">with_mkl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.with_mkl" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>with_mkl() -&gt; str</p>
<p>Check if FreeTensor is built with MKL</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.config.with_pytorch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">with_pytorch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.config.with_pytorch" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>with_pytorch() -&gt; bool</p>
<p>Check if FreeTensor is built with PyTorch interface</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/config.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.context" class="doc doc-heading">
        <code>context</code>



<a href="#freetensor.core.context" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Facility to pick statements to build an AST</p>
<p>Classes and functions in this module are internally used by <code>transformer</code> to construct ASTs.
They are also used by some internal tests. API of these classes and functions are subject to changes.
End users are encouraged to use <code>transformer</code>, instead of this module.</p>



  <div class="doc doc-children">











  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.context.pop_ast" class="doc doc-heading">
<code class="highlight language-python"><span class="n">pop_ast</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#freetensor.core.context.pop_ast" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Get AST and reset context</p>
<p>Internally used by <code>transformer</code> and tests</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/context.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">pop_ast</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get AST and reset context</span>

<span class="sd">    Internally used by `transformer` and tests</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">()</span>
    <span class="n">ctx_stack</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The popped AST is:&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.driver" class="doc doc-heading">
        <code>driver</code>



<a href="#freetensor.core.driver" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.driver.Device" class="doc doc-heading">
        <code>
Device            (<span title="freetensor_ffi.Device">Device</span>)
        </code>



<a href="#freetensor.core.driver.Device" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>A computing device of a Target</p>
<p>E.g. suppose GPU() is a Target (architecture), then Device(GPU(), 0) means
the 0-th GPU (device)</p>
<p>A Device can be used as a "with" scope, then all the <code>Array</code>s and <code>Driver</code>s
will use it by default. In this style, it also sets the default Target. E.g:</p>
<pre><code>with Device(...):
    ast = lower(ast)  # Use the Target of the Device above by default
    a = Array(...)  # Use the Device above by default
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Device</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">Device</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A computing device of a Target</span>

<span class="sd">    E.g. suppose GPU() is a Target (architecture), then Device(GPU(), 0) means</span>
<span class="sd">    the 0-th GPU (device)</span>

<span class="sd">    A Device can be used as a &quot;with&quot; scope, then all the `Array`s and `Driver`s</span>
<span class="sd">    will use it by default. In this style, it also sets the default Target. E.g:</span>

<span class="sd">    ```</span>
<span class="sd">    with Device(...):</span>
<span class="sd">        ast = lower(ast)  # Use the Target of the Device above by default</span>
<span class="sd">        a = Array(...)  # Use the Device above by default</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Target</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Device</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_target</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_device</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_device</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">())</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_target</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_device</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.driver.Driver" class="doc doc-heading">
        <code>
Driver            (<span title="freetensor_ffi.Driver">Driver</span>)
        </code>



<a href="#freetensor.core.driver.Driver" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Driver</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">Driver</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">func</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Func</span><span class="p">,</span>
                 <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">host_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Compile a program using a backend compiler and load it into memory</span>

<span class="sd">        This class is for internal use. Please consider using `build_binary`</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : ffi.Func</span>
<span class="sd">            AST of the function, where the function signature is needed to</span>
<span class="sd">            determine the parameters and return values</span>
<span class="sd">        src : str</span>
<span class="sd">            Native code generated from codegen</span>
<span class="sd">        device : Device (Optional)</span>
<span class="sd">            The device to run the program. If omitted, use the default device</span>
<span class="sd">            in config</span>
<span class="sd">        verbose : bool (Optional)</span>
<span class="sd">            True to print extra infomation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">src</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">host_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">host_device</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">set_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Set argument for an invocation &#39;&#39;&#39;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
            <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
            <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">collect_returns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Collect return values from an invocation</span>

<span class="sd">        Return values must be collect. Otherwise there will be memory leaks</span>

<span class="sd">        If there is only one return value, it is returned directly. Otherwise,</span>
<span class="sd">        the return values are packed in a ReturnValuesPack</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">collect_returns</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ReturnValuesPack</span><span class="p">(</span>
                <span class="nb">map</span><span class="p">(</span>
                    <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_in_closure</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">return_closure</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">)),</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set argument, execute the binary code, and collect the returns</span>

<span class="sd">        If there is only one return value, it is returned directly. Otherwise,</span>
<span class="sd">        the return values are packed in a ReturnValuesPack</span>

<span class="sd">        This function will introduce some overhaed handling arguments and return</span>
<span class="sd">        values. For an accurate execution time measurement, plase call</span>
<span class="sd">        `self.set_args` first, then `self.time`, and finally `self.collect_returns`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_returns</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.Driver.__call__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.driver.Driver.__call__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Set argument, execute the binary code, and collect the returns</p>
<p>If there is only one return value, it is returned directly. Otherwise,
the return values are packed in a ReturnValuesPack</p>
<p>This function will introduce some overhaed handling arguments and return
values. For an accurate execution time measurement, plase call
<code>self.set_args</code> first, then <code>self.time</code>, and finally <code>self.collect_returns</code></p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Set argument, execute the binary code, and collect the returns</span>

<span class="sd">    If there is only one return value, it is returned directly. Otherwise,</span>
<span class="sd">    the return values are packed in a ReturnValuesPack</span>

<span class="sd">    This function will introduce some overhaed handling arguments and return</span>
<span class="sd">    values. For an accurate execution time measurement, plase call</span>
<span class="sd">    `self.set_args` first, then `self.time`, and finally `self.collect_returns`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collect_returns</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.Driver.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host_device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.driver.Driver.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Compile a program using a backend compiler and load it into memory</p>
<p>This class is for internal use. Please consider using <code>build_binary</code></p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Func</code>)  AST of the function, where the function signature is needed to
determine the parameters and return values</p></li>
            <li><p><strong>src</strong> (<code>str</code>)  Native code generated from codegen</p></li>
            <li><p><strong>device</strong> (<code>Optional[freetensor.core.driver.Device]</code>)  The device to run the program. If omitted, use the default device
in config</p></li>
            <li><p><strong>verbose</strong> (<code>Optional[bool]</code>)  True to print extra infomation</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">func</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Func</span><span class="p">,</span>
             <span class="n">src</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
             <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">host_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compile a program using a backend compiler and load it into memory</span>

<span class="sd">    This class is for internal use. Please consider using `build_binary`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : ffi.Func</span>
<span class="sd">        AST of the function, where the function signature is needed to</span>
<span class="sd">        determine the parameters and return values</span>
<span class="sd">    src : str</span>
<span class="sd">        Native code generated from codegen</span>
<span class="sd">    device : Device (Optional)</span>
<span class="sd">        The device to run the program. If omitted, use the default device</span>
<span class="sd">        in config</span>
<span class="sd">    verbose : bool (Optional)</span>
<span class="sd">        True to print extra infomation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">src</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_device</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">host_device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">host_device</span><span class="p">,</span>
                                     <span class="n">verbose</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.Driver.collect_returns" class="doc doc-heading">
<code class="highlight language-python"><span class="n">collect_returns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#freetensor.core.driver.Driver.collect_returns" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Collect return values from an invocation</p>
<p>Return values must be collect. Otherwise there will be memory leaks</p>
<p>If there is only one return value, it is returned directly. Otherwise,
the return values are packed in a ReturnValuesPack</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">collect_returns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Collect return values from an invocation</span>

<span class="sd">    Return values must be collect. Otherwise there will be memory leaks</span>

<span class="sd">    If there is only one return value, it is returned directly. Otherwise,</span>
<span class="sd">    the return values are packed in a ReturnValuesPack</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">collect_returns</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ReturnValuesPack</span><span class="p">(</span>
            <span class="nb">map</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_in_closure</span> <span class="ow">or</span> <span class="n">r</span><span class="o">.</span><span class="n">return_closure</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">returns</span><span class="p">)),</span> <span class="n">values</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.Driver.set_args" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></code>


<a href="#freetensor.core.driver.Driver.set_args" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Set argument for an invocation</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Set argument for an invocation &#39;&#39;&#39;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kws</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)):</span>
        <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
        <span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Driver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_args</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kws</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.driver.ReturnValuesPack" class="doc doc-heading">
        <code>
ReturnValuesPack        </code>



<a href="#freetensor.core.driver.ReturnValuesPack" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Hold return values from a Driver invocation</p>
<p>Return values can be retrieved in an anonymous manner: <code>x, y, z = pack</code>,
or in a named manner: <code>pack['x']</code></p>
<p>Please note that a ReturnValuesPack is different from a OrderedDict, as
OrderedDict unpacks to keys rather than values</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ReturnValuesPack</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Hold return values from a Driver invocation</span>

<span class="sd">    Return values can be retrieved in an anonymous manner: `x, y, z = pack`,</span>
<span class="sd">    or in a named manner: `pack[&#39;x&#39;]`</span>

<span class="sd">    Please note that a ReturnValuesPack is different from a OrderedDict, as</span>
<span class="sd">    OrderedDict unpacks to keys rather than values</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Array</span><span class="p">]):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get all return values in the order declared in Func &#39;&#39;&#39;</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39; Get a return value with a name. Tuple is supported for multiple values &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">ret</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>
        <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DriverError</span><span class="p">(</span><span class="s2">&quot;No such return value named &quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.ReturnValuesPack.__getitem__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.driver.ReturnValuesPack.__getitem__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get a return value with a name. Tuple is supported for multiple values</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39; Get a return value with a name. Tuple is supported for multiple values &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>
    <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DriverError</span><span class="p">(</span><span class="s2">&quot;No such return value named &quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.driver.ReturnValuesPack.__iter__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.driver.ReturnValuesPack.__iter__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get all return values in the order declared in Func</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Get all return values in the order declared in Func &#39;&#39;&#39;</span>
    <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.driver.Target" class="doc doc-heading">
        <code>
Target            (<span title="freetensor_ffi.Target">Target</span>)
        </code>



<a href="#freetensor.core.driver.Target" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>A target architecture</p>
<p>A Target can be used as a "with" scope, then all the <code>lower</code>s and <code>codegen</code>s
will use it by default. In this style, it also sets the default Device as the
0-th device of the given Target. E.g:</p>
<pre><code>with Target(...):
    ast = lower(ast)  # Use the Target above by default
    a = Array(...)  # Use the 0-th device of the Target above by default
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Target</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">Target</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A target architecture</span>

<span class="sd">    A Target can be used as a &quot;with&quot; scope, then all the `lower`s and `codegen`s</span>
<span class="sd">    will use it by default. In this style, it also sets the default Device as the</span>
<span class="sd">    0-th device of the given Target. E.g:</span>

<span class="sd">    ```</span>
<span class="sd">    with Target(...):</span>
<span class="sd">        ast = lower(ast)  # Use the Target above by default</span>
<span class="sd">        a = Array(...)  # Use the 0-th device of the Target above by default</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_native_arch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Target</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_native_arch</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_target</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_target</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_device</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_device</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_target</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="n">Device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_target</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">set_default_device</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">old_device</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.driver.array" class="doc doc-heading">
<code class="highlight language-python"><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>


<a href="#freetensor.core.driver.array" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Factory function for Array</p>
<p>It converts more data format to Array</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">array</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Factory function for Array</span>

<span class="sd">    It converts more data format to Array</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Array</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1"># For NumPy, Although Pybind11&#39;s `array_t` type provides a flag `forcecast` to</span>
    <span class="c1"># cast from a strided array to a contiguous one. But it always casts to a specific</span>
    <span class="c1"># type, e.g. float64. I have no idea how to support multiple types. Therfore,</span>
    <span class="c1"># we have to call NumPy&#39;s `.copy(order=&#39;C&#39;)` to make a new NumPy array. This</span>
    <span class="c1"># function can only be called from Python side (not from PyBind11&#39;s `py::array`</span>
    <span class="c1"># type).</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">flags</span><span class="p">[</span><span class="s1">&#39;C_CONTIGUOUS&#39;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">torch</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">config</span><span class="o">.</span><span class="n">with_pytorch</span><span class="p">():</span>
                <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DriverError</span><span class="p">(</span>
                    <span class="s2">&quot;FreeTensor should be built with WITH_PYTORCH to accept a PyTorch tensor&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">is_contiguous</span><span class="p">():</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">Array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DriverError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported data type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s2"> for Array&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.driver.build_binary" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_binary</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">host_device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.driver.build_binary" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Compile a program using a backend compiler and load it into memory</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>code</strong> (<code>Optional[freetensor.core.codegen.NativeCode]</code>)  Native code generated by <code>codegen</code>. If not specified, a partial
function is returned, which can be used as a decorator</p></li>
            <li><p><strong>device</strong> (<code>Optional[freetensor.core.driver.Device]</code>)  The device to run the program. If omitted, use the default device
in config</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/driver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_binary</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NativeCode</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">host_device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compile a program using a backend compiler and load it into memory</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    code : NativeCode</span>
<span class="sd">        Native code generated by `codegen`. If not specified, a partial</span>
<span class="sd">        function is returned, which can be used as a decorator</span>
<span class="sd">    device : Device (Optional)</span>
<span class="sd">        The device to run the program. If omitted, use the default device</span>
<span class="sd">        in config</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">default_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">target</span><span class="p">()</span> <span class="o">!=</span> <span class="n">code</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DriverError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Codegen target (</span><span class="si">{</span><span class="n">code</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2">) is inconsistent with device target (</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">target</span><span class="p">()</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">Driver</span><span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">code</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">host_device</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">build_binary</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">host_device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">host_device</span><span class="o">=</span><span class="n">host_device</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.expr" class="doc doc-heading">
        <code>expr</code>



<a href="#freetensor.core.expr" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Facility to build AST expressions</p>
<p>Classes and functions in this module are not only used internally for constructing AST nodes,
and also exposed to users via multi-stage programming</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.expr.VarRef" class="doc doc-heading">
        <code>
VarRef            (<span title="freetensor_ffi.FrontendVar">FrontendVar</span>)
        </code>



<a href="#freetensor.core.expr.VarRef" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Variable of FreeTensor</p>
<p>All variables in FreeTensor DSL (declared via <code>Var</code>, created by <code>empty</code> or <code>var</code>,
returned by <code>libop</code>, etc.), and their slices, are <code>VarRef</code> objects. Operations
on <code>VarRef</code> objects generates AST nodes</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">VarRef</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">FrontendVar</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Variable of FreeTensor</span>

<span class="sd">    All variables in FreeTensor DSL (declared via `Var`, created by `empty` or `var`,</span>
<span class="sd">    returned by `libop`, etc.), and their slices, are `VarRef` objects. Operations</span>
<span class="sd">    on `VarRef` objects generates AST nodes</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">vardef</span><span class="p">,</span>
                 <span class="n">full_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
                 <span class="n">dtype</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span>
                 <span class="n">mtype</span><span class="p">:</span> <span class="n">ffi</span><span class="o">.</span><span class="n">MemType</span><span class="p">,</span>
                 <span class="n">indices</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VarRef</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">full_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vardef</span> <span class="o">=</span> <span class="n">vardef</span>

        <span class="kn">from</span> <span class="nn">.stmt</span> <span class="kn">import</span> <span class="n">find_borrowed_vardefs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span> <span class="o">=</span> <span class="n">find_borrowed_vardefs</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">lend_out</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">reclaim</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VarRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vardef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_key</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">VarRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vardef</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_key</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># In standard Python data model, functions like __iadd__</span>
                <span class="c1"># returns the modified self, and __setitem__ does a self-</span>
                <span class="c1"># assignment. We do the augmenting assignment directly</span>
                <span class="c1"># in __iadd__ and return None, so we do not have to do</span>
                <span class="c1"># it again here</span>
                <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
                <span class="n">libop</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">atype</span> <span class="o">==</span> <span class="n">ffi</span><span class="o">.</span><span class="n">AccessType</span><span class="p">(</span><span class="s2">&quot;input&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">InvalidProgram</span><span class="p">(</span><span class="s2">&quot;Cannot modify an </span><span class="se">\&quot;</span><span class="s2">input</span><span class="se">\&quot;</span><span class="s2"> tensor `&quot;</span> <span class="o">+</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;`&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">borrower_cnt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ffi</span><span class="o">.</span><span class="n">InvalidProgram</span><span class="p">(</span>
                <span class="s2">&quot;Cannot modify tensor `&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span>
                <span class="s2">&quot;` becuase it has been borrowed in another tensor&#39;s shape, &quot;</span>
                <span class="s2">&quot;a tensor slice, or a range of a loop&quot;</span><span class="p">)</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
        <span class="n">top</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">as_store</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">(),</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">dim</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">dim</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="n">dim</span> <span class="k">else</span> <span class="n">idx</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_parse_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">is</span> <span class="o">...</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="p">,)</span>
        <span class="n">ffiIdx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">length</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">()):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">start</span> <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">stop</span> <span class="k">if</span> <span class="n">idx</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">length</span>
                <span class="k">assert</span> <span class="n">idx</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">idx</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="n">ffiIdx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">FrontendVarIdx</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">full_shape</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">indices</span><span class="p">):</span>
                    <span class="n">ffiIdx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">FrontendVarIdx</span><span class="p">(</span><span class="n">idx</span><span class="o">.</span><span class="n">as_load</span><span class="p">()))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span>
                        <span class="n">key</span>
                    <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Shape of an index of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> should be 1-D, instead of </span><span class="si">{</span><span class="n">idx</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span>
                        <span class="n">idx</span><span class="o">.</span><span class="n">full_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span> <span class="ow">is</span> <span class="n">ffi</span><span class="o">.</span><span class="n">IntConst</span><span class="p">,</span> <span class="s2">&quot;Dynamic number of dimensions is not supported&quot;</span>
                    <span class="n">ndim</span> <span class="o">=</span> <span class="n">idx</span><span class="o">.</span><span class="n">full_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">val</span>
                    <span class="n">ffiIdx</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="n">ffi</span><span class="o">.</span><span class="n">FrontendVarIdx</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">as_load</span><span class="p">())</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">)</span>
                    <span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ffiIdx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">FrontendVarIdx</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ffiIdx</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">-</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">sub_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">mul_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">/</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">truediv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">truediv_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">//</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">floordiv</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">floordiv_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">%</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__imod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="n">libop</span><span class="o">.</span><span class="n">mod_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
            <span class="k">return</span>  <span class="c1"># Don&#39;t return self. See __setitem__</span>
        <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">ne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span> <span class="o">!=</span> <span class="n">other</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
            <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">neg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_load</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

























































  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.abs" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">abs</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.abs" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Absolute value</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.abs</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The absolute value</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Absolute value</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.abs</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The absolute value</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeAbs</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.add" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.add" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs + rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.add</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The sum</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs + rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.add</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The sum</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">+</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.any" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">any</span><span class="p">()</span></code>


<a href="#freetensor.core.expr.any" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create an AnyExpr node (only for testing)</p>
<p>Any nodes matches any expression nodes in <code>ast.match</code></p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">any</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an AnyExpr node (only for testing)</span>

<span class="sd">    Any nodes matches any expression nodes in `ast.match`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeAnyExpr</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.cast" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cast</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.cast" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Cast to another type</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
            <li><p><strong>dtype</strong> (<code>DataTypr or str</code>)  The target data type</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Cast to another type</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>
<span class="sd">    dtype : DataTypr or str</span>
<span class="sd">        The target data type</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeCast</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.ceil" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceil</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.ceil" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Round a float up to an interger (towards +inf)</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.ceil</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Round a float up to an interger (towards +inf)</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.ceil</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeCeil</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.ceildiv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceildiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.ceildiv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Ceiling integer division of <code>lhs</code> dividing by <code>rhs</code></p>
<p>The result rounds towards positive infinity</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.ceildiv</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The quotient</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ceildiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Ceiling integer division of `lhs` dividing by `rhs`</span>

<span class="sd">    The result rounds towards positive infinity</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.ceildiv</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The quotient</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">ceildiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span> <span class="o">//</span> <span class="n">rhs</span> <span class="o">+</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">%</span> <span class="n">rhs</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeCeilDiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.dtype" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dtype</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.dtype" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Get element data type of a variable</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Get element data type of a variable &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">ffi</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">dtype</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># TODO: Config default type</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">(</span><span class="s2">&quot;float32&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">(</span><span class="s2">&quot;int32&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown scalar type: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">var</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.eq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">eq</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.eq" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs == rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.eq</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs == rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.eq</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">==</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.exp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exp</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.exp" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Natural exponent</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.exp</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The exponent</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Natural exponent</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.exp</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The exponent</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeExp</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.floor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floor</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.floor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Round a float down to an interger (towards -inf)</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.floor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Round a float down to an interger (towards -inf)</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.floor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeFloor</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.floordiv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floordiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.floordiv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Floored integer division of <code>lhs</code> dividing by <code>rhs</code></p>
<p>The result rounds towards negative infinity (following Python convention, instead of C)
This function is recommended over <code>round_towards_0_div</code>, as it enjoys more optimizations</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.floordiv</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The quotient</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">floordiv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Floored integer division of `lhs` dividing by `rhs`</span>

<span class="sd">    The result rounds towards negative infinity (following Python convention, instead of C)</span>
<span class="sd">    This function is recommended over `round_towards_0_div`, as it enjoys more optimizations</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.floordiv</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The quotient</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">//</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.ge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ge</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.ge" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs &gt;= rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.ge</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ge</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs &gt;= rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.ge</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">&gt;=</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.gt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gt</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.gt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs &gt; rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.gt</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">gt</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs &gt; rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.gt</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">&gt;</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.if_then_else" class="doc doc-heading">
<code class="highlight language-python"><span class="n">if_then_else</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">then_case</span><span class="p">,</span> <span class="n">else_case</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.if_then_else" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Similar to <code>then_case if cond else else_case</code></p>
<p>NOTE: there is NO guarantee that only one branch will be executed. In some cases,
both branches will be executed and the result of one of them will be picked.
Therefore, please do NOT use <code>if_then_else</code> to guard an out-of-bound array indexing</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>cond</strong> (<code>VarRef of Number</code>)  Condition</p></li>
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  Then-case experssion</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  Else-case expression</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">if_then_else</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">then_case</span><span class="p">,</span> <span class="n">else_case</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Similar to `then_case if cond else else_case`</span>

<span class="sd">    NOTE: there is NO guarantee that only one branch will be executed. In some cases,</span>
<span class="sd">    both branches will be executed and the result of one of them will be picked.</span>
<span class="sd">    Therefore, please do NOT use `if_then_else` to guard an out-of-bound array indexing</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cond : VarRef of Number</span>
<span class="sd">        Condition</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        Then-case experssion</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        Else-case expression</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cond</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">then_case</span> <span class="k">if</span> <span class="n">cond</span> <span class="k">else</span> <span class="n">else_case</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeIfExpr</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">then_case</span><span class="p">,</span> <span class="n">else_case</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.intrinsic" class="doc doc-heading">
<code class="highlight language-python"><span class="n">intrinsic</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.intrinsic" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Invoke whatever target code</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fmt</strong> (<code>str</code>)  What to run. "%" is filled by parameters one by one. E.g. sinf(%)</p></li>
            <li><p><strong>The following variadic arguments</strong> (<code>Expr</code>)  Parameters to <code>fmt</code></p></li>
            <li><p><strong>ret_type</strong> (<code>DataType or str</code>)  (Keyword argument only) The return type. Void for no return type. Defaults to Void</p></li>
            <li><p><strong>has_side_effect</strong> (<code>bool</code>)  (Keyword argument only) True to indicate the intrinsic modifes something other than the return value. Defaults to false</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">intrinsic</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Invoke whatever target code</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fmt : str</span>
<span class="sd">        What to run. &quot;%&quot; is filled by parameters one by one. E.g. sinf(%)</span>
<span class="sd">    The following variadic arguments : Expr</span>
<span class="sd">        Parameters to `fmt`</span>
<span class="sd">    ret_type : DataType or str</span>
<span class="sd">        (Keyword argument only) The return type. Void for no return type. Defaults to Void</span>
<span class="sd">    has_side_effect: bool</span>
<span class="sd">        (Keyword argument only) True to indicate the intrinsic modifes something other than the return value. Defaults to false</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ret_type</span> <span class="o">=</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">(</span><span class="s2">&quot;void&quot;</span><span class="p">)</span>
    <span class="n">has_side_effect</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="s2">&quot;ret_type&quot;</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
        <span class="n">ret_type</span> <span class="o">=</span> <span class="n">ffi</span><span class="o">.</span><span class="n">DataType</span><span class="p">(</span><span class="n">kws</span><span class="p">[</span><span class="s2">&quot;ret_type&quot;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;ret_type&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s2">&quot;has_side_effect&quot;</span> <span class="ow">in</span> <span class="n">kws</span><span class="p">:</span>
        <span class="n">has_side_effect</span> <span class="o">=</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;has_side_effect&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kws</span><span class="p">[</span><span class="s2">&quot;has_side_effect&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">kws</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Unrecognized keyword arguments: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kws</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeIntrinsic</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">ret_type</span><span class="p">,</span> <span class="n">has_side_effect</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.l_and" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_and</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.l_and" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Logical and of <code>lhs</code> and <code>rhs</code></p>
<p>NOTE: Short-circuit evaluation is NOT supported</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.l_and</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The logical and</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">l_and</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Logical and of `lhs` and `rhs`</span>

<span class="sd">    NOTE: Short-circuit evaluation is NOT supported</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.l_and</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The logical and</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">l_and</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span> <span class="ow">and</span> <span class="n">rhs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeLAnd</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.l_not" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_not</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.l_not" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Logical not</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.l_not</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The logical not</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">l_not</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Logical not</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.l_not</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The logical not</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">l_not</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="n">expr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeLNot</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.l_or" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_or</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.l_or" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Logical or of <code>lhs</code> and <code>rhs</code></p>
<p>NOTE: Short-circuit evaluation is NOT supported</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.l_or</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The logical or</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">l_or</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Logical or of `lhs` and `rhs`</span>

<span class="sd">    NOTE: Short-circuit evaluation is NOT supported</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.l_or</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The logical or</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">l_or</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lhs</span> <span class="ow">or</span> <span class="n">rhs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeLOr</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.le" class="doc doc-heading">
<code class="highlight language-python"><span class="n">le</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.le" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs &lt;= rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.le</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">le</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs &lt;= rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.le</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">&lt;=</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.lt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lt</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.lt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs &lt; rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.lt</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lt</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs &lt; rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.lt</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">&lt;</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.max" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.max" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Maximum of <code>lhs</code> and <code>rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.max</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The maximum</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Maximum of `lhs` and `rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.max</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The maximum</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeMax</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.min" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.min" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Minimum of <code>lhs</code> and <code>rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.min</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The minimum</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Minimum of `lhs` and `rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.min</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The minimum</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">builtins</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeMin</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.mod" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.mod" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs</code> modulus <code>rhs</code></p>
<p>The result is always non-negative (following Python convention, instead of C).
This function is recommended over <code>remainder</code>, as it enjoys more optimizations</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.mod</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The modulo</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mod</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs` modulus `rhs`</span>

<span class="sd">    The result is always non-negative (following Python convention, instead of C).</span>
<span class="sd">    This function is recommended over `remainder`, as it enjoys more optimizations</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.mod</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The modulo</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">%</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.mtype" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mtype</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.mtype" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Get memory type of a variable</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mtype</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Get memory type of a variable &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">mtype</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;byvalue&#39;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.mul" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mul</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.mul" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs * rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.mul</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The product</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs * rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.mul</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The product</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">*</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.ndim" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ndim</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.ndim" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Get the number of dimensions of a variable</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ndim</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Get the number of dimensions of a variable &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">ndim</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.ne" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ne</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.ne" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs != rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.ne</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The comparison</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">ne</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs != rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.ne</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The comparison</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">!=</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.remainder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remainder</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.remainder" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Remainder of <code>lhs</code> dividing <code>rhs</code></p>
<p>The result can be positive or negative (following C convention, instead of Python).
End users are encouraged to use <code>lhs % rhs</code> instead, which follows Python convetion,
and enjoys better optimization in FreeTensor</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.remainder</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The remainder</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">remainder</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Remainder of `lhs` dividing `rhs`</span>

<span class="sd">    The result can be positive or negative (following C convention, instead of Python).</span>
<span class="sd">    End users are encouraged to use `lhs % rhs` instead, which follows Python convetion,</span>
<span class="sd">    and enjoys better optimization in FreeTensor</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.remainder</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The remainder</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">remainder</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeRemainder</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.round_towards_0_div" class="doc doc-heading">
<code class="highlight language-python"><span class="n">round_towards_0_div</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.round_towards_0_div" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>C-style integer division of <code>lhs</code> dividing by <code>rhs</code></p>
<p>The result rounds towards 0 (following C convention, instead of Python)
End users are encouraged to use <code>lhs // rhs</code> instead, which follows Python convetion,
and enjoys better optimization in FreeTensor</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.round_towards_0_div</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The quotient</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">round_towards_0_div</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    C-style integer division of `lhs` dividing by `rhs`</span>

<span class="sd">    The result rounds towards 0 (following C convention, instead of Python)</span>
<span class="sd">    End users are encouraged to use `lhs // rhs` instead, which follows Python convetion,</span>
<span class="sd">    and enjoys better optimization in FreeTensor</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.round_towards_0_div</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The quotient</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">rhs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">round_towards_0_div</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeRoundTowards0Div</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.shape" class="doc doc-heading">
<code class="highlight language-python"><span class="n">shape</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.shape" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>shape(var, i): Get size of specified dimension of a variable</p>
<p>shape(var): Get sizes of all dimensions of a variable</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">shape</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; shape(var, i): Get size of specified dimension of a variable</span>
<span class="sd">        shape(var): Get sizes of all dimensions of a variable &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Getting size of dimension </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> of scalar </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.sigmoid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sigmoid</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.sigmoid" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Sigmoid</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.sigmoid</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sigmoid</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sigmoid</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.sigmoid</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeSigmoid</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.sqrt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.sqrt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Square root</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.sqrt</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The square root</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Square root</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.sqrt</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The square root</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeSqrt</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.square" class="doc doc-heading">
<code class="highlight language-python"><span class="n">square</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.square" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Square</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.square</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The square</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Square</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.square</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The square</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expr</span> <span class="o">*</span> <span class="n">expr</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeSquare</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.sub" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sub</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.sub" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p><code>lhs - rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.sub</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The difference</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `lhs - rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.sub</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The difference</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">-</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.tanh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tanh</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.tanh" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Hyperbolic tangent</p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.tanh</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>expr</strong> (<code>VarRef or Number</code>)  The operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The result</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Hyperbolic tangent</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.tanh</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expr : VarRef or Number</span>
<span class="sd">        The operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The result</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">_istensor</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">libop</span>
        <span class="k">return</span> <span class="n">libop</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeTanh</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.expr.truediv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truediv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span></code>


<a href="#freetensor.core.expr.truediv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Floating point division of <code>lhs</code> dividing by <code>rhs</code></p>
<p>For scalar operands, it emit an expression node in AST. For non-scalar operands,
it calls libop.truediv</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>lhs</strong> (<code>VarRef or Number</code>)  The left-hand-side operand</p></li>
            <li><p><strong>rhs</strong> (<code>VarRef or Number</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef or Number</code>  The quotient</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/expr.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">truediv</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Floating point division of `lhs` dividing by `rhs`</span>

<span class="sd">    For scalar operands, it emit an expression node in AST. For non-scalar operands,</span>
<span class="sd">    it calls libop.truediv</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    lhs : VarRef or Number</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    rhs : VarRef or Number</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef or Number</span>
<span class="sd">        The quotient</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">lhs</span> <span class="o">/</span> <span class="n">rhs</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.frontend" class="doc doc-heading">
        <code>frontend</code>



<a href="#freetensor.core.frontend" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A frontend transforming user Python functions to ASTs via staging.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.FreeTensorOverload" class="doc doc-heading">
        <code>
FreeTensorOverload            (<a class="autorefs autorefs-internal" title="freetensor.core.staging.StagingOverload" href="#freetensor.core.staging.StagingOverload">StagingOverload</a>)
        </code>



<a href="#freetensor.core.frontend.FreeTensorOverload" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Helper class managing context in IR staging.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FreeTensorOverload</span><span class="p">(</span><span class="n">StagingOverload</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Helper class managing context in IR staging.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">NamingScope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LifetimeScope</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closure</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">register_vardef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">name</span><span class="p">,</span>
                        <span class="n">shape</span><span class="p">,</span>
                        <span class="n">dtype</span><span class="p">,</span>
                        <span class="n">atype</span><span class="p">,</span>
                        <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">capture</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">override</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullname</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">override</span> <span class="k">else</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">capture</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">closure</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span> <span class="o">=</span> <span class="n">capture</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">register_inner_scope</span><span class="p">(</span>
            <span class="n">_VarDef</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">register_assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">register_inner_scope</span><span class="p">(</span><span class="n">Assert</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">fullid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Get namespace-prepended full nid of given short nid.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fullname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Get distinct name.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">in_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ndim&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ndim</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;shape&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="n">shape</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;mtype&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">basic_wrapped</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">functiondef_wrapper</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">namespace</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">()</span>
            <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">namespace</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">basic_wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">NamingScope</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">basic_wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">key</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;nid&#39;</span><span class="p">:</span>
            <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;no_deps&#39;</span><span class="p">:</span>
            <span class="n">back</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>

            <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">back</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">back</span><span class="o">.</span><span class="n">f_globals</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> not found for annotating comment (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">)&#39;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
                <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> is not a VarRef, which is required by annotating comment (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">)&#39;</span>
                <span class="p">)</span>
            <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">add_next_no_deps</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;prefer_libs&#39;</span><span class="p">:</span>
            <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_prefer_libs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">lineno</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.allow_shortcut_scope" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.allow_shortcut_scope" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Opens a scope that allows shortcut control flows in a statically deterministic</p>
<p>context. Need to be closed by <code>with</code> statement.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">allow_shortcut_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Opens a scope that allows shortcut control flows in a statically deterministic</span>
<span class="sd">    context. Need to be closed by `with` statement.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">AllowShortcutScope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.assert_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.assert_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Assert staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Assert staging tool.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assert_stmt</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">test</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.assign_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.assign_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized assign wrapper.</p>
<p>If <code>value</code> is instance of <code>StagedAssignable</code>, it's regarded as a customized
assign behavior and gets executed with the assigned target variable name.
This wrapper is used for initializing a variable.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assign_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Customized assign wrapper.</span>
<span class="sd">    If `value` is instance of `StagedAssignable`, it&#39;s regarded as a customized</span>
<span class="sd">    assign behavior and gets executed with the assigned target variable name.</span>
<span class="sd">    This wrapper is used for initializing a variable.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.at_position" class="doc doc-heading">
<code class="highlight language-python"><span class="n">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.at_position" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Code position handler.</p>
<p>Defaults to a no-op.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> (<code>str</code>)  Name of the file containing code for the next statement.</p></li>
            <li><p><strong>lineno</strong> (<code>int</code>)  Line number of the next statement.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">lineno</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.break_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.break_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Break staging tool. Only allow break in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Break staging tool. Only allow break in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Break is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="n">BreakException</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.continue_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.continue_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Continue staging tool. Only allow continue in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Continue staging tool. Only allow continue in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Continue is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="n">ContinueException</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.custom_attr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.custom_attr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized attribute accessor.</p>
<p>The framework first looks for a Python native attribute. If not found, it looks
for this overloaded custom attribute resolver.</p>
<p>The default implementation provides no custom attribute.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>obj</strong> (<code>Any</code>)  Object to access attribute.</p></li>
            <li><p><strong>attr</strong> (<code>str</code>)  Attribute name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>Any</code>  The attribute value.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;ndim&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ndim</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;shape&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">lambda</span> <span class="n">i</span><span class="o">=</span><span class="kc">None</span><span class="p">:</span> <span class="n">shape</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;dtype&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s2">&quot;mtype&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mtype</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.foreach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.foreach" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized foreach wrapper.</p>
<p>If <code>value</code> is instance of <code>StagedIterable</code>, its regarded as a customized foreach
behavior and used to generate code for the python for loop.
Otherwise, we try to execute the loop as usual.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Customized foreach wrapper.</span>
<span class="sd">    If `value` is instance of `StagedIterable`, its regarded as a customized foreach</span>
<span class="sd">    behavior and used to generate code for the python for loop.</span>
<span class="sd">    Otherwise, we try to execute the loop as usual.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">iter</span><span class="p">,</span> <span class="n">StagedIterable</span><span class="p">):</span>
        <span class="nb">iter</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iter_var</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">BreakException</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">ContinueException</span><span class="p">:</span>
                <span class="k">continue</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.fullid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fullid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.fullid" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get namespace-prepended full nid of given short nid.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fullid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Get namespace-prepended full nid of given short nid.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.fullname" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fullname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.fullname" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get distinct name.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fullname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Get distinct name.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">name</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.functiondef_wrapper" class="doc doc-heading">
<code class="highlight language-python"><span class="n">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.functiondef_wrapper" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Function definition wrapper.</p>
<p>This wrapper performs extra initialization and cleanup for function definition.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="n">basic_wrapped</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">functiondef_wrapper</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">namespace</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">()</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">basic_wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">NamingScope</span><span class="p">(</span><span class="n">namespace</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">basic_wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.if_then_else_expr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.if_then_else_expr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>If-then-else expression staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;If-then-else expression staging tool.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_expr</span><span class="p">(</span><span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">then_expr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">else_expr</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.if_then_else_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.if_then_else_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>If-then-else statement staging tool.</p>
<p>When predicate is deterministic in staging, only one branch is generated.
Otherwise, a If node in IR is generated.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;If-then-else statement staging tool.</span>
<span class="sd">    When predicate is deterministic in staging, only one branch is generated.</span>
<span class="sd">    Otherwise, a If node in IR is generated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_stmt</span><span class="p">(</span><span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
            <span class="n">then_body</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">else_body</span><span class="p">:</span>
            <span class="n">else_body</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.load_attr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.load_attr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Load attribute staging tool. Allows customization of reading attributes.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load attribute staging tool. Allows customization of reading attributes.&#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Have to use AttributeError again, since a custom attribute might have</span>
            <span class="c1"># a None value</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">successful</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.FreeTensorOverload.metadata" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metadata handler.</p>
<p>A metadata line is a comment starting with <code>#!</code> and followed by a metadata,
represented as a string parameter.</p>
<p>Defaults to a no-op.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>content</strong> (<code>str</code>)  The metadata content.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;nid&#39;</span><span class="p">:</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullid</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;no_deps&#39;</span><span class="p">:</span>
        <span class="n">back</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">back</span><span class="o">.</span><span class="n">f_locals</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">back</span><span class="o">.</span><span class="n">f_globals</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">back</span><span class="o">.</span><span class="n">f_globals</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> not found for annotating comment (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Variable </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1"> = </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> is not a VarRef, which is required by annotating comment (</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="p">)</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">add_next_no_deps</span><span class="p">(</span><span class="n">var</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;prefer_libs&#39;</span><span class="p">:</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_prefer_libs</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.return_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">funcname</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.return_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Return staging tool. Only allow return in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">funcname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return staging tool. Only allow return in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Return is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">funcname</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">ReturnException</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.FreeTensorOverload.while_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpred</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.FreeTensorOverload.while_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>While statement staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpred</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;While statement staging tool.&#39;&#39;&#39;</span>
    <span class="n">first_pred</span> <span class="o">=</span> <span class="n">fpred</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_pred</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">first_pred</span><span class="o">.</span><span class="n">while_stmt</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">first_pred</span><span class="p">:</span>
            <span class="n">body</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">fpred</span><span class="p">():</span>
            <span class="n">body</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.LifetimeScope" class="doc doc-heading">
        <code>
LifetimeScope        </code>



<a href="#freetensor.core.frontend.LifetimeScope" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>This scope is used to register multiple scopes inside a single lifetime scope.</p>
<p>The inner scopes might be used to register variables, etc.
They will be exited in reverse order of their registration.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LifetimeScope</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;This scope is used to register multiple scopes inside a single lifetime scope.</span>
<span class="sd">    The inner scopes might be used to register variables, etc.</span>
<span class="sd">    They will be exited in reverse order of their registration.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_scopes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_overload</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">scope</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inner_scopes</span><span class="p">):</span>
            <span class="n">scope</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>
        <span class="n">popped</span> <span class="o">=</span> <span class="n">_overload</span><span class="o">.</span><span class="n">lifetime_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">popped</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">_overload</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;LifetimeScope enter/exit not match, must be FILO&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_inner_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inner_scopes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scope</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.PredefinedVarCreator" class="doc doc-heading">
        <code>
PredefinedVarCreator            (<a class="autorefs autorefs-internal" title="freetensor.core.frontend.VarCreator" href="#freetensor.core.frontend.VarCreator">VarCreator</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PredefinedVarCreator</span><span class="p">(</span><span class="n">VarCreator</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">assert</span> <span class="n">ndim</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>

            <span class="n">shape_</span> <span class="o">=</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">assert</span> <span class="n">shape_</span> <span class="o">==</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),)</span> <span class="o">+</span> <span class="n">shape_</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">initializer</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span> <span class="o">=</span> <span class="n">initializer</span>

    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VarRef</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="n">var_slice</span><span class="p">,</span> <span class="n">init_slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">var_slice</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">init_slice</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">init_slice</span><span class="p">):</span>
                    <span class="n">impl</span><span class="p">(</span><span class="n">var_slice</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>

        <span class="n">impl</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.frontend.PredefinedVarCreator.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.PredefinedVarCreator.__class__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator.__class__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.PredefinedVarCreator.__class__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator.__class__.__new__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.PredefinedVarCreator.__class__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator.__class__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.PredefinedVarCreator.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.PredefinedVarCreator.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>






  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.PredefinedVarCreator.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initializer</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.PredefinedVarCreator.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Initialize self.  See help(type(self)) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initializer</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">ndim</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>

        <span class="n">shape_</span> <span class="o">=</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">lst</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">assert</span> <span class="n">shape_</span> <span class="o">==</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),)</span> <span class="o">+</span> <span class="n">shape_</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">get_shape</span><span class="p">(</span><span class="n">initializer</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span> <span class="o">=</span> <span class="n">initializer</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.PredefinedVarCreator.assign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.PredefinedVarCreator.assign" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized assign behavior. Creates a VarDef with its full name.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VarRef</span><span class="p">:</span>
    <span class="n">var</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="n">var_slice</span><span class="p">,</span> <span class="n">init_slice</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_slice</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">var_slice</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">init_slice</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">init_slice</span><span class="p">):</span>
                <span class="n">impl</span><span class="p">(</span><span class="n">var_slice</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">impl</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initializer</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">var</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.Var" class="doc doc-heading">
        <code>
Var            (<a class="autorefs autorefs-internal" title="freetensor.core.staging.StagedTypeAnnotation" href="#freetensor.core.staging.StagedTypeAnnotation">StagedTypeAnnotation</a>)
        </code>



<a href="#freetensor.core.frontend.Var" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Var</span><span class="p">(</span><span class="n">StagedTypeAnnotation</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Declare a variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the variable</span>
<span class="sd">        shape : Sequence[Expr] or Var</span>
<span class="sd">            Shape of the variable. A variable can be created using a literal shape,</span>
<span class="sd">            or another fixed-length VarRef as a shape</span>
<span class="sd">        dtype : str or DataType</span>
<span class="sd">            Data type of the variable</span>
<span class="sd">        atype : str or AccessType</span>
<span class="sd">            Access type of the variable. It specifies whether (and how) the variable</span>
<span class="sd">            is an I/O variable of the function it belongs to. Defaults to &quot;input&quot;</span>
<span class="sd">        mtype : str or MemType (Optional)</span>
<span class="sd">            Memory type of the variable. If omitted, the main memory type of the</span>
<span class="sd">            default Target in config will be used</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">mtype</span>

    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VarRef</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_overload</span><span class="o">.</span><span class="n">register_vardef</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">atype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.frontend.Var.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="abc.ABCMeta">ABCMeta</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedTypeAnnotationMeta</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h6 id="freetensor.core.frontend.Var.__class__.__base__" class="doc doc-heading">
        <code>
__base__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__.__base__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.frontend.Var.__class__.__base__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__.__base__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.frontend.Var.__class__.__base__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__.__base__.__new__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.frontend.Var.__class__.__base__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__.__base__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.frontend.Var.__class__.__base__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.Var.__class__.__base__.register" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.Var.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.Var.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="o">=</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.Var.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Declare a variable</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>name</strong> (<code>str</code>)  Name of the variable</p></li>
            <li><p><strong>shape</strong> (<code>Sequence[Expr] or Var</code>)  Shape of the variable. A variable can be created using a literal shape,
or another fixed-length VarRef as a shape</p></li>
            <li><p><strong>dtype</strong> (<code>str or DataType</code>)  Data type of the variable</p></li>
            <li><p><strong>atype</strong> (<code>str or AccessType</code>)  Access type of the variable. It specifies whether (and how) the variable
is an I/O variable of the function it belongs to. Defaults to "input"</p></li>
            <li><p><strong>mtype</strong> (<code>str or MemType (Optional)</code>)  Memory type of the variable. If omitted, the main memory type of the
default Target in config will be used</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Declare a variable</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of the variable</span>
<span class="sd">    shape : Sequence[Expr] or Var</span>
<span class="sd">        Shape of the variable. A variable can be created using a literal shape,</span>
<span class="sd">        or another fixed-length VarRef as a shape</span>
<span class="sd">    dtype : str or DataType</span>
<span class="sd">        Data type of the variable</span>
<span class="sd">    atype : str or AccessType</span>
<span class="sd">        Access type of the variable. It specifies whether (and how) the variable</span>
<span class="sd">        is an I/O variable of the function it belongs to. Defaults to &quot;input&quot;</span>
<span class="sd">    mtype : str or MemType (Optional)</span>
<span class="sd">        Memory type of the variable. If omitted, the main memory type of the</span>
<span class="sd">        default Target in config will be used</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">atype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span> <span class="o">=</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">atype</span><span class="p">,</span> <span class="n">mtype</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.VarCreator" class="doc doc-heading">
        <code>
VarCreator            (<a class="autorefs autorefs-internal" title="freetensor.core.staging.StagedAssignable" href="#freetensor.core.staging.StagedAssignable">StagedAssignable</a>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#freetensor.core.frontend.VarCreator" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>VarCreator(shape: Union[Sequence, freetensor.core.expr.VarRef], dtype: str, mtype: str)</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">VarCreator</span><span class="p">(</span><span class="n">StagedAssignable</span><span class="p">):</span>
    <span class="n">shape</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">]</span>
    <span class="n">dtype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">mtype</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VarRef</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Customized assign behavior. Creates a VarDef with its full name.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">_overload</span><span class="o">.</span><span class="n">register_vardef</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.frontend.VarCreator.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.frontend.VarCreator.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.VarCreator.__class__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.VarCreator.__class__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.VarCreator.__class__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.frontend.VarCreator.__class__.__new__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.VarCreator.__class__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.VarCreator.__class__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.frontend.VarCreator.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.VarCreator.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>








  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.VarCreator.assign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.VarCreator.assign" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized assign behavior. Creates a VarDef with its full name.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VarRef</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Customized assign behavior. Creates a VarDef with its full name.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">_overload</span><span class="o">.</span><span class="n">register_vardef</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="s1">&#39;cache&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.frontend.dynamic_range" class="doc doc-heading">
        <code>
dynamic_range            (<span title="freetensor.core.staging.StagedIterable">StagedIterable</span>)
        </code>



<a href="#freetensor.core.frontend.dynamic_range" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Dynamic range that generates For loop in IR tree.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">dynamic_range</span><span class="p">(</span><span class="n">StagedIterable</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dynamic range that generates For loop in IR tree.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Initialize a dynamic range.</span>
<span class="sd">        Arguments semantic identical to builtin `range`.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="k">def</span> <span class="nf">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Customized foreach behavior. Creates a For loop.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">StagingError</span><span class="p">(</span>
                <span class="s1">&#39;dynamic_range only supports exactly one target variable&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">_overload</span><span class="o">.</span><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">For</span><span class="p">(</span><span class="n">_overload</span><span class="o">.</span><span class="n">fullname</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">as</span> <span class="n">iter_var</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">LifetimeScope</span><span class="p">():</span>
                    <span class="n">body</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.dynamic_range.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.frontend.dynamic_range.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Initialize a dynamic range.</p>
<p>Arguments semantic identical to builtin <code>range</code>.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Initialize a dynamic range.</span>
<span class="sd">    Arguments semantic identical to builtin `range`.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">start</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.frontend.dynamic_range.foreach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.dynamic_range.foreach" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized foreach behavior. Creates a For loop.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Customized foreach behavior. Creates a For loop.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">StagingError</span><span class="p">(</span>
            <span class="s1">&#39;dynamic_range only supports exactly one target variable&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">_overload</span><span class="o">.</span><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">For</span><span class="p">(</span><span class="n">_overload</span><span class="o">.</span><span class="n">fullname</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">,</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="k">as</span> <span class="n">iter_var</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">LifetimeScope</span><span class="p">():</span>
                <span class="n">body</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.frontend.capture_var" class="doc doc-heading">
<code class="highlight language-python"><span class="n">capture_var</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.capture_var" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Capture external array as tensor variable.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_overload</span><span class="o">.</span><span class="n">in_staging</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">staging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">original</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.frontend.empty" class="doc doc-heading">
<code class="highlight language-python"><span class="n">empty</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.empty" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create an empty variable</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>shape</strong> (<code>Sequence[Expr] or Var</code>)  Shape of the variable. A variable can be created using a literal shape,
or another fixed-length VarRef as a shape</p></li>
            <li><p><strong>dtype</strong> (<code>str or DataType</code>)  Data type of the variable</p></li>
            <li><p><strong>mtype</strong> (<code>str or MemType (Optional)</code>)  Memory type of the variable. If omitted, the main memory type of the
default Target in config will be used</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_overload</span><span class="o">.</span><span class="n">in_staging</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">staging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">original</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.frontend.inline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">inline</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_dynamic_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.inline" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Enable a user function to be called by a transformed function at run time</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Python function</code>)  The user function</p></li>
            <li><p><strong>src</strong> (<code>str (Optional)</code>)  The source code of <code>func</code>. This parameter is only required if the source
code cannot be get automatically, e.g., if <code>func</code> is generated from a <code>exec</code></p></li>
            <li><p><strong>default_dynamic_range</strong> (<code>bool</code>)  If True, the built-in range is replaced with freetensor.dynamic_range.
Defaults to True</p></li>
            <li><p><strong>verbose</strong> (<code>bool</code>)  True to print the generated Python code that is used for transforming</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">inline</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">src</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">fallback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">default_dynamic_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Enable a user function to be called by a transformed function at run time</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : Python function</span>
<span class="sd">        The user function</span>
<span class="sd">    src : str (Optional)</span>
<span class="sd">        The source code of `func`. This parameter is only required if the source</span>
<span class="sd">        code cannot be get automatically, e.g., if `func` is generated from a `exec`</span>
<span class="sd">    default_dynamic_range : bool</span>
<span class="sd">        If True, the built-in range is replaced with freetensor.dynamic_range.</span>
<span class="sd">        Defaults to True</span>
<span class="sd">    verbose : bool</span>
<span class="sd">        True to print the generated Python code that is used for transforming</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">inline</span><span class="p">,</span>
                                 <span class="n">src</span><span class="o">=</span><span class="n">src</span><span class="p">,</span>
                                 <span class="n">fallback</span><span class="o">=</span><span class="n">fallback</span><span class="p">,</span>
                                 <span class="n">default_dynamic_range</span><span class="o">=</span><span class="n">default_dynamic_range</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">extra_locals</span> <span class="o">=</span> <span class="n">_prepare_extra_locals</span><span class="p">(</span><span class="n">default_dynamic_range</span><span class="p">)</span>

    <span class="c1"># Do not initialize _overload here, since `into_staging` does not use the context.</span>
    <span class="c1"># Keep the context as-is to support adding new inline functions during transforming.</span>
    <span class="c1"># Such a case occurs when a transformed function dynamically imports a new inline.</span>
    <span class="n">transformed</span> <span class="o">=</span> <span class="n">_overload</span><span class="o">.</span><span class="n">into_staging</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
                                         <span class="n">extra_locals</span><span class="p">,</span>
                                         <span class="n">src</span><span class="p">,</span>
                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span><span class="n">staged_callable</span><span class="p">(</span><span class="n">transformed</span><span class="p">,</span> <span class="n">fallback</span> <span class="ow">or</span> <span class="n">func</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.frontend.transform" class="doc doc-heading">
<code class="highlight language-python"><span class="n">transform</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_dynamic_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.transform" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Transform a user function to an AST</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Python function</code>)  The user function to transform. If not specified, a partial function will
be returend, which can be used as a decorator</p></li>
            <li><p><strong>default_dynamic_range</strong> (<code>bool</code>)  If True, the built-in range is replaced with freetensor.dynamic_range.
Defaults to True</p></li>
            <li><p><strong>verbose</strong> (<code>int</code>)  0 = print nothing. 1 = print the resulting AST. 2 = 1 + print the generated
Python code that is used for transforming</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_dynamic_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Transform a user function to an AST</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : Python function</span>
<span class="sd">        The user function to transform. If not specified, a partial function will</span>
<span class="sd">        be returend, which can be used as a decorator</span>
<span class="sd">    default_dynamic_range : bool</span>
<span class="sd">        If True, the built-in range is replaced with freetensor.dynamic_range.</span>
<span class="sd">        Defaults to True</span>
<span class="sd">    verbose : int</span>
<span class="sd">        0 = print nothing. 1 = print the resulting AST. 2 = 1 + print the generated</span>
<span class="sd">        Python code that is used for transforming</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span>
                                 <span class="n">default_dynamic_range</span><span class="o">=</span><span class="n">default_dynamic_range</span><span class="p">,</span>
                                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">extra_locals</span> <span class="o">=</span> <span class="n">_prepare_extra_locals</span><span class="p">(</span><span class="n">default_dynamic_range</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>

    <span class="n">staging_func</span> <span class="o">=</span> <span class="n">_overload</span><span class="o">.</span><span class="n">into_staging</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
                                          <span class="n">extra_locals</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Initialize _overload to prepare for staging.</span>
        <span class="n">_overload</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Create a new scope for the function</span>
        <span class="k">with</span> <span class="n">LifetimeScope</span><span class="p">():</span>
            <span class="k">with</span> <span class="n">NamingScope</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
                <span class="c1"># Run staging function with the tensor program arguments&#39; names as parameters</span>
                <span class="n">returns</span> <span class="o">=</span> <span class="n">staging_func</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
                <span class="c1"># Check returned vardefs (if any)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
                    <span class="n">returns</span> <span class="o">=</span> <span class="p">[</span><span class="n">returns</span><span class="p">]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">returns</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">VarRef</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="n">_overload</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s1">&#39;Illegal return at top level, need to be a `VarRef` or a tuple of `VarRef`s&#39;</span>
                            <span class="p">)</span>
                    <span class="n">returns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">returns</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">returns</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">returns</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">_overload</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s1">&#39;Illegal return at top level, need to be a `VarRef` or a tuple of `VarRef`s&#39;</span>
                    <span class="p">)</span>
                <span class="c1"># Set returned vardefs&#39; access type to inout/output according to whether it was an input</span>
                <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">returns</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">atype</span> <span class="o">==</span> <span class="s1">&#39;input&#39;</span> <span class="ow">or</span> <span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">atype</span> <span class="o">==</span> <span class="s1">&#39;inout&#39;</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">set_atype</span><span class="p">(</span><span class="s1">&#39;inout&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">set_atype</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
                <span class="n">returns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">ret</span><span class="o">.</span><span class="n">vardef</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">ret</span> <span class="ow">in</span> <span class="n">returns</span>
                <span class="p">]</span>

                <span class="c1"># Set closure; they are from captured Arrays.</span>
                <span class="n">closure</span> <span class="o">=</span> <span class="n">_overload</span><span class="o">.</span><span class="n">closure</span>
    <span class="k">except</span> <span class="n">StagingError</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="n">TransformError</span><span class="p">:</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_overload</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Exception occurred in staging&#39;</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Despite whether the exception is raised, we need to clean up the ctx_stack</span>
        <span class="n">staged_ast</span> <span class="o">=</span> <span class="n">pop_ast</span><span class="p">()</span>

    <span class="n">staged</span> <span class="o">=</span> <span class="n">Func</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">params</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">closure</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">returns</span><span class="p">,</span>
                  <span class="n">staged_ast</span><span class="p">,</span> <span class="n">closure</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The transformed AST is:&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">staged</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">staged</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.frontend.var" class="doc doc-heading">
<code class="highlight language-python"><span class="n">var</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#freetensor.core.frontend.var" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create an with variable a given initializer</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>initializer</strong> (<code>Sequence[Sequence[...Sequence[Expr]...]]</code>)  (Multi-level of) sequence of expressions. Will be data of the variable</p></li>
            <li><p><strong>shape</strong> (<code>Sequence[Expr] or Var</code>)  Shape of the variable. A variable can be created using a literal shape,
or another fixed-length VarRef as a shape</p></li>
            <li><p><strong>dtype</strong> (<code>str or DataType</code>)  Data type of the variable</p></li>
            <li><p><strong>mtype</strong> (<code>str or MemType (Optional)</code>)  Memory type of the variable. If omitted, the main memory type of the
default Target in config will be used</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/frontend.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">impl</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">_overload</span><span class="o">.</span><span class="n">in_staging</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">staging</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">original</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.optimize" class="doc doc-heading">
        <code>optimize</code>



<a href="#freetensor.core.optimize" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.optimize.optimize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">optimize</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">schedule_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_dynamic_range</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.optimize.optimize" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>An one-click optimization from Python function to binary executable</p>
<p>Usage:</p>
<pre><code>@optimize
def f(...):
    ...
</code></pre>
<p>It is equivalent to:</p>
<pre><code>@build_binary
@codegen
@lower
@transform
def f(...):
    ...
</code></pre>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>func</strong> (<code>Python function or AST</code>)  The user function to optimize. If not specified, a partial function will
be returend, which can be used as a decorator</p></li>
            <li><p><strong>schedule_callback</strong> (<code>Optional[Callable[[freetensor.core.schedule.Schedule], NoneType]]</code>)  Schedule(s) to apply</p></li>
            <li><p><strong>target</strong> (<code>Optional[freetensor.core.driver.Target]</code>)  The target architecture. You don't have to set target if you set device</p></li>
            <li><p><strong>device</strong> (<code>Optional[freetensor.core.driver.Device]</code>)  Where to run the program</p></li>
            <li><p><strong>default_dynamic_range</strong> (<code>bool</code>)  If True, the built-in range is replaced with freetensor.dynamic_range.
Defaults to True</p></li>
            <li><p><strong>verbose</strong> (<code>Optional[int]</code>)  Verbosity level. Can be 0, 1 or 2</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/optimize.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">schedule_callback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Schedule</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Target</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">device</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Device</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">default_dynamic_range</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
             <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    An one-click optimization from Python function to binary executable</span>

<span class="sd">    Usage:</span>

<span class="sd">    ```</span>
<span class="sd">    @optimize</span>
<span class="sd">    def f(...):</span>
<span class="sd">        ...</span>
<span class="sd">    ```</span>

<span class="sd">    It is equivalent to:</span>

<span class="sd">    ```</span>
<span class="sd">    @build_binary</span>
<span class="sd">    @codegen</span>
<span class="sd">    @lower</span>
<span class="sd">    @transform</span>
<span class="sd">    def f(...):</span>
<span class="sd">        ...</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : Python function or AST</span>
<span class="sd">        The user function to optimize. If not specified, a partial function will</span>
<span class="sd">        be returend, which can be used as a decorator</span>
<span class="sd">    schedule_callback : Callable (Optional)</span>
<span class="sd">        Schedule(s) to apply</span>
<span class="sd">    target : Target (Optional)</span>
<span class="sd">        The target architecture. You don&#39;t have to set target if you set device</span>
<span class="sd">    device : Device (Optional)</span>
<span class="sd">        Where to run the program</span>
<span class="sd">    default_dynamic_range : bool</span>
<span class="sd">        If True, the built-in range is replaced with freetensor.dynamic_range.</span>
<span class="sd">        Defaults to True</span>
<span class="sd">    verbose : int (Optional)</span>
<span class="sd">        Verbosity level. Can be 0, 1 or 2</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">target</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">func</span><span class="p">),</span> <span class="n">ffi</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
            <span class="n">ast</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
                            <span class="n">default_dynamic_range</span><span class="o">=</span><span class="n">default_dynamic_range</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ast</span> <span class="o">=</span> <span class="n">func</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">schedule</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">schedule_callback</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">ast</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">codegen</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">exe</span> <span class="o">=</span> <span class="n">build_binary</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exe</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">optimize</span>
        <span class="k">if</span> <span class="n">schedule_callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">schedule_callback</span><span class="o">=</span><span class="n">schedule_callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">device</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.passes" class="doc doc-heading">
        <code>passes</code>



<a href="#freetensor.core.passes" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.passes.lower" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lower</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_passes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.passes.lower" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Lower an AST using a series of passes</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ast</strong> (<code>AST</code>)  The AST to be lowered. Can be a <code>Func</code> or a <code>Stmt</code>. If not specified, a
partial function of <code>lower</code> will be returned, which can be used as a
decorator</p></li>
            <li><p><strong>target</strong> (<code>Optional[freetensor_ffi.Target]</code>)  Lower the AST to a target with target-specific passes, then the AST can
be used for codegen. If not set, use the default Target in Config</p></li>
            <li><p><strong>skip_passes</strong> (<code>Optional[Sequence[str]]</code>)  Skip some pass for testing or debugging. Names in <code>skipPasses</code> are in
underscore_style, as in Python. Please note that some passes will not be
skipped even specified in these parameter, because they are indirectly
called in some other passes</p></li>
            <li><p><strong>verbose</strong> (<code>Optional[int]</code>)  0 = print nothing. 1 = print the lowered AST. 2 = print AST after every
single passes</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/passes.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ffi</span><span class="o">.</span><span class="n">Target</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">skip_passes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Lower an AST using a series of passes</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ast : AST</span>
<span class="sd">        The AST to be lowered. Can be a `Func` or a `Stmt`. If not specified, a</span>
<span class="sd">        partial function of `lower` will be returned, which can be used as a</span>
<span class="sd">        decorator</span>
<span class="sd">    target : Target (Optional)</span>
<span class="sd">        Lower the AST to a target with target-specific passes, then the AST can</span>
<span class="sd">        be used for codegen. If not set, use the default Target in Config</span>
<span class="sd">    skip_passes : Sequence[str] (Optional)</span>
<span class="sd">        Skip some pass for testing or debugging. Names in `skipPasses` are in</span>
<span class="sd">        underscore_style, as in Python. Please note that some passes will not be</span>
<span class="sd">        skipped even specified in these parameter, because they are indirectly</span>
<span class="sd">        called in some other passes</span>
<span class="sd">    verbose : int (Optional)</span>
<span class="sd">        0 = print nothing. 1 = print the lowered AST. 2 = print AST after every</span>
<span class="sd">        single passes</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">ast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                         <span class="nb">set</span><span class="p">()</span> <span class="k">if</span> <span class="n">skip_passes</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">skip_passes</span><span class="p">),</span>
                         <span class="mi">0</span> <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_lower</span> <span class="o">=</span> <span class="n">lower</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_lower</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_lower</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">skip_passes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_lower</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_lower</span><span class="p">,</span> <span class="n">skip_passes</span><span class="o">=</span><span class="n">skip_passes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_lower</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_lower</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lower</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.schedule" class="doc doc-heading">
        <code>schedule</code>



<a href="#freetensor.core.schedule" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.schedule.Schedule" class="doc doc-heading">
        <code>
Schedule            (<span title="freetensor_ffi.Schedule">Schedule</span>)
        </code>



<a href="#freetensor.core.schedule.Schedule" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Schedule</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">Schedule</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ast</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split a loop into two nested loops</span>

<span class="sd">        To fission a loop into two consecutive loops, use `fission` instead</span>

<span class="sd">        Two modes are provided:</span>

<span class="sd">        1. Specify `factor` and leave `nparts` to -1. It will result in an outer</span>
<span class="sd">        loop with length `ceil(n / factor)`, and an inner loop with length</span>
<span class="sd">        `factor`, where `n` is the original loop length added by `shift`. The</span>
<span class="sd">        original iterator `i` will be transformed to `i0 * factor + i1`, where</span>
<span class="sd">        `i0` and `i1` are the iterators of the new outer and inner loops,</span>
<span class="sd">        respectively</span>
<span class="sd">        2. Specify `nparts` and leave `factor` to -1. It will result in an</span>
<span class="sd">        outer loop with length `nparts`, and an inner loop with length `ceil(n /</span>
<span class="sd">        nparts)`, where `n` is the original loop length added by `shift`. The</span>
<span class="sd">        original iterator `i` will be transformed to `i0 * ceil(n / nparts) +</span>
<span class="sd">        i1`, where `i0` and `i1` are the iterators of the new outer and inner</span>
<span class="sd">        loops, respectively</span>

<span class="sd">        Please note that the second mode will introduce an `i0 * ceil(n /</span>
<span class="sd">        nparts)` factor into the program, which cannot be recognized by</span>
<span class="sd">        polyhedral analysis, which may hinder some following schedules. If</span>
<span class="sd">        possible, plese use the first mode, and then reorder the inner and outer</span>
<span class="sd">        loops</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node : str, ID or Stmt</span>
<span class="sd">            The loop to be split</span>
<span class="sd">        factor : int</span>
<span class="sd">            Length of the inner loop. Set to -1 if using `nparts`</span>
<span class="sd">        nparts : int</span>
<span class="sd">            Length of the outer loop. Set to -1 if using `factor`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the loop is not found</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (str, str)</span>
<span class="sd">            (outer loop ID, inner loop ID)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="n">factor</span><span class="p">,</span> <span class="n">nparts</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reorder directly nested loops</span>

<span class="sd">        To swap consecutive loops, use `swap` instead</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order : array like of str, ID or Stmt</span>
<span class="sd">            Vector of loops. The requested order of the loops</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the input is invalid or there are breaking dependencies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">order</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">loop2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge two directly nested loops into one</span>

<span class="sd">        To fuse consecutive loops, use `fuse` instead</span>

<span class="sd">        `parallelize`, `unroll` and `vectorize` properties will be reset on the</span>
<span class="sd">        merged loop</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop1, loop2 : str, ID or Stmt</span>
<span class="sd">            loops to be merged, can be in any order</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the loops are not directly nested</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            ID of the merged loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop1</span><span class="p">),</span> <span class="n">ID</span><span class="p">(</span><span class="n">loop2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">fission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">splitter</span><span class="p">,</span> <span class="n">suffix0</span><span class="o">=</span><span class="s2">&quot;.a&quot;</span><span class="p">,</span> <span class="n">suffix1</span><span class="o">=</span><span class="s2">&quot;.b&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fission a loop into two loops each containing part of the statements, one</span>
<span class="sd">        followed by another</span>

<span class="sd">        To split loop into two nested loops, use `split` instead</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            The loop to be fissioned</span>
<span class="sd">        side : FissionSide</span>
<span class="sd">            If `After`, `splitter` is the last statement of the first loop. If `Before`,</span>
<span class="sd">            `splitter` is the first statement of the second loop</span>
<span class="sd">        splitter : str, ID or Stmt</span>
<span class="sd">            Where to fission the loop</span>
<span class="sd">        suffix0 : str</span>
<span class="sd">            ID suffix of the statements in the first loop, default to &quot;.a&quot;, can be</span>
<span class="sd">            &quot;&quot; for convenience, but cannot be the same with suffix1</span>
<span class="sd">        suffix1 : str</span>
<span class="sd">            ID suffix of the statements in the second loop, default to &quot;.b&quot;, can be</span>
<span class="sd">            &quot;&quot; for convenience, but cannot be the same with suffix0</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if any dependency cannot be resolved</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (map, map)</span>
<span class="sd">            ({old ID -&gt; new ID in 1st loop}, {old ID -&gt; new ID in 2nd loop})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fission</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">ID</span><span class="p">(</span><span class="n">splitter</span><span class="p">),</span>
                                             <span class="n">suffix0</span><span class="p">,</span> <span class="n">suffix1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fuse two directly following loops with the same length into one</span>

<span class="sd">        To merge nested loops into one, use `merge` instead</span>

<span class="sd">        `parallelize`, `unroll` and `vectorize` properties will be reset on the</span>
<span class="sd">        fused loop</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop0 : str, ID or Stmt</span>
<span class="sd">            The leading loop</span>
<span class="sd">        loop1 : str, ID or Stmt, Optional</span>
<span class="sd">            The following loop. If omitted, it will try to find a following loop</span>
<span class="sd">            of `loop0`</span>
<span class="sd">        strict : bool</span>
<span class="sd">            False by default. If set to True, throw an error if unable to determine whether the two loops</span>
<span class="sd">            are of the same length</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the two loops are not directly following, the two loops are not of</span>
<span class="sd">            the same length, or there is any dependency cannot be resolved</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            ID of the result loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">loop1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop0</span><span class="p">),</span> <span class="n">strict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop0</span><span class="p">),</span> <span class="n">ID</span><span class="p">(</span><span class="n">loop1</span><span class="p">),</span> <span class="n">strict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Swap statements in the same block</span>

<span class="sd">        To reorder nested loops, use `reorder` instead</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        order : array like of str, ID or Stmt</span>
<span class="sd">            The statements</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the statements are not found or the dependencies cannot be solved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">order</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unroll a loop and interleave statements from each iteration</span>

<span class="sd">        E.g.</span>

<span class="sd">        ```</span>
<span class="sd">        for i = 0 to 2 {</span>
<span class="sd">        f(i);</span>
<span class="sd">        g(i);</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>

<span class="sd">        will be transformed to be</span>

<span class="sd">        ```</span>
<span class="sd">        f(0);</span>
<span class="sd">        f(1);</span>
<span class="sd">        g(0);</span>
<span class="sd">        g(1);</span>
<span class="sd">        ```</span>

<span class="sd">        Virtual threads in TVM can be implemented via blend</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            The loop being transformed</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the loop is not found, the loop length is not a constant, or</span>
<span class="sd">            the dependencies cannot be solved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cache a variable into a new local variable</span>

<span class="sd">        All needed data will be filled into the cache first, then all reads and</span>
<span class="sd">        writes will be directed to the cache, and finally all needed data will be</span>
<span class="sd">        flushed from the cache</span>

<span class="sd">        Note for reduction: This transformation preserves the computation order.</span>
<span class="sd">        It will transform</span>

<span class="sd">        ```</span>
<span class="sd">        a += x</span>
<span class="sd">        a += y</span>
<span class="sd">        ```</span>

<span class="sd">        to</span>

<span class="sd">        ```</span>
<span class="sd">        a.cache = a + x + y</span>
<span class="sd">        a = a.cache</span>
<span class="sd">        ```</span>

<span class="sd">        If you need a &quot;real&quot; cache for reduction, which reorders the computation,</span>
<span class="sd">        use `cache_reduction` instead</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stmt : str, ID or Stmt</span>
<span class="sd">            The statement or block (e.g. an If or a For) to be modified</span>
<span class="sd">        var : str</span>
<span class="sd">            Name of the variable to be cached</span>
<span class="sd">        mtype : MemType</span>
<span class="sd">            Where to cache</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the ID or name is not found</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (str, str, str, str)</span>
<span class="sd">            (ID of the statement that fills the cache, ID of the statement that</span>
<span class="sd">            flushes from the cache, name of the cache variable, ID of the VarDef</span>
<span class="sd">            node of the cache variable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">cache_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform local reductions (e.g. sum) in a local variable first, and then</span>
<span class="sd">        reduce the local result to the global variable</span>

<span class="sd">        E.g.</span>

<span class="sd">        ```</span>
<span class="sd">        a += x</span>
<span class="sd">        a += y</span>
<span class="sd">        ```</span>

<span class="sd">        will be transformed to be</span>

<span class="sd">        ```</span>
<span class="sd">        a.cache = x + y</span>
<span class="sd">        a += a.cache</span>
<span class="sd">        ```</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stmt : str, ID or Stmt</span>
<span class="sd">            The statement or block (e.g. an If or a For) to be modified</span>
<span class="sd">        var : str</span>
<span class="sd">            Name of the variable to be cached. Only reductions are allowed on</span>
<span class="sd">            `var` in `stmt`. Plain reads or writes are not allowed</span>
<span class="sd">        mtype : MemType</span>
<span class="sd">            Where to cache</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the ID or name is not found, or there are unsupported reads or</span>
<span class="sd">            writes</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (str, str, str, str)</span>
<span class="sd">            (ID of the statement that initialize the cache, ID of the statement</span>
<span class="sd">            that reduces the local result to the global result, name of the</span>
<span class="sd">            cache variable, ID of the VarDef node of the cache variable)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cache_reduction</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span>
                                                     <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change where a variable is stored</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vardef : str, ID or Stmt</span>
<span class="sd">            ID of the VarDef statement of the specific variable</span>
<span class="sd">        mtype : MemType</span>
<span class="sd">            Where the variable should be stored</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the variable is not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_mem_type</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">var_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split a dimension of a variable into two</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vardef : str, ID or Stmt</span>
<span class="sd">            ID of the VarDef statement of the specific variable</span>
<span class="sd">        dim : int</span>
<span class="sd">            which dimension to be split</span>
<span class="sd">        mode : VarSplitMode</span>
<span class="sd">            When the dimension to split is not divisible by `factor` or `nparts`,</span>
<span class="sd">            the resulting shape may become larger. In `FixedSize` mode, the actual</span>
<span class="sd">            buffer size will not be changed, and gurads will be added to prevent</span>
<span class="sd">            out-of-bound accesses. In `RelaxedSize` mode, the buffer size may</span>
<span class="sd">            increase. The `RelaxedSize` mode cannot be applied to I/O variables</span>
<span class="sd">        factor : int</span>
<span class="sd">            Length of the inner (higher no.) dimension. Set to -1 if using `nparts`</span>
<span class="sd">        nparts : int</span>
<span class="sd">            Length of the outer (lower no.) loop. Set to -1 if using `factor`</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the variable or the dimension is not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_split</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span>
                                               <span class="n">nparts</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">var_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge two dimensions of a variable</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vardef : str, ID or Stmt</span>
<span class="sd">            ID of the VarDef statement of the specific variable</span>
<span class="sd">        dim : int</span>
<span class="sd">            Merge the `dim`-th and the `(dim + 1)`-th dimension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_merge</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">var_reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reorder the dimensions of a variable</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vardef : str, ID or Stmt</span>
<span class="sd">            ID of the VarDef statement of the specific variable</span>
<span class="sd">        order : array like of str, ID or Stmt</span>
<span class="sd">            Vector of integers. The new order of the dimensions</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the variable or the order is illegal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_reorder</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move a statement to a new position</span>

<span class="sd">        This is a composite schedule command, which is implemented with other</span>
<span class="sd">        commands</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stmt : str, ID or Stmt</span>
<span class="sd">            The statement to be moved</span>
<span class="sd">        side : MoveToSide</span>
<span class="sd">            Whether `stmt` will be BEFORE or AFTER `dst</span>
<span class="sd">        dst : str, ID or Stmt</span>
<span class="sd">            Insert `stmt` to be directly after this statement</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if there is no feasible path to move</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The new ID of stmt</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">ID</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">inline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a variable. When the variable is used, recompute its value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vardef : str, ID or Stmt</span>
<span class="sd">            The VarDef statement of the specific variable. It can not be an</span>
<span class="sd">            I/O varible</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the variable cannot be completely removed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">parallel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mark a loop with a parallel implementation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            The loop</span>
<span class="sd">        parallel : ParallelScope</span>
<span class="sd">            Parallel scope</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">ParallelScope</span><span class="p">(</span><span class="n">parallel</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Unroll a loop</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            ID of the loop</span>
<span class="sd">        immediate : bool</span>
<span class="sd">            If false (by default), postpone the unroll procedure to the backend</span>
<span class="sd">            compiler, which saves scheduling time. If true, unroll the loop</span>
<span class="sd">            immediately, which may help further simplifications based on the</span>
<span class="sd">            unrolled result. If your purpose is just to fill the instruction cache,</span>
<span class="sd">            set it to false. If you are unrolling a loop that computes array indices,</span>
<span class="sd">            set it to true</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the loop is not found or length of the loop is not a constant</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">unroll</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">immediate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Vectorize a loop</span>

<span class="sd">        Please note that, as vectorization is different from architecture to</span>
<span class="sd">        achitecture, the scheduler may or may not postpone it to the backend</span>
<span class="sd">        compiler. The vectorization is a best-effort schedule</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            ID of the loop</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the ID or name is not found, or the dependency requirement is</span>
<span class="sd">            not met</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">separate_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noDuplicateVarDefs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Seperate main iterations and tail iterations of a loop</span>

<span class="sd">        E.g.</span>

<span class="sd">        ```</span>
<span class="sd">        for i = 0 -&gt; 3 {</span>
<span class="sd">          for j = 0 -&gt; 4 {</span>
<span class="sd">             if (i * 4 + j &lt; 10) {</span>
<span class="sd">               ...</span>
<span class="sd">             }</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>

<span class="sd">        Each loop will be separated into 2 parts: the body and the tail. After</span>
<span class="sd">        simplification, the program will finally be transformed to</span>

<span class="sd">        ```</span>
<span class="sd">        for i = 0 -&gt; 2 {</span>
<span class="sd">          for j = 0 -&gt; 4 {</span>
<span class="sd">            ...</span>
<span class="sd">          }</span>
<span class="sd">        }</span>
<span class="sd">        for j = 0 -&gt; 2 {</span>
<span class="sd">          ...</span>
<span class="sd">        }</span>
<span class="sd">        ```</span>

<span class="sd">        Ideally, all programs can benefit from this schedule. However, this</span>
<span class="sd">        schedule may greatly increase the program size and make the compiling</span>
<span class="sd">        time way too long. Therefore, this transformation is implemented as a</span>
<span class="sd">        schedule, which can be applied optionally. (TODO: Optionally apply this</span>
<span class="sd">        schedule to part of the program)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        noDuplicateVarDefs : bool</span>
<span class="sd">            If there is two VarDef nodes in two branches, it may result in doubled</span>
<span class="sd">            memory use, since different thread may go to different branch.</span>
<span class="sd">            Set this parameter to true to stop duplicating VarDef nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">separate_tail</span><span class="p">(</span><span class="n">noDuplicateVarDefs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_matmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transform nested loops to be a external call to a matrix multiplication</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loop : str, ID or Stmt</span>
<span class="sd">            ID of the loop</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        InvalidSchedule</span>
<span class="sd">            if the loop cannot be transformed to be a matrix multiplication</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">as_matmul</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">auto_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatic scheduling using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_schedule</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_use_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatically use external libs using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_use_lib</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatically fuse consecutive loops using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_fuse</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatically parallelize some loops using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_parallelize</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatically set memory types using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_set_mem_type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">auto_unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (Experimental) Automatically unroll loops using some heuristics</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        target : Target</span>
<span class="sd">            Target architecture</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_unroll</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">











  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.as_matmul" class="doc doc-heading">
<code class="highlight language-python"><span class="n">as_matmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.as_matmul" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Transform nested loops to be a external call to a matrix multiplication</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  ID of the loop</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the loop cannot be transformed to be a matrix multiplication</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">as_matmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform nested loops to be a external call to a matrix multiplication</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        ID of the loop</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the loop cannot be transformed to be a matrix multiplication</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">as_matmul</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_fuse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_fuse" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatically fuse consecutive loops using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatically fuse consecutive loops using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_fuse</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_parallelize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_parallelize" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatically parallelize some loops using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatically parallelize some loops using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_parallelize</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_schedule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_schedule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatic scheduling using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatic scheduling using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_schedule</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_set_mem_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_set_mem_type" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatically set memory types using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatically set memory types using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_set_mem_type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_unroll" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_unroll" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatically unroll loops using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatically unroll loops using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_unroll</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.auto_use_lib" class="doc doc-heading">
<code class="highlight language-python"><span class="n">auto_use_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.auto_use_lib" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>(Experimental) Automatically use external libs using some heuristics</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>target</strong> (<code>Target</code>)  Target architecture</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">auto_use_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    (Experimental) Automatically use external libs using some heuristics</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    target : Target</span>
<span class="sd">        Target architecture</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">auto_use_lib</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.blend" class="doc doc-heading">
<code class="highlight language-python"><span class="n">blend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.blend" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Unroll a loop and interleave statements from each iteration</p>
<p>E.g.</p>
<pre><code>for i = 0 to 2 {
f(i);
g(i);
}
</code></pre>
<p>will be transformed to be</p>
<pre><code>f(0);
f(1);
g(0);
g(1);
</code></pre>
<p>Virtual threads in TVM can be implemented via blend</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  The loop being transformed</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the loop is not found, the loop length is not a constant, or
the dependencies cannot be solved</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">blend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unroll a loop and interleave statements from each iteration</span>

<span class="sd">    E.g.</span>

<span class="sd">    ```</span>
<span class="sd">    for i = 0 to 2 {</span>
<span class="sd">    f(i);</span>
<span class="sd">    g(i);</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>

<span class="sd">    will be transformed to be</span>

<span class="sd">    ```</span>
<span class="sd">    f(0);</span>
<span class="sd">    f(1);</span>
<span class="sd">    g(0);</span>
<span class="sd">    g(1);</span>
<span class="sd">    ```</span>

<span class="sd">    Virtual threads in TVM can be implemented via blend</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        The loop being transformed</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the loop is not found, the loop length is not a constant, or</span>
<span class="sd">        the dependencies cannot be solved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">blend</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.cache" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.cache" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Cache a variable into a new local variable</p>
<p>All needed data will be filled into the cache first, then all reads and
writes will be directed to the cache, and finally all needed data will be
flushed from the cache</p>
<p>Note for reduction: This transformation preserves the computation order.
It will transform</p>
<pre><code>a += x
a += y
</code></pre>
<p>to</p>
<pre><code>a.cache = a + x + y
a = a.cache
</code></pre>
<p>If you need a "real" cache for reduction, which reorders the computation,
use <code>cache_reduction</code> instead</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>stmt</strong> (<code>str, ID or Stmt</code>)  The statement or block (e.g. an If or a For) to be modified</p></li>
            <li><p><strong>var</strong> (<code>str</code>)  Name of the variable to be cached</p></li>
            <li><p><strong>mtype</strong> (<code>MemType</code>)  Where to cache</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the ID or name is not found</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>(str, str, str, str)</code>  (ID of the statement that fills the cache, ID of the statement that
flushes from the cache, name of the cache variable, ID of the VarDef
node of the cache variable)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cache a variable into a new local variable</span>

<span class="sd">    All needed data will be filled into the cache first, then all reads and</span>
<span class="sd">    writes will be directed to the cache, and finally all needed data will be</span>
<span class="sd">    flushed from the cache</span>

<span class="sd">    Note for reduction: This transformation preserves the computation order.</span>
<span class="sd">    It will transform</span>

<span class="sd">    ```</span>
<span class="sd">    a += x</span>
<span class="sd">    a += y</span>
<span class="sd">    ```</span>

<span class="sd">    to</span>

<span class="sd">    ```</span>
<span class="sd">    a.cache = a + x + y</span>
<span class="sd">    a = a.cache</span>
<span class="sd">    ```</span>

<span class="sd">    If you need a &quot;real&quot; cache for reduction, which reorders the computation,</span>
<span class="sd">    use `cache_reduction` instead</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stmt : str, ID or Stmt</span>
<span class="sd">        The statement or block (e.g. an If or a For) to be modified</span>
<span class="sd">    var : str</span>
<span class="sd">        Name of the variable to be cached</span>
<span class="sd">    mtype : MemType</span>
<span class="sd">        Where to cache</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the ID or name is not found</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (str, str, str, str)</span>
<span class="sd">        (ID of the statement that fills the cache, ID of the statement that</span>
<span class="sd">        flushes from the cache, name of the cache variable, ID of the VarDef</span>
<span class="sd">        node of the cache variable)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cache</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span> <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.cache_reduction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cache_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.cache_reduction" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Perform local reductions (e.g. sum) in a local variable first, and then</p>
<p>reduce the local result to the global variable</p>
<p>E.g.</p>
<pre><code>a += x
a += y
</code></pre>
<p>will be transformed to be</p>
<pre><code>a.cache = x + y
a += a.cache
</code></pre>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>stmt</strong> (<code>str, ID or Stmt</code>)  The statement or block (e.g. an If or a For) to be modified</p></li>
            <li><p><strong>var</strong> (<code>str</code>)  Name of the variable to be cached. Only reductions are allowed on
<code>var</code> in <code>stmt</code>. Plain reads or writes are not allowed</p></li>
            <li><p><strong>mtype</strong> (<code>MemType</code>)  Where to cache</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the ID or name is not found, or there are unsupported reads or
writes</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>(str, str, str, str)</code>  (ID of the statement that initialize the cache, ID of the statement
that reduces the local result to the global result, name of the
cache variable, ID of the VarDef node of the cache variable)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">cache_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform local reductions (e.g. sum) in a local variable first, and then</span>
<span class="sd">    reduce the local result to the global variable</span>

<span class="sd">    E.g.</span>

<span class="sd">    ```</span>
<span class="sd">    a += x</span>
<span class="sd">    a += y</span>
<span class="sd">    ```</span>

<span class="sd">    will be transformed to be</span>

<span class="sd">    ```</span>
<span class="sd">    a.cache = x + y</span>
<span class="sd">    a += a.cache</span>
<span class="sd">    ```</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stmt : str, ID or Stmt</span>
<span class="sd">        The statement or block (e.g. an If or a For) to be modified</span>
<span class="sd">    var : str</span>
<span class="sd">        Name of the variable to be cached. Only reductions are allowed on</span>
<span class="sd">        `var` in `stmt`. Plain reads or writes are not allowed</span>
<span class="sd">    mtype : MemType</span>
<span class="sd">        Where to cache</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the ID or name is not found, or there are unsupported reads or</span>
<span class="sd">        writes</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (str, str, str, str)</span>
<span class="sd">        (ID of the statement that initialize the cache, ID of the statement</span>
<span class="sd">        that reduces the local result to the global result, name of the</span>
<span class="sd">        cache variable, ID of the VarDef node of the cache variable)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">cache_reduction</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">var</span><span class="p">,</span>
                                                 <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.fission" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">splitter</span><span class="p">,</span> <span class="n">suffix0</span><span class="o">=</span><span class="s1">&#39;.a&#39;</span><span class="p">,</span> <span class="n">suffix1</span><span class="o">=</span><span class="s1">&#39;.b&#39;</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.fission" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Fission a loop into two loops each containing part of the statements, one</p>
<p>followed by another</p>
<p>To split loop into two nested loops, use <code>split</code> instead</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  The loop to be fissioned</p></li>
            <li><p><strong>side</strong> (<code>FissionSide</code>)  If <code>After</code>, <code>splitter</code> is the last statement of the first loop. If <code>Before</code>,
<code>splitter</code> is the first statement of the second loop</p></li>
            <li><p><strong>splitter</strong> (<code>str, ID or Stmt</code>)  Where to fission the loop</p></li>
            <li><p><strong>suffix0</strong> (<code>str</code>)  ID suffix of the statements in the first loop, default to ".a", can be
"" for convenience, but cannot be the same with suffix1</p></li>
            <li><p><strong>suffix1</strong> (<code>str</code>)  ID suffix of the statements in the second loop, default to ".b", can be
"" for convenience, but cannot be the same with suffix0</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if any dependency cannot be resolved</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>(map, map)</code>  ({old ID -&gt; new ID in 1st loop}, {old ID -&gt; new ID in 2nd loop})</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">splitter</span><span class="p">,</span> <span class="n">suffix0</span><span class="o">=</span><span class="s2">&quot;.a&quot;</span><span class="p">,</span> <span class="n">suffix1</span><span class="o">=</span><span class="s2">&quot;.b&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fission a loop into two loops each containing part of the statements, one</span>
<span class="sd">    followed by another</span>

<span class="sd">    To split loop into two nested loops, use `split` instead</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        The loop to be fissioned</span>
<span class="sd">    side : FissionSide</span>
<span class="sd">        If `After`, `splitter` is the last statement of the first loop. If `Before`,</span>
<span class="sd">        `splitter` is the first statement of the second loop</span>
<span class="sd">    splitter : str, ID or Stmt</span>
<span class="sd">        Where to fission the loop</span>
<span class="sd">    suffix0 : str</span>
<span class="sd">        ID suffix of the statements in the first loop, default to &quot;.a&quot;, can be</span>
<span class="sd">        &quot;&quot; for convenience, but cannot be the same with suffix1</span>
<span class="sd">    suffix1 : str</span>
<span class="sd">        ID suffix of the statements in the second loop, default to &quot;.b&quot;, can be</span>
<span class="sd">        &quot;&quot; for convenience, but cannot be the same with suffix0</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if any dependency cannot be resolved</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (map, map)</span>
<span class="sd">        ({old ID -&gt; new ID in 1st loop}, {old ID -&gt; new ID in 2nd loop})</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fission</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">ID</span><span class="p">(</span><span class="n">splitter</span><span class="p">),</span>
                                         <span class="n">suffix0</span><span class="p">,</span> <span class="n">suffix1</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.fuse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.fuse" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Fuse two directly following loops with the same length into one</p>
<p>To merge nested loops into one, use <code>merge</code> instead</p>
<p><code>parallelize</code>, <code>unroll</code> and <code>vectorize</code> properties will be reset on the
fused loop</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop0</strong> (<code>str, ID or Stmt</code>)  The leading loop</p></li>
            <li><p><strong>loop1</strong> (<code>str, ID or Stmt, Optional</code>)  The following loop. If omitted, it will try to find a following loop
of <code>loop0</code></p></li>
            <li><p><strong>strict</strong> (<code>bool</code>)  False by default. If set to True, throw an error if unable to determine whether the two loops
are of the same length</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the two loops are not directly following, the two loops are not of
the same length, or there is any dependency cannot be resolved</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>str</code>  ID of the result loop</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop0</span><span class="p">,</span> <span class="n">loop1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fuse two directly following loops with the same length into one</span>

<span class="sd">    To merge nested loops into one, use `merge` instead</span>

<span class="sd">    `parallelize`, `unroll` and `vectorize` properties will be reset on the</span>
<span class="sd">    fused loop</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop0 : str, ID or Stmt</span>
<span class="sd">        The leading loop</span>
<span class="sd">    loop1 : str, ID or Stmt, Optional</span>
<span class="sd">        The following loop. If omitted, it will try to find a following loop</span>
<span class="sd">        of `loop0`</span>
<span class="sd">    strict : bool</span>
<span class="sd">        False by default. If set to True, throw an error if unable to determine whether the two loops</span>
<span class="sd">        are of the same length</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the two loops are not directly following, the two loops are not of</span>
<span class="sd">        the same length, or there is any dependency cannot be resolved</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        ID of the result loop</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">loop1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop0</span><span class="p">),</span> <span class="n">strict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fuse</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop0</span><span class="p">),</span> <span class="n">ID</span><span class="p">(</span><span class="n">loop1</span><span class="p">),</span> <span class="n">strict</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.inline" class="doc doc-heading">
<code class="highlight language-python"><span class="n">inline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.inline" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Remove a variable. When the variable is used, recompute its value</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>vardef</strong> (<code>str, ID or Stmt</code>)  The VarDef statement of the specific variable. It can not be an
I/O varible</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the variable cannot be completely removed</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">inline</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a variable. When the variable is used, recompute its value</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vardef : str, ID or Stmt</span>
<span class="sd">        The VarDef statement of the specific variable. It can not be an</span>
<span class="sd">        I/O varible</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the variable cannot be completely removed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.merge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">loop2</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.merge" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Merge two directly nested loops into one</p>
<p>To fuse consecutive loops, use <code>fuse</code> instead</p>
<p><code>parallelize</code>, <code>unroll</code> and <code>vectorize</code> properties will be reset on the
merged loop</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop1, loop2</strong> (<code>str, ID or Stmt</code>)  loops to be merged, can be in any order</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the loops are not directly nested</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>str</code>  ID of the merged loop</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop1</span><span class="p">,</span> <span class="n">loop2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge two directly nested loops into one</span>

<span class="sd">    To fuse consecutive loops, use `fuse` instead</span>

<span class="sd">    `parallelize`, `unroll` and `vectorize` properties will be reset on the</span>
<span class="sd">    merged loop</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop1, loop2 : str, ID or Stmt</span>
<span class="sd">        loops to be merged, can be in any order</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the loops are not directly nested</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        ID of the merged loop</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop1</span><span class="p">),</span> <span class="n">ID</span><span class="p">(</span><span class="n">loop2</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.move_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.move_to" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Move a statement to a new position</p>
<p>This is a composite schedule command, which is implemented with other
commands</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>stmt</strong> (<code>str, ID or Stmt</code>)  The statement to be moved</p></li>
            <li><p><strong>side</strong> (<code>MoveToSide</code>)  Whether <code>stmt</code> will be BEFORE or AFTER `dst</p></li>
            <li><p><strong>dst</strong> (<code>str, ID or Stmt</code>)  Insert <code>stmt</code> to be directly after this statement</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if there is no feasible path to move</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>str</code>  The new ID of stmt</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stmt</span><span class="p">,</span> <span class="n">side</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move a statement to a new position</span>

<span class="sd">    This is a composite schedule command, which is implemented with other</span>
<span class="sd">    commands</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    stmt : str, ID or Stmt</span>
<span class="sd">        The statement to be moved</span>
<span class="sd">    side : MoveToSide</span>
<span class="sd">        Whether `stmt` will be BEFORE or AFTER `dst</span>
<span class="sd">    dst : str, ID or Stmt</span>
<span class="sd">        Insert `stmt` to be directly after this statement</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if there is no feasible path to move</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The new ID of stmt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">stmt</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">ID</span><span class="p">(</span><span class="n">dst</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.parallelize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">parallel</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.parallelize" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Mark a loop with a parallel implementation</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  The loop</p></li>
            <li><p><strong>parallel</strong> (<code>ParallelScope</code>)  Parallel scope</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">parallelize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">parallel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark a loop with a parallel implementation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        The loop</span>
<span class="sd">    parallel : ParallelScope</span>
<span class="sd">        Parallel scope</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">ParallelScope</span><span class="p">(</span><span class="n">parallel</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.reorder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.reorder" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Reorder directly nested loops</p>
<p>To swap consecutive loops, use <code>swap</code> instead</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>order</strong> (<code>array like of str, ID or Stmt</code>)  Vector of loops. The requested order of the loops</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the input is invalid or there are breaking dependencies</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reorder directly nested loops</span>

<span class="sd">    To swap consecutive loops, use `swap` instead</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    order : array like of str, ID or Stmt</span>
<span class="sd">        Vector of loops. The requested order of the loops</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the input is invalid or there are breaking dependencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">order</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.separate_tail" class="doc doc-heading">
<code class="highlight language-python"><span class="n">separate_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noDuplicateVarDefs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.separate_tail" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Seperate main iterations and tail iterations of a loop</p>
<p>E.g.</p>
<pre><code>for i = 0 -&gt; 3 {
  for j = 0 -&gt; 4 {
     if (i * 4 + j &lt; 10) {
       ...
     }
  }
}
</code></pre>
<p>Each loop will be separated into 2 parts: the body and the tail. After
simplification, the program will finally be transformed to</p>
<pre><code>for i = 0 -&gt; 2 {
  for j = 0 -&gt; 4 {
    ...
  }
}
for j = 0 -&gt; 2 {
  ...
}
</code></pre>
<p>Ideally, all programs can benefit from this schedule. However, this
schedule may greatly increase the program size and make the compiling
time way too long. Therefore, this transformation is implemented as a
schedule, which can be applied optionally. (TODO: Optionally apply this
schedule to part of the program)</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>noDuplicateVarDefs</strong> (<code>bool</code>)  If there is two VarDef nodes in two branches, it may result in doubled
memory use, since different thread may go to different branch.
Set this parameter to true to stop duplicating VarDef nodes.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">separate_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noDuplicateVarDefs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Seperate main iterations and tail iterations of a loop</span>

<span class="sd">    E.g.</span>

<span class="sd">    ```</span>
<span class="sd">    for i = 0 -&gt; 3 {</span>
<span class="sd">      for j = 0 -&gt; 4 {</span>
<span class="sd">         if (i * 4 + j &lt; 10) {</span>
<span class="sd">           ...</span>
<span class="sd">         }</span>
<span class="sd">      }</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>

<span class="sd">    Each loop will be separated into 2 parts: the body and the tail. After</span>
<span class="sd">    simplification, the program will finally be transformed to</span>

<span class="sd">    ```</span>
<span class="sd">    for i = 0 -&gt; 2 {</span>
<span class="sd">      for j = 0 -&gt; 4 {</span>
<span class="sd">        ...</span>
<span class="sd">      }</span>
<span class="sd">    }</span>
<span class="sd">    for j = 0 -&gt; 2 {</span>
<span class="sd">      ...</span>
<span class="sd">    }</span>
<span class="sd">    ```</span>

<span class="sd">    Ideally, all programs can benefit from this schedule. However, this</span>
<span class="sd">    schedule may greatly increase the program size and make the compiling</span>
<span class="sd">    time way too long. Therefore, this transformation is implemented as a</span>
<span class="sd">    schedule, which can be applied optionally. (TODO: Optionally apply this</span>
<span class="sd">    schedule to part of the program)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    noDuplicateVarDefs : bool</span>
<span class="sd">        If there is two VarDef nodes in two branches, it may result in doubled</span>
<span class="sd">        memory use, since different thread may go to different branch.</span>
<span class="sd">        Set this parameter to true to stop duplicating VarDef nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">separate_tail</span><span class="p">(</span><span class="n">noDuplicateVarDefs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.set_mem_type" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.set_mem_type" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Change where a variable is stored</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>vardef</strong> (<code>str, ID or Stmt</code>)  ID of the VarDef statement of the specific variable</p></li>
            <li><p><strong>mtype</strong> (<code>MemType</code>)  Where the variable should be stored</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the variable is not found</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_mem_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">mtype</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Change where a variable is stored</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vardef : str, ID or Stmt</span>
<span class="sd">        ID of the VarDef statement of the specific variable</span>
<span class="sd">    mtype : MemType</span>
<span class="sd">        Where the variable should be stored</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the variable is not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_mem_type</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">MemType</span><span class="p">(</span><span class="n">mtype</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.split" class="doc doc-heading">
<code class="highlight language-python"><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.split" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Split a loop into two nested loops</p>
<p>To fission a loop into two consecutive loops, use <code>fission</code> instead</p>
<p>Two modes are provided:</p>
<ol>
<li>Specify <code>factor</code> and leave <code>nparts</code> to -1. It will result in an outer
loop with length <code>ceil(n / factor)</code>, and an inner loop with length
<code>factor</code>, where <code>n</code> is the original loop length added by <code>shift</code>. The
original iterator <code>i</code> will be transformed to <code>i0 * factor + i1</code>, where
<code>i0</code> and <code>i1</code> are the iterators of the new outer and inner loops,
respectively</li>
<li>Specify <code>nparts</code> and leave <code>factor</code> to -1. It will result in an
outer loop with length <code>nparts</code>, and an inner loop with length <code>ceil(n /
nparts)</code>, where <code>n</code> is the original loop length added by <code>shift</code>. The
original iterator <code>i</code> will be transformed to <code>i0 * ceil(n / nparts) +
i1</code>, where <code>i0</code> and <code>i1</code> are the iterators of the new outer and inner
loops, respectively</li>
</ol>
<p>Please note that the second mode will introduce an <code>i0 * ceil(n /
nparts)</code> factor into the program, which cannot be recognized by
polyhedral analysis, which may hinder some following schedules. If
possible, plese use the first mode, and then reorder the inner and outer
loops</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>node</strong> (<code>str, ID or Stmt</code>)  The loop to be split</p></li>
            <li><p><strong>factor</strong> (<code>int</code>)  Length of the inner loop. Set to -1 if using <code>nparts</code></p></li>
            <li><p><strong>nparts</strong> (<code>int</code>)  Length of the outer loop. Set to -1 if using <code>factor</code></p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the loop is not found</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>(str, str)</code>  (outer loop ID, inner loop ID)</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split a loop into two nested loops</span>

<span class="sd">    To fission a loop into two consecutive loops, use `fission` instead</span>

<span class="sd">    Two modes are provided:</span>

<span class="sd">    1. Specify `factor` and leave `nparts` to -1. It will result in an outer</span>
<span class="sd">    loop with length `ceil(n / factor)`, and an inner loop with length</span>
<span class="sd">    `factor`, where `n` is the original loop length added by `shift`. The</span>
<span class="sd">    original iterator `i` will be transformed to `i0 * factor + i1`, where</span>
<span class="sd">    `i0` and `i1` are the iterators of the new outer and inner loops,</span>
<span class="sd">    respectively</span>
<span class="sd">    2. Specify `nparts` and leave `factor` to -1. It will result in an</span>
<span class="sd">    outer loop with length `nparts`, and an inner loop with length `ceil(n /</span>
<span class="sd">    nparts)`, where `n` is the original loop length added by `shift`. The</span>
<span class="sd">    original iterator `i` will be transformed to `i0 * ceil(n / nparts) +</span>
<span class="sd">    i1`, where `i0` and `i1` are the iterators of the new outer and inner</span>
<span class="sd">    loops, respectively</span>

<span class="sd">    Please note that the second mode will introduce an `i0 * ceil(n /</span>
<span class="sd">    nparts)` factor into the program, which cannot be recognized by</span>
<span class="sd">    polyhedral analysis, which may hinder some following schedules. If</span>
<span class="sd">    possible, plese use the first mode, and then reorder the inner and outer</span>
<span class="sd">    loops</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node : str, ID or Stmt</span>
<span class="sd">        The loop to be split</span>
<span class="sd">    factor : int</span>
<span class="sd">        Length of the inner loop. Set to -1 if using `nparts`</span>
<span class="sd">    nparts : int</span>
<span class="sd">        Length of the outer loop. Set to -1 if using `factor`</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the loop is not found</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    (str, str)</span>
<span class="sd">        (outer loop ID, inner loop ID)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="n">factor</span><span class="p">,</span> <span class="n">nparts</span><span class="p">,</span> <span class="n">shift</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.swap" class="doc doc-heading">
<code class="highlight language-python"><span class="n">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.swap" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Swap statements in the same block</p>
<p>To reorder nested loops, use <code>reorder</code> instead</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>order</strong> (<code>array like of str, ID or Stmt</code>)  The statements</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the statements are not found or the dependencies cannot be solved</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">swap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Swap statements in the same block</span>

<span class="sd">    To reorder nested loops, use `reorder` instead</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    order : array like of str, ID or Stmt</span>
<span class="sd">        The statements</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the statements are not found or the dependencies cannot be solved</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">order</span><span class="p">)))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.unroll" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.unroll" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Unroll a loop</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  ID of the loop</p></li>
            <li><p><strong>immediate</strong> (<code>bool</code>)  If false (by default), postpone the unroll procedure to the backend
compiler, which saves scheduling time. If true, unroll the loop
immediately, which may help further simplifications based on the
unrolled result. If your purpose is just to fill the instruction cache,
set it to false. If you are unrolling a loop that computes array indices,
set it to true</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the loop is not found or length of the loop is not a constant</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">unroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">,</span> <span class="n">immediate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unroll a loop</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        ID of the loop</span>
<span class="sd">    immediate : bool</span>
<span class="sd">        If false (by default), postpone the unroll procedure to the backend</span>
<span class="sd">        compiler, which saves scheduling time. If true, unroll the loop</span>
<span class="sd">        immediately, which may help further simplifications based on the</span>
<span class="sd">        unrolled result. If your purpose is just to fill the instruction cache,</span>
<span class="sd">        set it to false. If you are unrolling a loop that computes array indices,</span>
<span class="sd">        set it to true</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the loop is not found or length of the loop is not a constant</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">unroll</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">),</span> <span class="n">immediate</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.var_merge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">var_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.var_merge" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Merge two dimensions of a variable</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>vardef</strong> (<code>str, ID or Stmt</code>)  ID of the VarDef statement of the specific variable</p></li>
            <li><p><strong>dim</strong> (<code>int</code>)  Merge the <code>dim</code>-th and the <code>(dim + 1)</code>-th dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">var_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge two dimensions of a variable</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vardef : str, ID or Stmt</span>
<span class="sd">        ID of the VarDef statement of the specific variable</span>
<span class="sd">    dim : int</span>
<span class="sd">        Merge the `dim`-th and the `(dim + 1)`-th dimension</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_merge</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">dim</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.var_reorder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">var_reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.var_reorder" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Reorder the dimensions of a variable</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>vardef</strong> (<code>str, ID or Stmt</code>)  ID of the VarDef statement of the specific variable</p></li>
            <li><p><strong>order</strong> (<code>array like of str, ID or Stmt</code>)  Vector of integers. The new order of the dimensions</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the variable or the order is illegal</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">var_reorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">order</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reorder the dimensions of a variable</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vardef : str, ID or Stmt</span>
<span class="sd">        ID of the VarDef statement of the specific variable</span>
<span class="sd">    order : array like of str, ID or Stmt</span>
<span class="sd">        Vector of integers. The new order of the dimensions</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the variable or the order is illegal</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_reorder</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">order</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.var_split" class="doc doc-heading">
<code class="highlight language-python"><span class="n">var_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.var_split" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Split a dimension of a variable into two</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>vardef</strong> (<code>str, ID or Stmt</code>)  ID of the VarDef statement of the specific variable</p></li>
            <li><p><strong>dim</strong> (<code>int</code>)  which dimension to be split</p></li>
            <li><p><strong>mode</strong> (<code>VarSplitMode</code>)  When the dimension to split is not divisible by <code>factor</code> or <code>nparts</code>,
the resulting shape may become larger. In <code>FixedSize</code> mode, the actual
buffer size will not be changed, and gurads will be added to prevent
out-of-bound accesses. In <code>RelaxedSize</code> mode, the buffer size may
increase. The <code>RelaxedSize</code> mode cannot be applied to I/O variables</p></li>
            <li><p><strong>factor</strong> (<code>int</code>)  Length of the inner (higher no.) dimension. Set to -1 if using <code>nparts</code></p></li>
            <li><p><strong>nparts</strong> (<code>int</code>)  Length of the outer (lower no.) loop. Set to -1 if using <code>factor</code></p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the variable or the dimension is not found</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">var_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vardef</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">factor</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">nparts</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split a dimension of a variable into two</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    vardef : str, ID or Stmt</span>
<span class="sd">        ID of the VarDef statement of the specific variable</span>
<span class="sd">    dim : int</span>
<span class="sd">        which dimension to be split</span>
<span class="sd">    mode : VarSplitMode</span>
<span class="sd">        When the dimension to split is not divisible by `factor` or `nparts`,</span>
<span class="sd">        the resulting shape may become larger. In `FixedSize` mode, the actual</span>
<span class="sd">        buffer size will not be changed, and gurads will be added to prevent</span>
<span class="sd">        out-of-bound accesses. In `RelaxedSize` mode, the buffer size may</span>
<span class="sd">        increase. The `RelaxedSize` mode cannot be applied to I/O variables</span>
<span class="sd">    factor : int</span>
<span class="sd">        Length of the inner (higher no.) dimension. Set to -1 if using `nparts`</span>
<span class="sd">    nparts : int</span>
<span class="sd">        Length of the outer (lower no.) loop. Set to -1 if using `factor`</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the variable or the dimension is not found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">var_split</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">vardef</span><span class="p">),</span> <span class="n">dim</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span>
                                           <span class="n">nparts</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.schedule.Schedule.vectorize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">vectorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.Schedule.vectorize" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Vectorize a loop</p>
<p>Please note that, as vectorization is different from architecture to
achitecture, the scheduler may or may not postpone it to the backend
compiler. The vectorization is a best-effort schedule</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>loop</strong> (<code>str, ID or Stmt</code>)  ID of the loop</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Exceptions:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><code>InvalidSchedule</code>  if the ID or name is not found, or the dependency requirement is
not met</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vectorize a loop</span>

<span class="sd">    Please note that, as vectorization is different from architecture to</span>
<span class="sd">    achitecture, the scheduler may or may not postpone it to the backend</span>
<span class="sd">    compiler. The vectorization is a best-effort schedule</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loop : str, ID or Stmt</span>
<span class="sd">        ID of the loop</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    InvalidSchedule</span>
<span class="sd">        if the ID or name is not found, or the dependency requirement is</span>
<span class="sd">        not met</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">Schedule</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">ID</span><span class="p">(</span><span class="n">loop</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.schedule.schedule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">schedule</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.schedule.schedule" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Apply any schedule on an AST through a user callback</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>ast</strong> (<code>Func or Stmt</code>)  The AST to schedule. If not specified, a partial function will be
returned that cna be used as a decorator</p></li>
            <li><p><strong>callback</strong> (<code>Callable[[freetensor.core.schedule.Schedule], NoneType]</code>)  Specify what schedule(s) to do in this callback</p></li>
            <li><p><strong>verbose</strong> (<code>Optional[int]</code>)  0 = print nothing. 1 = print the final AST. 2 = print an AST after
each schedule</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/schedule.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">ast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Schedule</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Apply any schedule on an AST through a user callback</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ast : Func or Stmt</span>
<span class="sd">        The AST to schedule. If not specified, a partial function will be</span>
<span class="sd">        returned that cna be used as a decorator</span>
<span class="sd">    callback : Callable</span>
<span class="sd">        Specify what schedule(s) to do in this callback</span>
<span class="sd">    verbose : int (Optional)</span>
<span class="sd">        0 = print nothing. 1 = print the final AST. 2 = print an AST after</span>
<span class="sd">        each schedule</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">ast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ast</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">Schedule</span><span class="p">(</span><span class="n">ast</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">callback</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ast</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">ffi</span><span class="o">.</span><span class="n">ASTNodeType</span><span class="o">.</span><span class="n">Func</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">func</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">ast</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">schedule</span>
        <span class="k">if</span> <span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.staging" class="doc doc-heading">
        <code>staging</code>



<a href="#freetensor.core.staging" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>A staging framework to support the FreeTensor frontend.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.AllowShortcutScope" class="doc doc-heading">
        <code>
AllowShortcutScope        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#freetensor.core.staging.AllowShortcutScope" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Allow return scope.</p>
<p>This is a context manager that allows return in statically deterministic control
flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">AllowShortcutScope</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Allow return scope.</span>
<span class="sd">    This is a context manager that allows return in statically deterministic control</span>
<span class="sd">    flow.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">overload</span><span class="p">:</span> <span class="n">StagingOverload</span>
    <span class="n">should_allow</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overload</span><span class="o">.</span><span class="n">is_shortcut_allowed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overload</span><span class="o">.</span><span class="n">is_shortcut_allowed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_allow</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_class</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overload</span><span class="o">.</span><span class="n">is_shortcut_allowed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">


















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.BreakException" class="doc doc-heading">
        <code>
BreakException            (<span title="Exception">Exception</span>)
        </code>



<a href="#freetensor.core.staging.BreakException" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Exception to be raised by StagingOverload.break_stmt.</p>
<p>Breaks from a for loop.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">BreakException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Exception to be raised by StagingOverload.break_stmt.</span>
<span class="sd">    Breaks from a for loop.&#39;&#39;&#39;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>


    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.ContinueException" class="doc doc-heading">
        <code>
ContinueException            (<span title="Exception">Exception</span>)
        </code>



<a href="#freetensor.core.staging.ContinueException" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Exception to be raised by StagingOverload.continue_stmt.</p>
<p>Continues a for loop.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ContinueException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Exception to be raised by StagingOverload.continue_stmt.</span>
<span class="sd">    Continues a for loop.&#39;&#39;&#39;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>


    </div>

  </div>





  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.ReturnException" class="doc doc-heading">
        <code>
ReturnException            (<span title="Exception">Exception</span>)
        </code>



<a href="#freetensor.core.staging.ReturnException" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Exception to be raised by StagingOverload.return_stmt.</p>
<p>Holds a return value that will be passed through to the function wrapper.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ReturnException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Exception to be raised by StagingOverload.return_stmt.</span>
<span class="sd">    Holds a return value that will be passed through to the function wrapper.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagedAssignable" class="doc doc-heading">
        <code>
StagedAssignable            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#freetensor.core.staging.StagedAssignable" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedAssignable</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.staging.StagedAssignable.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedAssignable.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedAssignable.__class__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedAssignable.__class__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedAssignable.__class__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.staging.StagedAssignable.__class__.__new__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedAssignable.__class__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedAssignable.__class__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedAssignable.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagedAssignable.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>








  </div>

    </div>

  </div>




  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagedPredicate" class="doc doc-heading">
        <code>
StagedPredicate            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#freetensor.core.staging.StagedPredicate" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedPredicate</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">logical_and</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">lazy_other</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">StagedPredicate</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StagedPredicate</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">logical_or</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">lazy_other</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">StagedPredicate</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">StagedPredicate</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">then_body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">],</span>
                          <span class="n">else_body</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]]):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">],</span>
                          <span class="n">else_expr</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Any</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="kc">None</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.staging.StagedPredicate.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedPredicate.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedPredicate.__class__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedPredicate.__class__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedPredicate.__class__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.staging.StagedPredicate.__class__.__new__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedPredicate.__class__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedPredicate.__class__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedPredicate.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagedPredicate.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagedTypeAnnotation" class="doc doc-heading">
        <code>
StagedTypeAnnotation        </code>



<a href="#freetensor.core.staging.StagedTypeAnnotation" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedTypeAnnotation</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">StagedTypeAnnotationMeta</span><span class="p">):</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">annotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.staging.StagedTypeAnnotation.__class__" class="doc doc-heading">
        <code>
__class__            (<span title="abc.ABCMeta">ABCMeta</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedTypeAnnotationMeta</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h6 id="freetensor.core.staging.StagedTypeAnnotation.__class__.__base__" class="doc doc-heading">
        <code>
__base__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.__base__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__new__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h7 id="freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.__base__.register" class="headerlink" title="Permanent link">&para;</a></h7>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedTypeAnnotation.__class__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotation.__class__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>








  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagedTypeAnnotationMeta" class="doc doc-heading">
        <code>
StagedTypeAnnotationMeta            (<span title="abc.ABCMeta">ABCMeta</span>)
        </code>



<a href="#freetensor.core.staging.StagedTypeAnnotationMeta" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagedTypeAnnotationMeta</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="freetensor.core.staging.StagedTypeAnnotationMeta.__base__" class="doc doc-heading">
        <code>
__base__            (<span title="type">type</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.__base__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metaclass for defining Abstract Base Classes (ABCs).</p>
<p>Use this metaclass to create an ABC.  An ABC can be subclassed
directly, and then acts as a mix-in class.  You can also register
unrelated concrete classes (even built-in classes) and unrelated
ABCs as 'virtual subclasses' -- these and their descendants will
be considered subclasses of the registering ABC by the built-in
issubclass() function, but the registering ABC won't show up in
their MRO (Method Resolution Order) nor will method
implementations defined by the registering ABC be callable (not
even via super()).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ABCMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Metaclass for defining Abstract Base Classes (ABCs).</span>

<span class="sd">    Use this metaclass to create an ABC.  An ABC can be subclassed</span>
<span class="sd">    directly, and then acts as a mix-in class.  You can also register</span>
<span class="sd">    unrelated concrete classes (even built-in classes) and unrelated</span>
<span class="sd">    ABCs as &#39;virtual subclasses&#39; -- these and their descendants will</span>
<span class="sd">    be considered subclasses of the registering ABC by the built-in</span>
<span class="sd">    issubclass() function, but the registering ABC won&#39;t show up in</span>
<span class="sd">    their MRO (Method Resolution Order) nor will method</span>
<span class="sd">    implementations defined by the registering ABC be callable (not</span>
<span class="sd">    even via super()).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">        Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_dump_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Debug helper to print the ABC registry.&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Inv. counter: </span><span class="si">{</span><span class="n">get_cache_token</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="p">(</span><span class="n">_abc_registry</span><span class="p">,</span> <span class="n">_abc_cache</span><span class="p">,</span> <span class="n">_abc_negative_cache</span><span class="p">,</span>
         <span class="n">_abc_negative_cache_version</span><span class="p">)</span> <span class="o">=</span> <span class="n">_get_dump</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_registry: </span><span class="si">{</span><span class="n">_abc_registry</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_cache: </span><span class="si">{</span><span class="n">_abc_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache: </span><span class="si">{</span><span class="n">_abc_negative_cache</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;_abc_negative_cache_version: </span><span class="si">{</span><span class="n">_abc_negative_cache_version</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_registry_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the registry (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_registry</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_abc_caches_clear</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear the caches (for debugging or testing).&quot;&quot;&quot;</span>
        <span class="n">_reset_caches</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__instancecheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__instancecheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for isinstance(instance, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__instancecheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for isinstance(instance, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_instancecheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__new__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">mcls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_abc_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__subclasscheck__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.__base__.__subclasscheck__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Override for issubclass(subclass, cls).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__subclasscheck__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Override for issubclass(subclass, cls).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_subclasscheck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="freetensor.core.staging.StagedTypeAnnotationMeta.__base__.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.__base__.register" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>









  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagedTypeAnnotationMeta.register" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.StagedTypeAnnotationMeta.register" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Register a virtual subclass of an ABC.</p>
<p>Returns the subclass, to allow usage as a class decorator.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Register a virtual subclass of an ABC.</span>

<span class="sd">    Returns the subclass, to allow usage as a class decorator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_abc_register</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subclass</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagingError" class="doc doc-heading">
        <code>
StagingError            (<span title="Exception">Exception</span>)
        </code>



<a href="#freetensor.core.staging.StagingError" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Error occurred during staging function execution (i.e. IR tree generation).</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Error occurred during staging function execution (i.e. IR tree generation).&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overload</span><span class="p">:</span> <span class="n">StagingOverload</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># TODO: add output of StagingContext.call_stack</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="si">{</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_list</span><span class="p">(</span><span class="n">overload</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.StagingOverload" class="doc doc-heading">
        <code>
StagingOverload        </code>



<a href="#freetensor.core.staging.StagingOverload" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">


        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">StagingOverload</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">traceback</span><span class="o">.</span><span class="n">FrameSummary</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Customized attribute accessor.</span>

<span class="sd">        The framework first looks for a Python native attribute. If not found, it looks</span>
<span class="sd">        for this overloaded custom attribute resolver.</span>

<span class="sd">        The default implementation provides no custom attribute.</span>
<span class="sd">        Can be overridden by subclasses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        obj : Any</span>
<span class="sd">            Object to access attribute.</span>
<span class="sd">        attr : str</span>
<span class="sd">            Attribute name.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Any :</span>
<span class="sd">            The attribute value.</span>

<span class="sd">        Throws</span>
<span class="sd">        ------</span>
<span class="sd">        AttributeError :</span>
<span class="sd">            If the attribute is not found.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Metadata handler.</span>

<span class="sd">        A metadata line is a comment starting with `#! ` and followed by a metadata,</span>
<span class="sd">        represented as a string parameter.</span>

<span class="sd">        Defaults to a no-op.</span>
<span class="sd">        Can be overridden by subclasses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        content : str</span>
<span class="sd">            The metadata content.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Code position handler.</span>

<span class="sd">        Defaults to a no-op.</span>
<span class="sd">        Can be overridden by subclasses.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            Name of the file containing code for the next statement.</span>
<span class="sd">        lineno : int</span>
<span class="sd">            Line number of the next statement.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">StagingError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">allow_shortcut_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Opens a scope that allows shortcut control flows in a statically deterministic</span>
<span class="sd">        context. Need to be closed by `with` statement.&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">AllowShortcutScope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Customized foreach wrapper.</span>
<span class="sd">        If `value` is instance of `StagedIterable`, its regarded as a customized foreach</span>
<span class="sd">        behavior and used to generate code for the python for loop.</span>
<span class="sd">        Otherwise, we try to execute the loop as usual.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">iter</span><span class="p">,</span> <span class="n">StagedIterable</span><span class="p">):</span>
            <span class="nb">iter</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iter_var</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">body</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">BreakException</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="n">ContinueException</span><span class="p">:</span>
                    <span class="k">continue</span>

    <span class="k">def</span> <span class="nf">assign_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Customized assign wrapper.</span>
<span class="sd">        If `value` is instance of `StagedAssignable`, it&#39;s regarded as a customized</span>
<span class="sd">        assign behavior and gets executed with the assigned target variable name.</span>
<span class="sd">        This wrapper is used for initializing a variable.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;If-then-else statement staging tool.</span>
<span class="sd">        When predicate is deterministic in staging, only one branch is generated.</span>
<span class="sd">        Otherwise, a If node in IR is generated.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
            <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_stmt</span><span class="p">(</span><span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
                <span class="n">then_body</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">else_body</span><span class="p">:</span>
                <span class="n">else_body</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;If-then-else expression staging tool.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_expr</span><span class="p">(</span><span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">then_expr</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">else_expr</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpred</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;While statement staging tool.&#39;&#39;&#39;</span>
        <span class="n">first_pred</span> <span class="o">=</span> <span class="n">fpred</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_pred</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
            <span class="n">first_pred</span><span class="o">.</span><span class="n">while_stmt</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">first_pred</span><span class="p">:</span>
                <span class="n">body</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">fpred</span><span class="p">():</span>
                <span class="n">body</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Assert staging tool.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
            <span class="n">test</span><span class="o">.</span><span class="n">assert_stmt</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">test</span>

    <span class="k">def</span> <span class="nf">return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">funcname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return staging tool. Only allow return in static control flow.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Return is only allowed in statically deterministic control flow.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">funcname</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ReturnException</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Break staging tool. Only allow break in static control flow.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Break is only allowed in statically deterministic control flow.&#39;</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="n">BreakException</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Continue staging tool. Only allow continue in static control flow.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s1">&#39;Continue is only allowed in statically deterministic control flow.&#39;</span>
            <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ContinueException</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load attribute staging tool. Allows customization of reading attributes.&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Have to use AttributeError again, since a custom attribute might have</span>
                <span class="c1"># a None value</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                <span class="n">successful</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">successful</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">successful</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

    <span class="k">def</span> <span class="nf">and_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">lazy_args</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">reducer</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fb</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># This is not a simple logical and; it&#39;s equivalent to a if-then-else.</span>
                <span class="c1"># Thus, if a is True, fb() is returned, preserving the original value,</span>
                <span class="c1"># which might be a StagedPredicate.</span>
                <span class="k">return</span> <span class="n">a</span> <span class="ow">and</span> <span class="n">fb</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">reducer</span><span class="p">,</span> <span class="n">lazy_args</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">or_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">lazy_args</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">reducer</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fb</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">fb</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">reducer</span><span class="p">,</span> <span class="n">lazy_args</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">not_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="n">logical_not</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">arg</span>

    <span class="k">def</span> <span class="nf">functiondef_decorator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">functiondef_wrapper</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Function definition wrapper.</span>
<span class="sd">        This wrapper performs extra initialization and cleanup for function definition.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># Push debug call stack with some random line number.</span>
            <span class="c1"># It will be updated by `mark_position` calls in the function.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">FrameSummary</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="c1"># The called function can now return from itself, despite what the outer</span>
            <span class="c1"># control flow is.</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">ReturnException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># No return_stmt was called, naturally returns None</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Pop debug call stack.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">wrapped</span>

    <span class="k">def</span> <span class="nf">annotate_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ty</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ty</span><span class="p">,</span> <span class="n">StagedTypeAnnotation</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ty</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">mark_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="c1"># FrameSummary is immutable, so we have to initialize a new one with updated</span>
        <span class="c1"># line number.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">FrameSummary</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lineno</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">into_staging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">func</span><span class="p">,</span>
                     <span class="n">extra_locals</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{},</span>
                     <span class="n">src</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lines</span><span class="p">,</span> <span class="n">lineno</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">getsourcelines</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lineno</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;staging:</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&gt;&#39;</span>

        <span class="c1"># Inject overload to extra_locals.</span>
        <span class="n">extra_locals</span><span class="p">[</span><span class="s1">&#39;__staging_overload__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># To transform a function, except essential AST transformation, we have to pass</span>
        <span class="c1"># the globals and locals (actually captured outer local variables) to the</span>
        <span class="c1"># transformed function properly.</span>
        <span class="c1"># Note that:</span>
        <span class="c1"># 1. We have to pass both globals and locals to `exec`.</span>
        <span class="c1"># 2. We cannot insert locals to the globals `dict`, otherwise it will pollute</span>
        <span class="c1">#    the globals `dict`.</span>
        <span class="c1"># 3. We cannot copy the globals `dict` before passing it to exec, otherwise the</span>
        <span class="c1">#    staged function cannot write to globals and get later updates in the global.</span>
        <span class="c1"># Thus, we have to pass the globals and locals to the transformed function</span>
        <span class="c1"># separately.</span>

        <span class="k">if</span> <span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
            <span class="n">func_locals</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">:</span> <span class="n">cell</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cell</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_freevars</span><span class="p">,</span>
                                                 <span class="n">func</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func_locals</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Translate `#! ` comments to metadata calls.</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">process_annotating_comments</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="c1"># Wrap the code if it has a indentation.</span>
        <span class="k">if</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span> <span class="ow">or</span> <span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;if True:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">src</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">)</span>
            <span class="c1"># Replace with the real body to eliminate the faked if.</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span>
            <span class="c1"># Modify lineno to match with the location.</span>
            <span class="n">lineno</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">Transformer</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="c1"># Instead of passing the `func_local` directly to `exec`, we instead wrap the</span>
        <span class="c1"># staging function. This is to workaround an issue of CPython. (See</span>
        <span class="c1"># https://github.com/python/cpython/issues/86084).</span>

        <span class="c1"># The sketch is:</span>
        <span class="c1"># ```</span>
        <span class="c1"># def __freetensor_staging_wrapper__(__freetensor_extra_locals__,</span>
        <span class="c1">#                                    __freetensor_local_cells__):</span>
        <span class="c1">#     some_extra_local = __freetensor_extra_locals__[&#39;some_extra_local&#39;]</span>
        <span class="c1">#     some_captured = None</span>
        <span class="c1">#</span>
        <span class="c1">#     def original_func():</span>
        <span class="c1">#         nonlocal some_captured</span>
        <span class="c1">#         some_captured = __freetensor_local_cells__.some_captured</span>
        <span class="c1">#         try:</span>
        <span class="c1">#             ...  # original function body</span>
        <span class="c1">#         finally:</span>
        <span class="c1">#             __freetensor_local_cells__.some_captured = some_captured</span>
        <span class="c1">#</span>
        <span class="c1">#     return original_func</span>
        <span class="c1"># ```</span>
        <span class="c1"># Note that `__freetensor_local_cells__` is a `LocalsDictWrapper` object.</span>
        <span class="c1"># It in-turn accesses cell.cell_contents to get/set the value of the local</span>
        <span class="c1"># variable.</span>
        <span class="c1"># The `LocalsDictWrapper` is a helper class to reduce code generation complexity.</span>

        <span class="n">WRAPPER_NAME</span> <span class="o">=</span> <span class="s1">&#39;__freetensor_staging_wrapper__&#39;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span>

        <span class="c1"># Modify function body.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">func_locals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">([</span>
                <span class="c1"># Declare them as nonlocals to assign to outer scope.</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Nonlocal</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">func_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="c1"># Fetch latest values of the closure variables.</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                           <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                               <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__freetensor_local_cells__&#39;</span><span class="p">,</span>
                                        <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span> <span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">func_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                <span class="c1"># Use a try-finally to ensure closure write back.</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Try</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">tree</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">body</span><span class="p">,</span>
                        <span class="n">handlers</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">orelse</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">finalbody</span><span class="o">=</span><span class="p">[</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span>
                                <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                                    <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__freetensor_local_cells__&#39;</span><span class="p">,</span>
                                             <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span> <span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())</span>
                            <span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))</span>
                            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">func_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="p">])</span>
            <span class="p">])</span>
        <span class="n">tree</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="n">WRAPPER_NAME</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span><span class="n">posonlyargs</span><span class="o">=</span><span class="p">[],</span>
                                   <span class="n">args</span><span class="o">=</span><span class="p">[</span>
                                       <span class="n">ast</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s1">&#39;__freetensor_extra_locals__&#39;</span><span class="p">,</span>
                                               <span class="kc">None</span><span class="p">),</span>
                                       <span class="n">ast</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s1">&#39;__freetensor_local_cells__&#39;</span><span class="p">,</span>
                                               <span class="kc">None</span><span class="p">)</span>
                                   <span class="p">],</span>
                                   <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
                                   <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[],</span>
                                   <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">defaults</span><span class="o">=</span><span class="p">[]),</span>
                <span class="n">body</span><span class="o">=</span><span class="p">[</span>
                    <span class="c1"># Captured closure variables are not fetched here, only declared.</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                               <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">func_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
                    <span class="c1"># Extra locals are fetched here.</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())],</span>
                               <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">(</span>
                                   <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__freetensor_extra_locals__&#39;</span><span class="p">,</span>
                                            <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                                   <span class="n">ast_index</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">name</span><span class="p">)),</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))</span>
                    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">extra_locals</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="p">]</span> <span class="o">+</span> <span class="n">tree</span><span class="o">.</span><span class="n">body</span> <span class="o">+</span>
                <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))],</span>
                <span class="n">decorator_list</span><span class="o">=</span><span class="p">[],</span>
                <span class="n">returns</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">fix_missing_locations</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">astor</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">astor</span><span class="o">.</span><span class="n">to_source</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

            <span class="kn">from</span> <span class="nn">pygments</span> <span class="kn">import</span> <span class="n">highlight</span>
            <span class="kn">from</span> <span class="nn">pygments.lexers</span> <span class="kn">import</span> <span class="n">PythonLexer</span>
            <span class="kn">from</span> <span class="nn">pygments.formatters</span> <span class="kn">import</span> <span class="n">TerminalFormatter</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">highlight</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">PythonLexer</span><span class="p">(),</span>
                            <span class="n">TerminalFormatter</span><span class="p">(</span><span class="n">bg</span><span class="o">=</span><span class="s1">&#39;dark&#39;</span><span class="p">,</span> <span class="n">linenos</span><span class="o">=</span><span class="kc">True</span><span class="p">)),</span>
                  <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>

            <span class="n">tree</span> <span class="o">=</span> <span class="n">source</span>  <span class="c1"># make debug info match dumped source</span>

        <span class="c1"># Create an empty locals dict to avoid polluting the original globals.</span>
        <span class="n">empty_locals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">exec</span><span class="p">(</span><span class="nb">compile</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;&lt;staging:</span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">),</span>
             <span class="n">func</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span> <span class="n">empty_locals</span><span class="p">)</span>
        <span class="n">f_wrapper</span> <span class="o">=</span> <span class="n">empty_locals</span><span class="p">[</span><span class="n">WRAPPER_NAME</span><span class="p">]</span>
        <span class="c1"># Pass the closure to the wrapper and retrieve the staging function with</span>
        <span class="c1"># correct captured variables.</span>
        <span class="n">f_staging</span> <span class="o">=</span> <span class="n">f_wrapper</span><span class="p">(</span><span class="n">extra_locals</span><span class="p">,</span> <span class="n">LocalsDictWrapper</span><span class="p">(</span><span class="n">func_locals</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">f_staging</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.allow_shortcut_scope" class="doc doc-heading">
<code class="highlight language-python"><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.allow_shortcut_scope" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Opens a scope that allows shortcut control flows in a statically deterministic</p>
<p>context. Need to be closed by <code>with</code> statement.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">allow_shortcut_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Opens a scope that allows shortcut control flows in a statically deterministic</span>
<span class="sd">    context. Need to be closed by `with` statement.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">AllowShortcutScope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.assert_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.assert_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Assert staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assert_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Assert staging tool.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">test</span><span class="o">.</span><span class="n">assert_stmt</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">test</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.assign_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.assign_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized assign wrapper.</p>
<p>If <code>value</code> is instance of <code>StagedAssignable</code>, it's regarded as a customized
assign behavior and gets executed with the assigned target variable name.
This wrapper is used for initializing a variable.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">assign_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Customized assign wrapper.</span>
<span class="sd">    If `value` is instance of `StagedAssignable`, it&#39;s regarded as a customized</span>
<span class="sd">    assign behavior and gets executed with the assigned target variable name.</span>
<span class="sd">    This wrapper is used for initializing a variable.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.at_position" class="doc doc-heading">
<code class="highlight language-python"><span class="n">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">lineno</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.at_position" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Code position handler.</p>
<p>Defaults to a no-op.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>filename</strong> (<code>str</code>)  Name of the file containing code for the next statement.</p></li>
            <li><p><strong>lineno</strong> (<code>int</code>)  Line number of the next statement.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">at_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Code position handler.</span>

<span class="sd">    Defaults to a no-op.</span>
<span class="sd">    Can be overridden by subclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        Name of the file containing code for the next statement.</span>
<span class="sd">    lineno : int</span>
<span class="sd">        Line number of the next statement.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.break_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.break_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Break staging tool. Only allow break in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">break_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Break staging tool. Only allow break in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Break is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="n">BreakException</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.continue_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.continue_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Continue staging tool. Only allow continue in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">continue_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Continue staging tool. Only allow continue in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Continue is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">raise</span> <span class="n">ContinueException</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.custom_attr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.custom_attr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized attribute accessor.</p>
<p>The framework first looks for a Python native attribute. If not found, it looks
for this overloaded custom attribute resolver.</p>
<p>The default implementation provides no custom attribute.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>obj</strong> (<code>Any</code>)  Object to access attribute.</p></li>
            <li><p><strong>attr</strong> (<code>str</code>)  Attribute name.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>Any</code>  The attribute value.</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">custom_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Customized attribute accessor.</span>

<span class="sd">    The framework first looks for a Python native attribute. If not found, it looks</span>
<span class="sd">    for this overloaded custom attribute resolver.</span>

<span class="sd">    The default implementation provides no custom attribute.</span>
<span class="sd">    Can be overridden by subclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : Any</span>
<span class="sd">        Object to access attribute.</span>
<span class="sd">    attr : str</span>
<span class="sd">        Attribute name.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Any :</span>
<span class="sd">        The attribute value.</span>

<span class="sd">    Throws</span>
<span class="sd">    ------</span>
<span class="sd">    AttributeError :</span>
<span class="sd">        If the attribute is not found.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.foreach" class="doc doc-heading">
<code class="highlight language-python"><span class="n">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.foreach" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Customized foreach wrapper.</p>
<p>If <code>value</code> is instance of <code>StagedIterable</code>, its regarded as a customized foreach
behavior and used to generate code for the python for loop.
Otherwise, we try to execute the loop as usual.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">iter</span><span class="p">,</span> <span class="n">body</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Customized foreach wrapper.</span>
<span class="sd">    If `value` is instance of `StagedIterable`, its regarded as a customized foreach</span>
<span class="sd">    behavior and used to generate code for the python for loop.</span>
<span class="sd">    Otherwise, we try to execute the loop as usual.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">iter</span><span class="p">,</span> <span class="n">StagedIterable</span><span class="p">):</span>
        <span class="nb">iter</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">iter_var</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">body</span><span class="p">(</span><span class="n">iter_var</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">BreakException</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="n">ContinueException</span><span class="p">:</span>
                <span class="k">continue</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.functiondef_wrapper" class="doc doc-heading">
<code class="highlight language-python"><span class="n">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.functiondef_wrapper" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Function definition wrapper.</p>
<p>This wrapper performs extra initialization and cleanup for function definition.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">functiondef_wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Function definition wrapper.</span>
<span class="sd">    This wrapper performs extra initialization and cleanup for function definition.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Push debug call stack with some random line number.</span>
        <span class="c1"># It will be updated by `mark_position` calls in the function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">FrameSummary</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="c1"># The called function can now return from itself, despite what the outer</span>
        <span class="c1"># control flow is.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_shortcut_scope</span><span class="p">(</span><span class="kc">True</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">ReturnException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># No return_stmt was called, naturally returns None</span>
                <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Pop debug call stack.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_call_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">wrapped</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.if_then_else_expr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.if_then_else_expr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>If-then-else expression staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">if_then_else_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;If-then-else expression staging tool.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_expr</span><span class="p">(</span><span class="n">then_expr</span><span class="p">,</span> <span class="n">else_expr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">then_expr</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">else_expr</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.if_then_else_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.if_then_else_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>If-then-else statement staging tool.</p>
<p>When predicate is deterministic in staging, only one branch is generated.
Otherwise, a If node in IR is generated.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">if_then_else_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;If-then-else statement staging tool.</span>
<span class="sd">    When predicate is deterministic in staging, only one branch is generated.</span>
<span class="sd">    Otherwise, a If node in IR is generated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">predicate</span><span class="o">.</span><span class="n">if_then_else_stmt</span><span class="p">(</span><span class="n">then_body</span><span class="p">,</span> <span class="n">else_body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">predicate</span><span class="p">:</span>
            <span class="n">then_body</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">else_body</span><span class="p">:</span>
            <span class="n">else_body</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.load_attr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.load_attr" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Load attribute staging tool. Allows customization of reading attributes.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load attribute staging tool. Allows customization of reading attributes.&#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Have to use AttributeError again, since a custom attribute might have</span>
            <span class="c1"># a None value</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_attr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">successful</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">successful</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.metadata" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.metadata" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Metadata handler.</p>
<p>A metadata line is a comment starting with <code>#!</code> and followed by a metadata,
represented as a string parameter.</p>
<p>Defaults to a no-op.
Can be overridden by subclasses.</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>content</strong> (<code>str</code>)  The metadata content.</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Metadata handler.</span>

<span class="sd">    A metadata line is a comment starting with `#! ` and followed by a metadata,</span>
<span class="sd">    represented as a string parameter.</span>

<span class="sd">    Defaults to a no-op.</span>
<span class="sd">    Can be overridden by subclasses.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    content : str</span>
<span class="sd">        The metadata content.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.return_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">funcname</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.return_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Return staging tool. Only allow return in static control flow.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">return_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">funcname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return staging tool. Only allow return in static control flow.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_shortcut_allowed</span><span class="p">:</span>
        <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s1">&#39;Return is only allowed in statically deterministic control flow.&#39;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">StagedAssignable</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">funcname</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">ReturnException</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.StagingOverload.while_stmt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpred</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.StagingOverload.while_stmt" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>While statement staging tool.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">while_stmt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fpred</span><span class="p">,</span> <span class="n">body</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;While statement staging tool.&#39;&#39;&#39;</span>
    <span class="n">first_pred</span> <span class="o">=</span> <span class="n">fpred</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">first_pred</span><span class="p">,</span> <span class="n">StagedPredicate</span><span class="p">):</span>
        <span class="n">first_pred</span><span class="o">.</span><span class="n">while_stmt</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">first_pred</span><span class="p">:</span>
            <span class="n">body</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">fpred</span><span class="p">():</span>
            <span class="n">body</span><span class="p">()</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.TransformError" class="doc doc-heading">
        <code>
TransformError            (<span title="Exception">Exception</span>)
        </code>



<a href="#freetensor.core.staging.TransformError" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Error occurred during AST transforming from python function to staging function</p>
<p>that generates IR tree.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TransformError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Error occurred during AST transforming from python function to staging function</span>
<span class="sd">    that generates IR tree.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">base_lineno</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">error_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;At </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">base_lineno</span> <span class="o">+</span> <span class="n">error_node</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s1">:</span><span class="se">\n</span><span class="s1">    </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.staging.Transformer" class="doc doc-heading">
        <code>
Transformer            (<span title="ast.NodeTransformer">NodeTransformer</span>)
        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#freetensor.core.staging.Transformer" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Transformer(filename: 'str', base_lineno: 'int', curr_func: 'str' = None, nonlocals: 'List[List[str]]' = None)</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Transformer</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">base_lineno</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">curr_func</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nonlocals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">new_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_node</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">[</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">call_helper</span><span class="p">(</span>
                        <span class="n">StagingOverload</span><span class="o">.</span><span class="n">mark_position</span><span class="p">,</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_lineno</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">new_node</span>
        <span class="k">return</span> <span class="n">new_node</span>

    <span class="k">def</span> <span class="nf">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">        `lhs = rhs` -&gt; `lhs = assign(&#39;lhs&#39;, rhs)`</span>
<span class="sd">        `x.lhs = rhs` -&gt; `x.lhs = assign(&#39;lhs&#39;, rhs)`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="c1"># FIXME: multi-assign not implemented</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">or</span>
                                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                  <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                    <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">assign_stmt</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                                <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">handleType_AnnAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">target</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">x_str</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">Ty</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">annotation</span>

        <span class="n">intermediate</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;freetensor__annotate__</span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">intermediate_store</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">())</span>
        <span class="n">intermediate_load</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">intermediate</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">intermediate_store</span><span class="p">],</span>
                       <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">annotate_stmt</span><span class="p">,</span> <span class="n">x_str</span><span class="p">,</span> <span class="n">Ty</span><span class="p">)),</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">(</span><span class="n">intermediate_load</span><span class="p">,</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">x</span><span class="p">],</span> <span class="n">intermediate_load</span><span class="p">)],</span> <span class="p">[])</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_AnnAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">        `x: Ty` -&gt; ```</span>
<span class="sd">        freetensor__annotate__x = annotate_stmt(&#39;x&#39;, Ty)</span>
<span class="sd">        if freetensor__annotate__x:</span>
<span class="sd">            x = freetensor__annotate__x</span>
<span class="sd">        ```: pure annotation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleType_AnnAssign</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_For</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">        ```</span>
<span class="sd">        for x in iter:</span>
<span class="sd">            body</span>
<span class="sd">        ```</span>
<span class="sd">        -&gt;</span>
<span class="sd">        ```</span>
<span class="sd">        def for_body(x):</span>
<span class="sd">            body</span>
<span class="sd">        foreach(&#39;x&#39;, iter, for_body)</span>
<span class="sd">        ```&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
                <span class="c1"># While opening a fake function, For loops initiates an iter name as</span>
                <span class="c1"># well. Need to remove it from the outer nonlocals list to implement</span>
                <span class="c1"># shadowing. Only For loops behaves as such, so handle it specially here.</span>
                <span class="n">nonlocals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">recursive_remove_id</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">nonlocals</span><span class="p">:</span>
                            <span class="n">nonlocals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                            <span class="n">recursive_remove_id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

                <span class="n">recursive_remove_id</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
                <span class="n">nonlocals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">recursive_get_names</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                            <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recursive_get_names</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>

                <span class="n">target_names</span> <span class="o">=</span> <span class="n">recursive_get_names</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

                <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;for_body&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;__item__&#39;</span><span class="p">],</span> <span class="p">[</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">],</span>
                                   <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__item__&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))</span>
                    <span class="p">]</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">nonlocals</span><span class="p">),</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                        <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">foreach</span><span class="p">,</span>
                                    <span class="n">target_names</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">iter</span><span class="p">,</span>
                                    <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;for_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())))</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">        ```</span>
<span class="sd">        while pred:</span>
<span class="sd">            body</span>
<span class="sd">        ```</span>
<span class="sd">        -&gt;</span>
<span class="sd">        ```</span>
<span class="sd">        def while_body():</span>
<span class="sd">            body</span>
<span class="sd">        while_stmt(lambda: pred, while_body)</span>
<span class="sd">        ```&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;while_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">nonlocals</span><span class="p">),</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">while_stmt</span><span class="p">,</span>
                                <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
                                <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;while_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())))</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">        ```</span>
<span class="sd">        if pred:</span>
<span class="sd">            body</span>
<span class="sd">        else:</span>
<span class="sd">            orelse</span>
<span class="sd">        ```</span>
<span class="sd">        -&gt;</span>
<span class="sd">        ```</span>
<span class="sd">        def then_body():</span>
<span class="sd">            body</span>
<span class="sd">        def else_body():</span>
<span class="sd">            orelse</span>
<span class="sd">        if_then_else_stmt(pred, then_body, else_body)</span>
<span class="sd">        ```</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;then_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span>
                    <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">body</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">y</span><span class="p">])</span>
                <span class="p">],</span> <span class="n">nonlocals</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="n">then_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;then_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
                <span class="n">new_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;else_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span>
                        <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                        <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">y</span><span class="p">])</span>
                    <span class="p">],</span> <span class="n">nonlocals</span><span class="p">))</span>
            <span class="n">else_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;else_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">else_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">new_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">if_then_else_stmt</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span>
                            <span class="n">else_body</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_node</span>

    <span class="k">def</span> <span class="nf">visit_IfExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">IfExp</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Rule: `body if test else orelse` -&gt; `if_then_else_expr(test, body, orelse)`&#39;&#39;&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">if_then_else_expr</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">,</span>
                           <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                           <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">orelse</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_FunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">prev_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curr_func</span> <span class="o">=</span> <span class="n">old_node</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># nested functions follow original Python (shitty) scoping,</span>
        <span class="c1"># thus backup the nonlocals stack and prepare a clean one.</span>
        <span class="n">prev_nonlocals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># mark arguments as nonlocal</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">kwonlyargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">kwarg</span><span class="o">.</span><span class="n">arg</span><span class="p">)</span>

            <span class="c1"># Transform the function body</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
            <span class="c1"># Cleanup the decorators</span>
            <span class="n">node</span><span class="o">.</span><span class="n">decorator_list</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">functiondef_decorator</span><span class="p">,</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="c1"># Handle the type annotations</span>
            <span class="n">node</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">stmt</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">posonlyargs</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span>
                <span class="k">if</span> <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span> <span class="k">for</span> <span class="n">stmt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleType_AnnAssign</span><span class="p">(</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">arg</span><span class="o">.</span><span class="n">arg</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">()),</span>
                                  <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span>

            <span class="c1"># Cleanup annotations; we don&#39;t need them anymore</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">vararg</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">kwarg</span>
            <span class="p">]</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">posonlyargs</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">args</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">kwonlyargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">arg</span><span class="o">.</span><span class="n">annotation</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curr_func</span> <span class="o">=</span> <span class="n">prev_func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span> <span class="o">=</span> <span class="n">prev_nonlocals</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Assert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assert</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">assert_stmt</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_BoolOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">):</span>
            <span class="n">libfunc</span> <span class="o">=</span> <span class="n">StagingOverload</span><span class="o">.</span><span class="n">and_expr</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Or</span><span class="p">):</span>
            <span class="n">libfunc</span> <span class="o">=</span> <span class="n">StagingOverload</span><span class="o">.</span><span class="n">or_expr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">call_helper</span><span class="p">(</span><span class="n">libfunc</span><span class="p">,</span>
                           <span class="o">*</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_UnaryOp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">UnaryOp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Not</span><span class="p">):</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">not_expr</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">operand</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;Expand multiple comparison into `and` expression.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">comparators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="n">old_node</span><span class="o">.</span><span class="n">left</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">(),</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span> <span class="n">old_node</span><span class="o">.</span><span class="n">comparators</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">[</span><span class="n">op</span><span class="p">],</span> <span class="p">[</span><span class="n">rhs</span><span class="p">]))</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="n">rhs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s1">&#39;__staging_overload__&#39;</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">load_attr</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                                   <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Return</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Return</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">curr_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
            <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">return_stmt</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curr_func</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Lambda</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_comprehension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">comprehension</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">comprehension</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">node</span>

    <span class="k">def</span> <span class="nf">visit_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Store</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nonlocals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_AsyncFunctionDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AsyncFunctionDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TransformError</span><span class="p">(</span><span class="s1">&#39;Async functions not supported.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">base_lineno</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_ClassDef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">ClassDef</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">TransformError</span><span class="p">(</span><span class="s1">&#39;Class definitions not supported.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">base_lineno</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">visit_Yield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Yield</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">visit_YieldFrom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">YieldFrom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">visit_Break</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Break</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">break_stmt</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">visit_Continue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Continue</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">continue_stmt</span><span class="p">))</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">
















  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.generic_visit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-inherited"><code>inherited</code></small>
  </span>

<a href="#freetensor.core.staging.Transformer.generic_visit" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Called if no explicit visitor function exists for a node.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generic_visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">old_value</span> <span class="ow">in</span> <span class="n">iter_fields</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">new_values</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">old_value</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">AST</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">AST</span><span class="p">):</span>
                        <span class="n">new_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="k">continue</span>
                <span class="n">new_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">old_value</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">new_values</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">AST</span><span class="p">):</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">old_value</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">new_node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">new_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Visit a node.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">):</span>
    <span class="n">new_node</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_node</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="p">[</span><span class="n">new_node</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                <span class="n">call_helper</span><span class="p">(</span>
                    <span class="n">StagingOverload</span><span class="o">.</span><span class="n">mark_position</span><span class="p">,</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_lineno</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">lineno</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="p">]</span> <span class="o">+</span> <span class="n">new_node</span>
    <span class="k">return</span> <span class="n">new_node</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_AnnAssign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_AnnAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_AnnAssign" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule:</p>
<p><code>x: Ty</code> -&gt; <code>freetensor__annotate__x = annotate_stmt('x', Ty)
if freetensor__annotate__x:
    x = freetensor__annotate__x</code>: pure annotation</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_AnnAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">    `x: Ty` -&gt; ```</span>
<span class="sd">    freetensor__annotate__x = annotate_stmt(&#39;x&#39;, Ty)</span>
<span class="sd">    if freetensor__annotate__x:</span>
<span class="sd">        x = freetensor__annotate__x</span>
<span class="sd">    ```: pure annotation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AnnAssign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handleType_AnnAssign</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_Assign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_Assign" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule:</p>
<p><code>lhs = rhs</code> -&gt; <code>lhs = assign('lhs', rhs)</code>
<code>x.lhs = rhs</code> -&gt; <code>x.lhs = assign('lhs', rhs)</code></p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_Assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">    `lhs = rhs` -&gt; `lhs = assign(&#39;lhs&#39;, rhs)`</span>
<span class="sd">    `x.lhs = rhs` -&gt; `x.lhs = assign(&#39;lhs&#39;, rhs)`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
    <span class="c1"># FIXME: multi-assign not implemented</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">or</span>
                                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">)):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">attr</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">(</span>
                <span class="n">node</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
                <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">assign_stmt</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>








  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_Compare" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_Compare" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Expand multiple comparison into <code>and</code> expression.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_Compare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Expand multiple comparison into `and` expression.&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">comparators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
    <span class="n">lhs</span> <span class="o">=</span> <span class="n">old_node</span><span class="o">.</span><span class="n">left</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">BoolOp</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">And</span><span class="p">(),</span> <span class="p">[])</span>
    <span class="k">for</span> <span class="n">op</span><span class="p">,</span> <span class="n">rhs</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">ops</span><span class="p">,</span> <span class="n">old_node</span><span class="o">.</span><span class="n">comparators</span><span class="p">):</span>
        <span class="n">node</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="p">[</span><span class="n">op</span><span class="p">],</span> <span class="p">[</span><span class="n">rhs</span><span class="p">]))</span>
        <span class="n">lhs</span> <span class="o">=</span> <span class="n">rhs</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_For" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_For</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_For" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule:</p>
<pre><code>for x in iter:
    body
</code></pre>
<p>-&gt;</p>
<pre><code>def for_body(x):
    body
foreach('x', iter, for_body)
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_For</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">    ```</span>
<span class="sd">    for x in iter:</span>
<span class="sd">        body</span>
<span class="sd">    ```</span>
<span class="sd">    -&gt;</span>
<span class="sd">    ```</span>
<span class="sd">    def for_body(x):</span>
<span class="sd">        body</span>
<span class="sd">    foreach(&#39;x&#39;, iter, for_body)</span>
<span class="sd">    ```&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
            <span class="c1"># While opening a fake function, For loops initiates an iter name as</span>
            <span class="c1"># well. Need to remove it from the outer nonlocals list to implement</span>
            <span class="c1"># shadowing. Only For loops behaves as such, so handle it specially here.</span>
            <span class="n">nonlocals</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">recursive_remove_id</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">nonlocals</span><span class="p">:</span>
                        <span class="n">nonlocals</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                        <span class="n">recursive_remove_id</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

            <span class="n">recursive_remove_id</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
            <span class="n">nonlocals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">recursive_get_names</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">l</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                        <span class="n">l</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recursive_get_names</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>

            <span class="n">target_names</span> <span class="o">=</span> <span class="n">recursive_get_names</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>

            <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">For</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;for_body&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;__item__&#39;</span><span class="p">],</span> <span class="p">[</span>
                    <span class="n">ast</span><span class="o">.</span><span class="n">Assign</span><span class="p">([</span><span class="n">node</span><span class="o">.</span><span class="n">target</span><span class="p">],</span>
                               <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__item__&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()))</span>
                <span class="p">]</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">nonlocals</span><span class="p">),</span>
                <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">foreach</span><span class="p">,</span>
                                <span class="n">target_names</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">iter</span><span class="p">,</span>
                                <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;for_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())))</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_If" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_If" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule:</p>
<pre><code>if pred:
    body
else:
    orelse
</code></pre>
<p>-&gt;</p>
<pre><code>def then_body():
    body
def else_body():
    orelse
if_then_else_stmt(pred, then_body, else_body)
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_If</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">If</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">    ```</span>
<span class="sd">    if pred:</span>
<span class="sd">        body</span>
<span class="sd">    else:</span>
<span class="sd">        orelse</span>
<span class="sd">    ```</span>
<span class="sd">    -&gt;</span>
<span class="sd">    ```</span>
<span class="sd">    def then_body():</span>
<span class="sd">        body</span>
<span class="sd">    def else_body():</span>
<span class="sd">        orelse</span>
<span class="sd">    if_then_else_stmt(pred, then_body, else_body)</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">old_node</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;then_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span>
                <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">body</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">y</span><span class="p">])</span>
            <span class="p">],</span> <span class="n">nonlocals</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="n">then_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;then_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
            <span class="n">new_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;else_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span>
                    <span class="n">z</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">old_node</span><span class="o">.</span><span class="n">orelse</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">y</span><span class="p">])</span>
                <span class="p">],</span> <span class="n">nonlocals</span><span class="p">))</span>
        <span class="n">else_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;else_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">else_body</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">new_node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
            <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">if_then_else_stmt</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">then_body</span><span class="p">,</span>
                        <span class="n">else_body</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">new_node</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_IfExp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_IfExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_IfExp" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule: <code>body if test else orelse</code> -&gt; <code>if_then_else_expr(test, body, orelse)</code></p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_IfExp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">IfExp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Rule: `body if test else orelse` -&gt; `if_then_else_expr(test, body, orelse)`&#39;&#39;&#39;</span>
    <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
    <span class="n">node</span> <span class="o">=</span> <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">if_then_else_expr</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">,</span>
                       <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">),</span>
                       <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">orelse</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>







  <div class="doc doc-object doc-method">



<h5 id="freetensor.core.staging.Transformer.visit_While" class="doc doc-heading">
<code class="highlight language-python"><span class="n">visit_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.Transformer.visit_While" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Rule:</p>
<pre><code>while pred:
    body
</code></pre>
<p>-&gt;</p>
<pre><code>def while_body():
    body
while_stmt(lambda: pred, while_body)
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">visit_While</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Rule:</span>
<span class="sd">    ```</span>
<span class="sd">    while pred:</span>
<span class="sd">        body</span>
<span class="sd">    ```</span>
<span class="sd">    -&gt;</span>
<span class="sd">    ```</span>
<span class="sd">    def while_body():</span>
<span class="sd">        body</span>
<span class="sd">    while_stmt(lambda: pred, while_body)</span>
<span class="sd">    ```&#39;&#39;&#39;</span>
    <span class="k">with</span> <span class="n">NonlocalTransformingScope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">as</span> <span class="n">nonlocals</span><span class="p">:</span>
        <span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">While</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">old_node</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">function_helper</span><span class="p">(</span><span class="s1">&#39;while_body&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">,</span> <span class="n">nonlocals</span><span class="p">),</span>
            <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                <span class="n">call_helper</span><span class="p">(</span><span class="n">StagingOverload</span><span class="o">.</span><span class="n">while_stmt</span><span class="p">,</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="n">_EMPTY_ARGS</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">test</span><span class="p">),</span>
                            <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;while_body&#39;</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">())))</span>
        <span class="p">]</span>
    <span class="k">return</span> <span class="n">node</span>
</code></pre></div>
        </details>
    </div>

  </div>








  </div>

    </div>

  </div>





  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.staging.call_helper" class="doc doc-heading">
<code class="highlight language-python"><span class="n">call_helper</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.call_helper" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Call helper that generates a python AST Call node with given callee (overload</p>
<p>member) and arguments AST node.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">call_helper</span><span class="p">(</span><span class="n">callee</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Call helper that generates a python AST Call node with given callee (overload</span>
<span class="sd">    member) and arguments AST node.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
        <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="s1">&#39;__staging_overload__&#39;</span><span class="p">,</span>
                               <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span> <span class="n">callee</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">keyword</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.staging.function_helper" class="doc doc-heading">
<code class="highlight language-python"><span class="n">function_helper</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">nonlocals</span><span class="p">)</span></code>


<a href="#freetensor.core.staging.function_helper" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Function helper that generates a python AST FunctionDef node with given name,</p>
<p>arguments name, and body.</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/staging.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">function_helper</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">body</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">stmt</span><span class="p">],</span>
                    <span class="n">nonlocals</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;Function helper that generates a python AST FunctionDef node with given name,</span>
<span class="sd">    arguments name, and body.&#39;&#39;&#39;</span>
    <span class="n">nonlocal_body</span> <span class="o">=</span> <span class="p">([</span><span class="n">ast</span><span class="o">.</span><span class="n">Nonlocal</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)]</span>
                     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nonlocals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">body</span>
    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">FunctionDef</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                           <span class="n">args</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">arguments</span><span class="p">(</span>
                               <span class="n">args</span><span class="o">=</span><span class="p">[],</span>
                               <span class="n">vararg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">kwarg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">posonlyargs</span><span class="o">=</span><span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">],</span>
                               <span class="n">defaults</span><span class="o">=</span><span class="p">[],</span>
                               <span class="n">kwonlyargs</span><span class="o">=</span><span class="p">[],</span>
                               <span class="n">kw_defaults</span><span class="o">=</span><span class="p">[]),</span>
                           <span class="n">body</span><span class="o">=</span><span class="n">nonlocal_body</span><span class="p">,</span>
                           <span class="n">returns</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">decorator_list</span><span class="o">=</span><span class="p">[])</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.core.stmt" class="doc doc-heading">
        <code>stmt</code>



<a href="#freetensor.core.stmt" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Facility to build AST statements</p>
<p>Classes and functions in this module are internally used by <code>transformer</code> to construct ASTs.
They are also used by some internal tests. API of these classes and functions are subject to changes.
End users are encouraged to use <code>transformer</code>, instead of this module.</p>
<p>Classes and functions in this module are all in BigCamel naming style, to distinguish from
expressions in <code>expr.py</code></p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.stmt.Assert" class="doc doc-heading">
        <code>
Assert        </code>



<a href="#freetensor.core.stmt.Assert" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Scope used to create an Assert node</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>
<p>E.g.:</p>
<pre><code>with Assert(i &gt; 0):
    ... # Assertion body
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Assert</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scope used to create an Assert node</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>

<span class="sd">    E.g.:</span>

<span class="sd">    ```</span>
<span class="sd">    with Assert(i &gt; 0):</span>
<span class="sd">        ... # Assertion body</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cond</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Do not generate an AST node</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Do not suppress the exception</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">()</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
        <span class="n">nid</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">()</span>
        <span class="n">top</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">makeAssert</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cond</span><span class="p">,</span> <span class="n">body</span><span class="p">))</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.stmt.Else" class="doc doc-heading">
        <code>
Else        </code>



<a href="#freetensor.core.stmt.Else" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Scope used to create an else branch of an If node</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>
<p>E.g.:</p>
<pre><code>with If(i &gt; 0):
    ... # True branch
with Else():
    ... # Else branch
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Else</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scope used to create an else branch of an If node</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>

<span class="sd">    E.g.:</span>

<span class="sd">    ```</span>
<span class="sd">    with If(i &gt; 0):</span>
<span class="sd">        ... # True branch</span>
<span class="sd">    with Else():</span>
<span class="sd">        ... # Else branch</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Do not generate an AST node</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Do not suppress the exception</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">()</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">append_if_else_stmt</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.stmt.For" class="doc doc-heading">
        <code>
For        </code>



<a href="#freetensor.core.stmt.For" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Scope used to create a For node</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>
<p>E.g.:</p>
<pre><code>with For('i', 0, n) as i:
    ... # Loop body
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">For</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scope used to create a For node</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>

<span class="sd">    E.g.:</span>

<span class="sd">    ```</span>
<span class="sd">    with For(&#39;i&#39;, 0, n) as i:</span>
<span class="sd">        ... # Loop body</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">iter_var</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">begin</span><span class="p">,</span>
                 <span class="n">end</span><span class="p">,</span>
                 <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">nid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                 <span class="n">no_deps</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">prefer_libs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iter_var</span> <span class="o">=</span> <span class="n">iter_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">begin</span> <span class="o">=</span> <span class="n">begin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nid</span> <span class="o">=</span> <span class="n">nid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">no_deps</span> <span class="o">=</span> <span class="n">no_deps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prefer_libs</span> <span class="o">=</span> <span class="n">prefer_libs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">step</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ffi</span><span class="o">.</span><span class="n">all_reads</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">open_vardefs</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">lend_out</span><span class="p">()</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ffi</span><span class="o">.</span><span class="n">makeVar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_var</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">borrowed_vardefs</span><span class="p">:</span>
            <span class="n">item</span><span class="o">.</span><span class="n">reclaim</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Do not generate an AST node</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Do not suppress the exception</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">()</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
        <span class="n">top</span><span class="o">.</span><span class="n">append_for_stmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iter_var</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">begin</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
                            <span class="n">body</span><span class="p">,</span>
                            <span class="n">nid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nid</span><span class="p">,</span>
                            <span class="n">no_deps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">no_deps</span><span class="p">,</span>
                            <span class="n">prefer_libs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prefer_libs</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.stmt.If" class="doc doc-heading">
        <code>
If        </code>



<a href="#freetensor.core.stmt.If" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Scope used to create an If node</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>
<p>E.g.:</p>
<pre><code>with If(i &gt; 0):
    ... # Branch body
</code></pre>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">If</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scope used to create an If node</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>

<span class="sd">    E.g.:</span>

<span class="sd">    ```</span>
<span class="sd">    with If(i &gt; 0):</span>
<span class="sd">        ... # Branch body</span>
<span class="sd">    ```</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cond</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cond</span> <span class="o">=</span> <span class="n">cond</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Do not generate an AST node</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Do not suppress the exception</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">()</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">append_if_then_stmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cond</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="freetensor.core.stmt.NamedScope" class="doc doc-heading">
        <code>
NamedScope        </code>



<a href="#freetensor.core.stmt.NamedScope" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Scope used to create an StmtSeq node with an explicit ID</p>
<p>E.g.:</p>
<pre><code>with NamedScope():
    ... # body
</code></pre>
<p>This scope is used for testing only. StmtSeq nodes can be deleted in many lowering passes</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">NamedScope</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Scope used to create an StmtSeq node with an explicit ID</span>

<span class="sd">    E.g.:</span>

<span class="sd">    ```</span>
<span class="sd">    with NamedScope():</span>
<span class="sd">        ... # body</span>
<span class="sd">    ```</span>

<span class="sd">    This scope is used for testing only. StmtSeq nodes can be deleted in many lowering passes</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nid</span> <span class="o">=</span> <span class="n">nid</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">push</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">exc_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Do not generate an AST node</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Do not suppress the exception</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">.</span><span class="n">make_stmt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nid</span><span class="p">)</span>
        <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  </div>

    </div>

  </div>





  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.stmt.Any" class="doc doc-heading">
<code class="highlight language-python"><span class="n">Any</span><span class="p">()</span></code>


<a href="#freetensor.core.stmt.Any" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create an Any node (only for testing)</p>
<p>Any nodes matches any statement nodes in <code>ast.match</code></p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">Any</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an Any node (only for testing)</span>

<span class="sd">    Any nodes matches any statement nodes in `ast.match`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">makeAny</span><span class="p">())</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.stmt.Eval" class="doc doc-heading">
<code class="highlight language-python"><span class="n">Eval</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span></code>


<a href="#freetensor.core.stmt.Eval" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create an Eval node</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">Eval</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an Eval node</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
    <span class="n">top</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">makeEval</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">(),</span> <span class="n">expr</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.stmt.Invoke" class="doc doc-heading">
<code class="highlight language-python"><span class="n">Invoke</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">)</span></code>


<a href="#freetensor.core.stmt.Invoke" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Inlined invocation of another AST</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>
<p><code>Invoke</code> can be used for invoking a gradient function, which has already been lowered as an AST.
Please note that once a user function has been lowered as an AST, the dimensionalities of its
tensors get fixed. Therefore, to invoke ordinary user functions, please use <code>inline</code> in <code>transformer</code>
instead, which supports generic types</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">Invoke</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Inlined invocation of another AST</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>

<span class="sd">    `Invoke` can be used for invoking a gradient function, which has already been lowered as an AST.</span>
<span class="sd">    Please note that once a user function has been lowered as an AST, the dimensionalities of its</span>
<span class="sd">    tensors get fixed. Therefore, to invoke ordinary user functions, please use `inline` in `transformer`</span>
<span class="sd">    instead, which supports generic types</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span>
    <span class="n">top</span><span class="o">.</span><span class="n">append_stmt</span><span class="p">(</span><span class="n">ffi</span><span class="o">.</span><span class="n">inlined_invoke</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">get_next_nid</span><span class="p">(),</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kvs</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.stmt.MarkNid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">MarkNid</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span></code>


<a href="#freetensor.core.stmt.MarkNid" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Mark the ID of the following statement</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">MarkNid</span><span class="p">(</span><span class="n">nid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mark the ID of the following statement</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ctx_stack</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">set_next_nid</span><span class="p">(</span><span class="n">nid</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.core.stmt.VarDef" class="doc doc-heading">
<code class="highlight language-python"><span class="n">VarDef</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></code>


<a href="#freetensor.core.stmt.VarDef" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>A factory function that creates a VarDef or a series of nested <code>VarDef</code>s</p>
<p>This scope is internally used by <code>transformer</code> and tests</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/core/stmt.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">VarDef</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A factory function that creates a VarDef or a series of nested `VarDef`s</span>

<span class="sd">    This scope is internally used by `transformer` and tests</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_VarsDef</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_VarDef</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>







  </div>

    </div>

  </div>





  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h2 id="freetensor.libop" class="doc doc-heading">
        <code>libop</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#freetensor.libop" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.assign" class="doc doc-heading">
        <code>assign</code>



<a href="#freetensor.libop.assign" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">









  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.add_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.add_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) add to a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.assign" class="doc doc-heading">
<code class="highlight language-python"><span class="n">assign</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.assign" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) assign to a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.floordiv_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floordiv_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.floordiv_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) rounding-towards-negative-infinity integer division (following Python convention, but not C) from a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.mod_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.mod_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) modulo (results are non-negative, following Python convention, but not C) from a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.mul_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mul_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.mul_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) multiply to a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.sub_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sub_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.sub_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) subtract from a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.assign.truediv_to" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truediv_to</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.assign.truediv_to" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) floating-point division from a tensor two another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The target tensor</p></li>
            <li><p><strong>x</strong> (<code>VarRef</code>)  The source tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/assign.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.constant" class="doc doc-heading">
        <code>constant</code>



<a href="#freetensor.libop.constant" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.constant.zeros" class="doc doc-heading">
<code class="highlight language-python"><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.libop.constant.zeros" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Create a zero tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>shape</strong> (<code>Sequence[Expr] or Var</code>)  Shape of the variable. A variable can be created using a literal shape,
or another fixed-length VarRef as a shape</p></li>
            <li><p><strong>dtype</strong> (<code>str or DataType</code>)  Data type of the variable</p></li>
            <li><p><strong>mtype</strong> (<code>str or MemType (Optional)</code>)  Memory type of the variable. If omitted, the main memory type of the
default Target in config will be used</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The zero tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/constant.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create a zero tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    shape : Sequence[Expr] or Var</span>
<span class="sd">        Shape of the variable. A variable can be created using a literal shape,</span>
<span class="sd">        or another fixed-length VarRef as a shape</span>
<span class="sd">    dtype : str or DataType</span>
<span class="sd">        Data type of the variable</span>
<span class="sd">    mtype : str or MemType (Optional)</span>
<span class="sd">        Memory type of the variable. If omitted, the main memory type of the</span>
<span class="sd">        default Target in config will be used</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The zero tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">zeros_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.constant.zeros_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">zeros_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></code>


<a href="#freetensor.libop.constant.zeros_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Fill zeros to a tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>y</strong> (<code>VarRef</code>)  The tensor to fill</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/constant.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">zeros_</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Fill zeros to a tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The tensor to fill</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">core</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span><span class="p">[()]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#! nid: L_elem</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="c1">#! nid: recur</span>
            <span class="n">zeros_</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.conv" class="doc doc-heading">
        <code>conv</code>



<a href="#freetensor.libop.conv" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.conv.conv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">conv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_pad</span><span class="o">=</span><span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span> <span class="n">dilations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.libop.conv.conv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Convolution. The result is returned</p>
<p>Parameters follow ONNX convention. Currently only 2-D convolution is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/conv.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">conv</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
         <span class="n">W</span><span class="p">,</span>
         <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">auto_pad</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span>
         <span class="n">dilations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">group</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
         <span class="n">kernel_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">pads</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">strides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convolution. The result is returned</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D convolution is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D convolution is supported (TODO)</span>

    <span class="k">if</span> <span class="n">dilations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dilations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">strides</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">pads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;VALID&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span><span class="p">)))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_UPPER&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">kernel_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SAME_UPPER pad with dynamic kernel_shape is currently not supported&quot;</span>  <span class="c1"># TODO</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_upper_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_LOWER&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">kernel_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SAME_UPPER pad with dynamic kernel_shape is currently not supported&quot;</span>  <span class="c1"># TODO</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_lower_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;auto_pad should be set if pads is not specified&quot;</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">up_cast</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">mtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">same_mtype</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">mtype</span><span class="p">,</span> <span class="n">W</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">B</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">up_cast</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">mtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">same_mtype</span><span class="p">(</span><span class="n">mtype</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: V_Y</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span>
        <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">calc_out_size</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pads</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                      <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">calc_out_size</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pads</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                      <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">],</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">conv_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">auto_pad</span><span class="p">,</span> <span class="n">dilations</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">pads</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.conv.conv_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">conv_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">auto_pad</span><span class="o">=</span><span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span> <span class="n">dilations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.libop.conv.conv_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Convolution. The result is written to another tensor</p>
<p>Parameters follow ONNX convention. Currently only 2-D convolution is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/conv.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">conv_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
          <span class="n">W</span><span class="p">,</span>
          <span class="n">B</span><span class="p">,</span>
          <span class="n">Y</span><span class="p">,</span>
          <span class="n">auto_pad</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span>
          <span class="n">dilations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">group</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
          <span class="n">kernel_shape</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">pads</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">strides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convolution. The result is written to another tensor</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D convolution is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D convolution is supported (TODO)</span>

    <span class="k">if</span> <span class="n">dilations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dilations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">strides</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">pads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;VALID&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span><span class="p">)))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_UPPER&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">kernel_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SAME_UPPER pad with dynamic kernel_shape is currently not supported&quot;</span>  <span class="c1"># TODO</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_upper_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_LOWER&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">kernel_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SAME_UPPER pad with dynamic kernel_shape is currently not supported&quot;</span>  <span class="c1"># TODO</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_lower_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;auto_pad should be set if pads is not specified&quot;</span>

    <span class="k">if</span> <span class="n">B</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># yapf: disable</span>
        <span class="c1">#! nid: L_n</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
            <span class="c1">#! nid: L_g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
                <span class="c1">#! nid: L_c_out</span>
                <span class="k">for</span> <span class="n">c_out</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">):</span>
                    <span class="c1">#! nid: L_h</span>
                    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                        <span class="c1">#! nid: L_w</span>
                        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                            <span class="c1">#! nid: init</span>
                            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="c1">#! nid: L_c_in</span>
                            <span class="k">for</span> <span class="n">c_in</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                                <span class="c1">#! nid: L_kh</span>
                                <span class="k">for</span> <span class="n">kh</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                                    <span class="c1">#! nid: L_kw</span>
                                    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                                        <span class="c1"># h_in = h * stride + kh * dilation - pad</span>
                                        <span class="c1"># w_in = w * stride + kw * dilation - pad</span>
                                        <span class="k">if</span> <span class="p">(</span>
                                                <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                                <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span>
                                                <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                                <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                                            <span class="c1">#! nid: compute</span>
                                            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span>
                                                    <span class="n">n</span><span class="p">,</span>
                                                    <span class="n">g</span> <span class="o">*</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_in</span><span class="p">,</span>
                                                    <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                            <span class="p">]</span> <span class="o">*</span> <span class="n">W</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">c_in</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">kw</span><span class="p">]</span>
        <span class="c1"># yapf: enable</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="c1"># yapf: disable</span>
        <span class="c1">#! nid: L_n</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
            <span class="c1">#! nid: L_g</span>
            <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
                <span class="c1">#! nid: L_c_out</span>
                <span class="k">for</span> <span class="n">c_out</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">):</span>
                    <span class="c1">#! nid: L_h</span>
                    <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                        <span class="c1">#! nid: L_w</span>
                        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                            <span class="c1">#! nid: init</span>
                            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">]</span>
                            <span class="c1">#! nid: L_c_in</span>
                            <span class="k">for</span> <span class="n">c_in</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
                                <span class="c1">#! nid: L_kh</span>
                                <span class="k">for</span> <span class="n">kh</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                                    <span class="c1">#! nid: L_kw</span>
                                    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                                        <span class="c1"># h_in = h * stride + kh * dilation - pad</span>
                                        <span class="c1"># w_in = w * stride + kw * dilation - pad</span>
                                        <span class="k">if</span> <span class="p">(</span>
                                                <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                                <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span>
                                                <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                                <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                                            <span class="c1">#! nid: compute</span>
                                            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span>
                                                    <span class="n">n</span><span class="p">,</span>
                                                    <span class="n">g</span> <span class="o">*</span> <span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_in</span><span class="p">,</span>
                                                    <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                            <span class="p">]</span> <span class="o">*</span> <span class="n">W</span><span class="p">[</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">group</span><span class="p">)</span> <span class="o">+</span> <span class="n">c_out</span><span class="p">,</span> <span class="n">c_in</span><span class="p">,</span> <span class="n">kh</span><span class="p">,</span> <span class="n">kw</span><span class="p">]</span>
        <span class="c1"># yapf: enable</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.element_wise" class="doc doc-heading">
        <code>element_wise</code>



<a href="#freetensor.libop.element_wise" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">












  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.abs" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">abs</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.abs" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise absolute value of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.abs_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">abs_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.abs_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise absolute value of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.add" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.add" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise addition of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.add_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.add_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise addition of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ceil" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceil</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ceil" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise ceil of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ceil_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceil_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ceil_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise ceil of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ceildiv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceildiv</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ceildiv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-positive-infinity integer division of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ceildiv_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ceildiv_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ceildiv_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-positive-infinity integer division of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.eq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">eq</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.eq" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise equal of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.eq_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">eq_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.eq_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise equal of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.exp" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exp</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.exp" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise natrual exponent of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.exp_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">exp_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.exp_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise natrual exponent of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.floor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floor</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.floor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise floor of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.floor_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floor_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.floor_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise floor of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.floordiv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floordiv</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.floordiv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-negative-infinity integer division (following Python convention, but not C, recommended for performance) of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.floordiv_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">floordiv_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.floordiv_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-negative-infinity integer division (following Python convention, but not C, recommended for performance) of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ge" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ge</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ge" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise greater-than-or-equal-to of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ge_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ge_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ge_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise greater-than-or-equal-to of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.gt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gt</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.gt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise greater-than of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.gt_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gt_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.gt_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise greater-than of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_and" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_and</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_and" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise logical and of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_and_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_and_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_and_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise logical and of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_not" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_not</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_not" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise logical not of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_not_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_not_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_not_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise logical not of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_or" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_or</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_or" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise logical or of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.l_or_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">l_or_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.l_or_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise logical or of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.le" class="doc doc-heading">
<code class="highlight language-python"><span class="n">le</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.le" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise less-than-or-equal-to of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.le_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">le_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.le_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise less-than-or-equal-to of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.lt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lt</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.lt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise less-than of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.lt_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lt_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.lt_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise less-than of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.max" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">max</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.max" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise maximum of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.max_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.max_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise maximum of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.min" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">min</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.min" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise minimum of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.min_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">min_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.min_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise minimum of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.mod" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.mod" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise modulo (results are non-negative, following Python convention, but not C, recommended for performance) of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.mod_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.mod_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise modulo (results are non-negative, following Python convention, but not C, recommended for performance) of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.mul" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mul</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.mul" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise multiplication of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.mul_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mul_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.mul_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise multiplication of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ne" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ne</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ne" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise non-equal of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.ne_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ne_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.ne_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise non-equal of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.neg" class="doc doc-heading">
<code class="highlight language-python"><span class="n">neg</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.neg" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise negation of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.neg_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">neg_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.neg_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise negation of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.relu" class="doc doc-heading">
<code class="highlight language-python"><span class="n">relu</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.relu" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise ReLU of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.relu_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">relu_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.relu_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise ReLU of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.remainder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remainder</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.remainder" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise remainder (results can be positive or negative, following C convention, but not Python, NOT recommended for performance) of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.remainder_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remainder_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.remainder_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise remainder (results can be positive or negative, following C convention, but not Python, NOT recommended for performance) of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.round_towards_0_div" class="doc doc-heading">
<code class="highlight language-python"><span class="n">round_towards_0_div</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.round_towards_0_div" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-0 integer division (following C convention, but not Python, NOT recommended for performance) of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.round_towards_0_div_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">round_towards_0_div_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.round_towards_0_div_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise rounding-towards-0 integer division (following C convention, but not Python, NOT recommended for performance) of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sigmoid" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sigmoid</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sigmoid" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise sigmoid of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sigmoid_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sigmoid_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sigmoid_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise sigmoid of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sqrt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sqrt</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sqrt" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise square root of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sqrt_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sqrt_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sqrt_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise square root of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.square" class="doc doc-heading">
<code class="highlight language-python"><span class="n">square</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.square" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise square of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.square_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">square_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.square_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise square of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sub" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sub</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sub" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise subtraction of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.sub_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sub_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.sub_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise subtraction of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.tanh" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tanh</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.tanh" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise tanh of a tensor and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.tanh_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">tanh_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.tanh_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Element-wise tanh of a tensor. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.truediv" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truediv</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.truediv" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise floating-point division of two tensors and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.element_wise.truediv_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truediv_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.element_wise.truediv_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>(Broadcasted) element-wise floating-point division of two tensors. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  Left-hand-side operand</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  Right-hand-side operand</p></li>
            <li><p><strong>out</strong> (<code>VarRef</code>)  The result tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/element_wise.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.matmul" class="doc doc-heading">
        <code>matmul</code>



<a href="#freetensor.libop.matmul" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.einsum" class="doc doc-heading">
<code class="highlight language-python"><span class="n">einsum</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.einsum" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Einstein summation. The result is returned</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fmt</strong> (<code>str</code>)  The format string. E.g. <code>"ik,kj-&gt;ij"</code> represents a matrix multiplcation</p></li>
            <li><p><strong>args</strong> (<code>Sequence[VarRef]</code>)  All inputs arguments. E.g. if <code>fmt</code> is <code>"ik,kj-&gt;ij"</code>,
it iterates axis <code>i</code> and <code>k</code> of <code>args[0]</code>, axis <code>k</code> and <code>j</code> of <code>args[1]</code>,
axis <code>i</code> and <code>j</code> of the returned value</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">einsum</span><span class="p">(</span><span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Einstein summation. The result is returned</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fmt : str</span>
<span class="sd">        The format string. E.g. `&quot;ik,kj-&gt;ij&quot;` represents a matrix multiplcation</span>
<span class="sd">    args : Sequence[VarRef]</span>
<span class="sd">        All inputs arguments. E.g. if `fmt` is `&quot;ik,kj-&gt;ij&quot;`,</span>
<span class="sd">        it iterates axis `i` and `k` of `args[0]`, axis `k` and `j` of `args[1]`,</span>
<span class="sd">        axis `i` and `j` of the returned value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The result tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lefts</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
    <span class="n">lefts</span> <span class="o">=</span> <span class="n">lefts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="n">shapes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">right</span><span class="p">:</span>
        <span class="n">offsets</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">lefts</span><span class="p">]</span>
        <span class="n">iter_args</span><span class="p">,</span> <span class="n">iter_offsets</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
            <span class="o">*</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">offsets</span><span class="p">)))</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">iter_args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">shapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iter_args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">iter_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># FIXME: compute dtype and mtype from every inputs</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="n">einsum_</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.einsum_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">einsum_</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.einsum_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Einstein summation. The result is written to the last argument</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>fmt</strong> (<code>str</code>)  The format string. E.g. <code>"ik,kj-&gt;ij"</code> represents a matrix multiplcation</p></li>
            <li><p><strong>args</strong> (<code>Sequence[VarRef]</code>)  All arguments including inputs and the output. E.g. if <code>fmt</code> is <code>"ik,kj-&gt;ij"</code>,
it iterates axis <code>i</code> and <code>k</code> of <code>args[0]</code>, axis <code>k</code> and <code>j</code> of <code>args[1]</code>,
axis <code>i</code> and <code>j</code> of <code>args[2]</code></p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">einsum_</span><span class="p">(</span><span class="n">fmt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Einstein summation. The result is written to the last argument</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    fmt : str</span>
<span class="sd">        The format string. E.g. `&quot;ik,kj-&gt;ij&quot;` represents a matrix multiplcation</span>
<span class="sd">    args : Sequence[VarRef]</span>
<span class="sd">        All arguments including inputs and the output. E.g. if `fmt` is `&quot;ik,kj-&gt;ij&quot;`,</span>
<span class="sd">        it iterates axis `i` and `k` of `args[0]`, axis `k` and `j` of `args[1]`,</span>
<span class="sd">        axis `i` and `j` of `args[2]`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">lefts</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
    <span class="n">lefts</span> <span class="o">=</span> <span class="n">lefts</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">right</span>
    <span class="k">for</span> <span class="n">left</span> <span class="ow">in</span> <span class="n">lefts</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">left</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
                <span class="n">order</span> <span class="o">+=</span> <span class="n">idx</span>
    <span class="n">_einsum_</span><span class="p">(</span><span class="n">lefts</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.gemm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gemm</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">has_bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trans_A</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trans_B</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.gemm" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>General matrix multiplcation following BLAS convention and return the result</p>
<p>It performs <code>Y = alpha tr?(A) @ tr?(B) + C</code>, where <code>@</code> represents matrix multiplication, <code>tr?</code>
represents an optional transposition</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>A</strong> (<code>VarRef</code>)  The left-hand-side operand of matrix multiplication</p></li>
            <li><p><strong>B</strong> (<code>VarRef</code>)  The right-hand-side operand of matrix multiplication</p></li>
            <li><p><strong>C</strong> (<code>VarRef (Optional)</code>)  The bias tensor</p></li>
            <li><p><strong>trans_A</strong> (<code>bool</code>)  If true, transpose <code>A</code>. Defaults to False</p></li>
            <li><p><strong>trans_B</strong> (<code>bool</code>)  If true, transpose <code>B</code>. Defaults to False</p></li>
            <li><p><strong>alpha</strong> (<code>float</code>)  Coefficient of <code>tr?(A) @ tr?(B)</code>. Defaults to 1.0</p></li>
            <li><p><strong>beta</strong> (<code>float</code>)  Coefficient of <code>C</code>. Defaults to 1.0</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The resulting tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">gemm</span><span class="p">(</span><span class="n">A</span><span class="p">,</span>
         <span class="n">B</span><span class="p">,</span>
         <span class="n">C</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">has_bias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="n">trans_A</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="n">trans_B</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
         <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    General matrix multiplcation following BLAS convention and return the result</span>

<span class="sd">    It performs `Y = alpha tr?(A) @ tr?(B) + C`, where `@` represents matrix multiplication, `tr?`</span>
<span class="sd">    represents an optional transposition</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : VarRef</span>
<span class="sd">        The left-hand-side operand of matrix multiplication</span>
<span class="sd">    B : VarRef</span>
<span class="sd">        The right-hand-side operand of matrix multiplication</span>
<span class="sd">    C : VarRef (Optional)</span>
<span class="sd">        The bias tensor</span>
<span class="sd">    trans_A : bool (Optional)</span>
<span class="sd">        If true, transpose `A`. Defaults to False</span>
<span class="sd">    trans_B : bool (Optional)</span>
<span class="sd">        If true, transpose `B`. Defaults to False</span>
<span class="sd">    alpha : Number (Optional)</span>
<span class="sd">        Coefficient of `tr?(A) @ tr?(B)`. Defaults to 1.0</span>
<span class="sd">    beta : Number (Optional)</span>
<span class="sd">        Coefficient of `C`. Defaults to 1.0</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">dtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">up_cast</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">mtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">same_mtype</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">mtype</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">up_cast</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">mtype</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">same_mtype</span><span class="p">(</span><span class="n">mtype</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_comp_shape</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">trans_A</span><span class="p">,</span> <span class="n">trans_B</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">gemm_</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">trans_A</span><span class="p">,</span> <span class="n">trans_B</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.gemm_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">gemm_</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">trans_A</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trans_B</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.gemm_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>General matrix multiplcation following BLAS convention. The result is written to an existing tensor</p>
<p>It performs <code>Y = alpha tr?(A) @ tr?(B) + C</code>, where <code>@</code> represents matrix multiplication, <code>tr?</code>
represents an optional transposition</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>A</strong> (<code>VarRef</code>)  The left-hand-side operand of matrix multiplication</p></li>
            <li><p><strong>B</strong> (<code>VarRef</code>)  The right-hand-side operand of matrix multiplication</p></li>
            <li><p><strong>C</strong> (<code>VarRef (Optional)</code>)  The bias tensor</p></li>
            <li><p><strong>Y</strong> (<code>VarRef</code>)  The resulting tensor</p></li>
            <li><p><strong>trans_A</strong> (<code>bool</code>)  If true, transpose <code>A</code>. Defaults to False</p></li>
            <li><p><strong>trans_B</strong> (<code>bool</code>)  If true, transpose <code>B</code>. Defaults to False</p></li>
            <li><p><strong>alpha</strong> (<code>float</code>)  Coefficient of <code>tr?(A) @ tr?(B)</code>. Defaults to 1.0</p></li>
            <li><p><strong>beta</strong> (<code>float</code>)  Coefficient of <code>C</code>. Defaults to 1.0</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">gemm_</span><span class="p">(</span><span class="n">A</span><span class="p">,</span>
          <span class="n">B</span><span class="p">,</span>
          <span class="n">C</span><span class="p">,</span>
          <span class="n">Y</span><span class="p">,</span>
          <span class="n">trans_A</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">trans_B</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
          <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    General matrix multiplcation following BLAS convention. The result is written to an existing tensor</span>

<span class="sd">    It performs `Y = alpha tr?(A) @ tr?(B) + C`, where `@` represents matrix multiplication, `tr?`</span>
<span class="sd">    represents an optional transposition</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : VarRef</span>
<span class="sd">        The left-hand-side operand of matrix multiplication</span>
<span class="sd">    B : VarRef</span>
<span class="sd">        The right-hand-side operand of matrix multiplication</span>
<span class="sd">    C : VarRef (Optional)</span>
<span class="sd">        The bias tensor</span>
<span class="sd">    Y : VarRef</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    trans_A : bool (Optional)</span>
<span class="sd">        If true, transpose `A`. Defaults to False</span>
<span class="sd">    trans_B : bool (Optional)</span>
<span class="sd">        If true, transpose `B`. Defaults to False</span>
<span class="sd">    alpha : Number (Optional)</span>
<span class="sd">        Coefficient of `tr?(A) @ tr?(B)`. Defaults to 1.0</span>
<span class="sd">    beta : Number (Optional)</span>
<span class="sd">        Coefficient of `C`. Defaults to 1.0</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">a_fmt</span> <span class="o">=</span> <span class="s1">&#39;ki&#39;</span> <span class="k">if</span> <span class="n">trans_A</span> <span class="k">else</span> <span class="s1">&#39;ik&#39;</span>
    <span class="n">b_fmt</span> <span class="o">=</span> <span class="s1">&#39;jk&#39;</span> <span class="k">if</span> <span class="n">trans_B</span> <span class="k">else</span> <span class="s1">&#39;kj&#39;</span>
    <span class="n">fmt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a_fmt</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">b_fmt</span><span class="si">}</span><span class="s2">-&gt;ij&quot;</span>

    <span class="k">if</span> <span class="n">C</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1">#! nid: einsum</span>
        <span class="n">einsum_</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="c1">#! nid: mul_to</span>
        <span class="n">mul_to</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#! nid: einsum</span>
        <span class="n">einsum_</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
        <span class="c1">#! nid: mul_to</span>
        <span class="n">mul_to</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="c1">#! nid: add_to</span>
        <span class="n">add_to</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">mul</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="n">C</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.matmul" class="doc doc-heading">
<code class="highlight language-python"><span class="n">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.matmul" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Matrix multiplcation. The result is returned</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>A</strong> (<code>VarRef</code>)  The left-hand-side operand</p></li>
            <li><p><strong>B</strong> (<code>VarRef</code>)  The right-hand-side operand</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The resulting tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">matmul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Matrix multiplcation. The result is returned</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : VarRef</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    B : VarRef</span>
<span class="sd">        The right-hand-side operand</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: einsum</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">einsum</span><span class="p">(</span><span class="n">_make_matmul_fmt</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">ndim</span><span class="p">),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.matmul.matmul_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">matmul_</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span></code>


<a href="#freetensor.libop.matmul.matmul_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Matrix multiplcation. The result is written to an existing tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>A</strong> (<code>VarRef</code>)  The left-hand-side operand</p></li>
            <li><p><strong>B</strong> (<code>VarRef</code>)  The right-hand-side operand</p></li>
            <li><p><strong>C</strong> (<code>VarRef</code>)  The resulting tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/matmul.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">matmul_</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Matrix multiplcation. The result is written to an existing tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : VarRef</span>
<span class="sd">        The left-hand-side operand</span>
<span class="sd">    B : VarRef</span>
<span class="sd">        The right-hand-side operand</span>
<span class="sd">    C : VarRef</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: einsum</span>
    <span class="n">einsum_</span><span class="p">(</span><span class="n">_make_matmul_fmt</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">B</span><span class="o">.</span><span class="n">ndim</span><span class="p">),</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.pooling" class="doc doc-heading">
        <code>pooling</code>



<a href="#freetensor.libop.pooling" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.pooling.global_avg_pool" class="doc doc-heading">
<code class="highlight language-python"><span class="n">global_avg_pool</span><span class="p">(</span><span class="n">X</span><span class="p">)</span></code>


<a href="#freetensor.libop.pooling.global_avg_pool" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Global averaging pooling. The result is returned</p>
<p>Parameters follow ONNX convention. Currently only 2-D pooling is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/pooling.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">global_avg_pool</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Global averaging pooling. The result is returned</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D pooling is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D pooling is supported (TODO)</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)],</span> <span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">global_avg_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.pooling.global_avg_pool_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">global_avg_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span></code>


<a href="#freetensor.libop.pooling.global_avg_pool_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Global averaging pooling. The result is written to another tensor</p>
<p>Parameters follow ONNX convention. Currently only 2-D pooling is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/pooling.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">global_avg_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Global averaging pooling. The result is written to another tensor</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D pooling is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D pooling is supported (TODO)</span>
    <span class="c1">#! nid: L_n</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
        <span class="c1">#! nid: L_c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="c1">#! nid: init</span>
            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1">#! nid: L_h</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                <span class="c1">#! nid: L_w</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                    <span class="c1">#! nid: compute</span>
                    <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span>
            <span class="c1">#! nid: flush</span>
            <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">/=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.pooling.max_pool" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_pool</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">auto_pad</span><span class="o">=</span><span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span> <span class="n">dilations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.libop.pooling.max_pool" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Maximum pooling. The result is returned</p>
<p>Parameters follow ONNX convention. Currently only 2-D pooling is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/pooling.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">max_pool</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
             <span class="n">auto_pad</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span>
             <span class="n">dilations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">kernel_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">pads</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">strides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Maximum pooling. The result is returned</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D pooling is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D pooling is supported (TODO)</span>

    <span class="c1"># TODO: ceil_mode</span>
    <span class="c1"># TODO: return_indices</span>

    <span class="k">if</span> <span class="n">dilations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dilations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># NOTE: strides default to 1 in ONNX, while default to kernel_shape in PyTorch</span>
        <span class="n">strides</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">pads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;VALID&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span><span class="p">)))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_UPPER&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_upper_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_LOWER&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_lower_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;auto_pad should be set if pads is not specified&quot;</span>

    <span class="n">Y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span>
        <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">calc_out_size</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kernel_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">pads</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
        <span class="n">calc_out_size</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">kernel_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">pads</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">mtype</span><span class="p">)</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">max_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">auto_pad</span><span class="p">,</span> <span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">pads</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.pooling.max_pool_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">max_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">auto_pad</span><span class="o">=</span><span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span> <span class="n">dilations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pads</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strides</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


<a href="#freetensor.libop.pooling.max_pool_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Maximum pooling. The result is written to another tensor</p>
<p>Parameters follow ONNX convention. Currently only 2-D pooling is supported</p>

        <details class="quote">
          <summary>Source code in <code>freetensor/libop/pooling.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">max_pool_</span><span class="p">(</span><span class="n">X</span><span class="p">,</span>
              <span class="n">Y</span><span class="p">,</span>
              <span class="n">auto_pad</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;NOTSET&#39;</span><span class="p">,</span>
              <span class="n">dilations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">kernel_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">pads</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">strides</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Maximum pooling. The result is written to another tensor</span>

<span class="sd">    Parameters follow ONNX convention. Currently only 2-D pooling is supported</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">n_spatial_dim</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Currently only 2-D pooling is supported (TODO)</span>

    <span class="c1"># TODO: ceil_mode</span>
    <span class="c1"># TODO: return_indices</span>

    <span class="k">if</span> <span class="n">dilations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dilations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">strides</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># NOTE: strides default to 1 in ONNX, while default to kernel_shape in PyTorch</span>
        <span class="n">strides</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span>
    <span class="k">if</span> <span class="n">pads</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;VALID&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="n">n_spatial_dim</span><span class="p">)))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_UPPER&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_upper_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">auto_pad</span> <span class="o">==</span> <span class="s1">&#39;SAME_LOWER&#39;</span><span class="p">:</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span>
                    <span class="n">calc_same_lower_pad</span><span class="p">(</span><span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span><span class="p">)</span> <span class="k">for</span> <span class="n">dil</span><span class="p">,</span> <span class="n">kern</span><span class="p">,</span> <span class="n">stride</span>
                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dilations</span><span class="p">,</span> <span class="n">kernel_shape</span><span class="p">,</span> <span class="n">strides</span><span class="p">)</span>
                <span class="p">]))</span>
            <span class="n">pads</span> <span class="o">=</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;auto_pad should be set if pads is not specified&quot;</span>

    <span class="c1"># yapf: disable</span>
    <span class="c1">#! nid: L_n</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
        <span class="c1">#! nid: L_c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">1</span><span class="p">)):</span>
            <span class="c1">#! nid: L_h</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)):</span>
                <span class="c1">#! nid: L_w</span>
                <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                    <span class="c1">#! nid: init</span>
                    <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">min_value</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                    <span class="c1">#! nid: L_kh</span>
                    <span class="k">for</span> <span class="n">kh</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                        <span class="c1">#! nid: L_kw</span>
                        <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kernel_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                            <span class="c1"># h_in = h * stride + kh * dilation - pad</span>
                            <span class="c1"># w_in = w * stride + kw * dilation - pad</span>
                            <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                    <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span>
                                    <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span>
                                    <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">3</span><span class="p">)):</span>
                                <span class="c1">#! nid: compute</span>
                                <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                                    <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">],</span>
                                    <span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span>
                                        <span class="n">h</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kh</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">w</span> <span class="o">*</span> <span class="n">strides</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kw</span> <span class="o">*</span> <span class="n">dilations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pads</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="c1"># yapf: enable</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.reduction" class="doc doc-heading">
        <code>reduction</code>



<a href="#freetensor.libop.reduction" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.all" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">all</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.all" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reduction of logical and of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.all_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">all_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.all_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reduction of logical and of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.any" class="doc doc-heading">
<code class="highlight language-python"><span class="nb">any</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.any" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reduction of logical or of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.any_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">any_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.any_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reduction of logical or of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_max" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_max" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Maximum of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">reduce_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Maximum of a tensor through one or more dimensions and return the result</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    axes : Sequence[int] (Optional)</span>
<span class="sd">        Which dimensions to reduce through. Defaults to None, standing for all dimensions,</span>
<span class="sd">        i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</span>
<span class="sd">    keepdims : bool (Optional)</span>
<span class="sd">        Keep the reduced dimensions as singleton dimensions. Defaults to True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: impl</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">_general_reduce</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">min_value</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                        <span class="n">keepdims</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_max_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_max_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_max_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Maximum of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">reduce_max_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Maximum of a tensor through one or more dimensions. The result is written to another tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    axes : Sequence[int] (Optional)</span>
<span class="sd">        Which dimensions to reduce through. Defaults to None, standing for all dimensions,</span>
<span class="sd">        i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</span>
<span class="sd">    keepdims : bool (Optional)</span>
<span class="sd">        Keep the reduced dimensions as singleton dimensions. Defaults to True</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: impl</span>
    <span class="n">_general_reduce_</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">min_value</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                     <span class="n">keepdims</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_min" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_min" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Minimum of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">reduce_min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Minimum of a tensor through one or more dimensions and return the result</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    axes : Sequence[int] (Optional)</span>
<span class="sd">        Which dimensions to reduce through. Defaults to None, standing for all dimensions,</span>
<span class="sd">        i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</span>
<span class="sd">    keepdims : bool (Optional)</span>
<span class="sd">        Keep the reduced dimensions as singleton dimensions. Defaults to True</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: impl</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">_general_reduce</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">max_value</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                        <span class="n">keepdims</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_min_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_min_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_min_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Minimum of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">reduce_min_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Minimum of a tensor through one or more dimensions. The result is written to another tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    axes : Sequence[int] (Optional)</span>
<span class="sd">        Which dimensions to reduce through. Defaults to None, standing for all dimensions,</span>
<span class="sd">        i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</span>
<span class="sd">    keepdims : bool (Optional)</span>
<span class="sd">        Keep the reduced dimensions as singleton dimensions. Defaults to True</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: impl</span>
    <span class="n">_general_reduce_</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">max_value</span><span class="p">(</span><span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span>
                     <span class="n">keepdims</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_prod" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_prod</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_prod" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Product of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_prod_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_prod_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_prod_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Product of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_sum" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_sum</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_sum" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Sum of a tensor through one or more dimensions and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reduction.reduce_sum_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">reduce_sum_</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span></code>


<a href="#freetensor.libop.reduction.reduce_sum_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Sum of a tensor through one or more dimensions. The result is written to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int] (Optional)</code>)  Which dimensions to reduce through. Defaults to None, standing for all dimensions,
i.e., reduce the tensor to a scalar. Negative axis means counting form the last dimension</p></li>
            <li><p><strong>keepdims</strong> (<code>bool (Optional)</code>)  Keep the reduced dimensions as singleton dimensions. Defaults to True</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reduction.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kvs</span><span class="p">,</span> <span class="o">**</span><span class="n">_kvs</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.reshape" class="doc doc-heading">
        <code>reshape</code>



<a href="#freetensor.libop.reshape" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.expand" class="doc doc-heading">
<code class="highlight language-python"><span class="n">expand</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">expand_shape</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.expand" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Broadcast a tensor to a given shape, following the broadcasting rules</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>b</strong> (<code>Sequence of expressions</code>)  The broadcasted shape</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The broadcasted tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">expand_shape</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Broadcast a tensor to a given shape, following the broadcasting rules</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    b : Sequence of expressions</span>
<span class="sd">        The broadcasted shape</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The broadcasted tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># FIXME: out_shape = broadcast(a.shape, expand_shape)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">expand_shape</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">core</span><span class="o">.</span><span class="n">mtype</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">expand_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.expand_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">expand_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.expand_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Broadcast a tensor to an existing tensor, following the broadcasting rules</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>a</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>b</strong> (<code>VarRef</code>)  The broadcasted tensor</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">expand_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Broadcast a tensor to an existing tensor, following the broadcasting rules</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    a : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    b : VarRef</span>
<span class="sd">        The broadcasted tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#! nid: L_elem</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">core</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">out</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="c1">#! nid: recur</span>
                <span class="n">expand_</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#! nid: recur</span>
                <span class="n">expand_</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.flatten" class="doc doc-heading">
<code class="highlight language-python"><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.flatten" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Flatten a tensor to have fewer dimensions, and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axis</strong> (<code>int (Optional)</code>)  The result tensor will have up to <code>axis</code> dimensions. All dimensions after
<code>axis</code> will be flatten to 1-D. Negative axis means counting form the last
dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Flatten a tensor to have fewer dimensions, and return the result</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    axis : int (Optional)</span>
<span class="sd">        The result tensor will have up to `axis` dimensions. All dimensions after</span>
<span class="sd">        `axis` will be flatten to 1-D. Negative axis means counting form the last</span>
<span class="sd">        dimension</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The result tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_flatten_comp_shape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="p">),</span> <span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">core</span><span class="o">.</span><span class="n">mtype</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">flatten_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.flatten_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">flatten_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.flatten_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Flatten a tensor to have fewer dimensions, and write to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axis</strong> (<code>int</code>)  The result tensor will have up to <code>axis</code> dimensions. All dimensions after
<code>axis</code> will be flatten to 1-D. Negative axis means counting form the last
dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">flatten_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Flatten a tensor to have fewer dimensions, and write to another tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    axis : int (Optional)</span>
<span class="sd">        The result tensor will have up to `axis` dimensions. All dimensions after</span>
<span class="sd">        `axis` will be flatten to 1-D. Negative axis means counting form the last</span>
<span class="sd">        dimension</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#! nid: recur</span>
        <span class="n">_flatten_inner_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#! nid: L_outer</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
            <span class="c1">#! nid: recur</span>
            <span class="n">flatten_</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">))],</span> <span class="n">axis</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.unsqueeze" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.unsqueeze" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Insert singleton dimensions to a tensor, and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Dimension numbers of the new singleton dimensions. Negative axis means counting
from the last dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p><code>VarRef</code>  The resulting tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">unsqueeze</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Insert singleton dimensions to a tensor, and return the result</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    axes :</span>
<span class="sd">        Dimension numbers of the new singleton dimensions. Negative axis means counting</span>
<span class="sd">        from the last dimension</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">_unsqueeze_comp_shape</span><span class="p">(</span><span class="n">_circular_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="n">x</span><span class="p">),</span>
                   <span class="n">core</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">core</span><span class="o">.</span><span class="n">mtype</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="c1">#! nid: recur</span>
    <span class="n">unsqueeze_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.reshape.unsqueeze_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unsqueeze_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span></code>


<a href="#freetensor.libop.reshape.unsqueeze_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Insert singleton dimensions to a tensor, and write the result to another tensor</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The resulting tensor</p></li>
            <li><p><strong>axes</strong> (<code>Sequence[int]</code>)  Dimension numbers of the new singleton dimensions. Negative axis means counting
from the last dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/reshape.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">unsqueeze_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Insert singleton dimensions to a tensor, and write the result to another tensor</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The resulting tensor</span>
<span class="sd">    axes :</span>
<span class="sd">        Dimension numbers of the new singleton dimensions. Negative axis means counting</span>
<span class="sd">        from the last dimension</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">_circular_axes</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">core</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span><span class="p">[()]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">elif</span> <span class="n">begin_with_0</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
        <span class="c1">#! nid: recur</span>
        <span class="n">unsqueeze_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">all_minus_one</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#! nid: L</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)):</span>
            <span class="c1">#! nid: recur</span>
            <span class="n">unsqueeze_</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">all_minus_one</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  <div class="doc doc-object doc-module">



<h3 id="freetensor.libop.softmax" class="doc doc-heading">
        <code>softmax</code>



<a href="#freetensor.libop.softmax" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.softmax.softmax" class="doc doc-heading">
<code class="highlight language-python"><span class="n">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#freetensor.libop.softmax.softmax" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Softmax of tensor <code>x</code> along an axis and return the result</p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>axis</strong> (<code>int (Optional)</code>)  Axis that the softmax is performed along. Negative axis means
count from the last dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
        <ul class="first simple">
          <li><p>The result tensor</p></li>
        </ul>
    </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/softmax.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Softmax of tensor `x` along an axis and return the result</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    axis : int (Optional)</span>
<span class="sd">        Axis that the softmax is performed along. Negative axis means</span>
<span class="sd">        count from the last dimension</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    VarRef :</span>
<span class="sd">        The result tensor</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: max</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="n">reduce_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#! nid: sub</span>
    <span class="n">corrected</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>
    <span class="c1">#! nid: exp</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">corrected</span><span class="p">)</span>
    <span class="c1">#! nid: sum</span>
    <span class="n">summation</span> <span class="o">=</span> <span class="n">reduce_sum</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#! nid: div</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">truediv</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="n">summation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="freetensor.libop.softmax.softmax_" class="doc doc-heading">
<code class="highlight language-python"><span class="n">softmax_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></code>


<a href="#freetensor.libop.softmax.softmax_" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Softmax of tensor <code>x</code> along an axis, and write to tensor <code>y</code></p>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li><p><strong>x</strong> (<code>VarRef</code>)  The input tensor</p></li>
            <li><p><strong>y</strong> (<code>VarRef</code>)  The result tensor</p></li>
            <li><p><strong>axis</strong> (<code>int</code>)  Axis that the softmax is performed along. Negative axis means
count from the last dimension</p></li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>freetensor/libop/softmax.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@core</span><span class="o">.</span><span class="n">inline</span>
<span class="k">def</span> <span class="nf">softmax_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Softmax of tensor `x` along an axis, and write to tensor `y`</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : VarRef</span>
<span class="sd">        The input tensor</span>
<span class="sd">    y : VarRef</span>
<span class="sd">        The result tensor</span>
<span class="sd">    axis : int (Optional)</span>
<span class="sd">        Axis that the softmax is performed along. Negative axis means</span>
<span class="sd">        count from the last dimension</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#! nid: max</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="n">reduce_max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#! nid: sub</span>
    <span class="n">corrected</span> <span class="o">=</span> <span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxval</span><span class="p">)</span>
    <span class="c1">#! nid: exp</span>
    <span class="n">exponent</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="n">corrected</span><span class="p">)</span>
    <span class="c1">#! nid: sum</span>
    <span class="n">summation</span> <span class="o">=</span> <span class="n">reduce_sum</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">[</span><span class="n">axis</span><span class="p">],</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#! nid: div</span>
    <span class="n">truediv_</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="n">summation</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>





  </div>

    </div>

  </div>




  </div>

    </div>

  </div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../guide/ad/" class="btn btn-neutral float-left" title="Automatic Differentiation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../doxygen/html/" class="btn btn-neutral float-right" title="Internal C++ Interface">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../guide/ad/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../doxygen/html/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
